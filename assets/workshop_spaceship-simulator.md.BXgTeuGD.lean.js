import{t as Me,u as pe,G as W,l as X,v as me,m as de,j as fe,w as ve,g as x,f as J,V as f,x as Ie,Q as Y,y as Re,p as T,z as We,D as ge,e as se,E as je,I as he,J as Ke,q as ue,O as Ee,K as He,N as Xe,B as Ae,F as be,i as $e,k as Ye,a as Ze,n as Te,U as Je,s as Oe,L as et,r as Qe,X as Fe,Y as tt,c as ot,d as nt,W as at,A as st,o as it}from"./chunks/three.module.qkk1P2i0.js";import{am as Se,p as ye,c as ne,o as ee,j as y,a as Z,e as le,t as ae,N as rt,b as ct,w as Ne,T as lt,_ as dt,v as ut,Y as pt,a4 as De,k as ie,G as xe,C as mt}from"./chunks/framework.DQgBWl2g.js";const ht=2e-6,Be=933e-6,wt=[{name:"太阳",nameEn:"Sun",color:16755251,emissive:16755251,size:2e3,mass:472e11,orbitRadius:0,orbitSpeed:0,rotationSpeed:5e-5,isStar:!0,description:"星系中心，直径4000米"},{name:"余烬孪星",nameEn:"Ember Twin",color:12868666,emissive:10767402,size:171,mass:115e9,orbitRadius:5e3,orbitSpeed:933e-6,rotationSpeed:833e-6,isTwin:!0,twinSide:1,description:"沙漏双星之一，直径342米，公转速度~280m/s，自转周期~126秒"},{name:"灰烬孪星",nameEn:"Ash Twin",color:15259043,emissive:13153667,size:168,mass:106e9,orbitRadius:5e3,orbitSpeed:933e-6,rotationSpeed:.00116,isTwin:!0,twinSide:-1,description:"沙漏双星之一，直径336米，公转速度~280m/s，自转周期~90秒"},{name:"木炉星",nameEn:"Timber Hearth",color:8043130,emissive:5937754,size:250,mass:361e9,orbitRadius:8593,orbitSpeed:419e-6,rotationSpeed:167e-6,description:"地表半径250米，大气175米，公转速度~216m/s，自转周期~628秒",hasAtmosphere:!0,atmosphereColor:8965375,atmosphereThickness:175},{name:"废墟月亮",nameEn:"Attlerock",color:8947848,emissive:4473924,size:75,mass:1e9,moonOf:"木炉星",moonOrbitRadius:600,moonOrbitSpeed:.002,rotationSpeed:.001,description:"木炉星的卫星，无大气"},{name:"脆壳星",nameEn:"Brittle Hollow",color:8035274,emissive:5929898,size:300,mass:334e9,orbitRadius:11691,orbitSpeed:264e-6,rotationSpeed:333e-6,description:"地表半径300米，大气50米，公转速度~185m/s，自转周期~314秒",hasBlackHole:!0,blackHoleSize:53,hasAtmosphere:!0,atmosphereColor:11184810,atmosphereThickness:50},{name:"深巨星",nameEn:"Giant's Deep",color:5085818,emissive:4033130,size:500,mass:289e10,orbitRadius:16458,orbitSpeed:158e-6,rotationSpeed:1e-5,description:"地表半径500米，大气450米，公转速度~156m/s，表面重力2g，潮汐锁定",hasAtmosphere:!0,atmosphereColor:6728328,atmosphereThickness:450,surfaceGravity:2},{name:"黑棘星",nameEn:"Dark Bramble",color:3824202,emissive:2771514,size:750,mass:99e10,orbitRadius:2e4,orbitSpeed:118e-6,rotationSpeed:2e-4,description:"地表半径750米，大气250米，公转速度~141m/s",hasAtmosphere:!0,atmosphereColor:13421772,atmosphereThickness:250},{name:"闯入者",nameEn:"The Interloper",color:8969710,emissive:6732748,size:77.5,mass:1e10,orbitA:18e3,orbitB:8e3,orbitSpeed:32e-5,rotationSpeed:3e-4,isComet:!0,description:"椭圆轨道彗星，直径155米，公转速度50~450m/s"},{name:"量子卫星",nameEn:"Quantum Moon",color:12237546,emissive:10132170,size:120,mass:1e10,moonOrbitRadius:1200,moonOrbitSpeed:8e-4,rotationSpeed:.0015,isQuantum:!0,description:"地表半径120米，浓厚银灰色云雾130米",hasAtmosphere:!0,atmosphereColor:10066346,atmosphereThickness:130}],Ce=["灰烬孪星","脆壳星","深巨星","黑棘星","木炉星"];class we{constructor(e=Math.random()){this.p=new Uint8Array(256),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let s=0;s<256;s++)this.p[s]=s;let o,a;for(let s=255;s>0;s--)e=e*16807%2147483647,o=e%(s+1),a=this.p[s],this.p[s]=this.p[o],this.p[o]=a;for(let s=0;s<512;s++)this.perm[s]=this.p[s&255],this.permMod12[s]=this.perm[s]%12;this.grad3=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6,this.F3=1/3,this.G3=1/6}noise2D(e,o){const{perm:a,permMod12:s,grad3:r,F2:c,G2:i}=this,n=(e+o)*c,l=Math.floor(e+n),d=Math.floor(o+n),g=(l+d)*i,b=l-g,C=d-g,u=e-b,v=o-C;let m,h;u>v?(m=1,h=0):(m=0,h=1);const M=u-m+i,w=v-h+i,p=u-1+2*i,k=v-1+2*i,S=l&255,A=d&255;let P=0,L=0,I=0,V=.5-u*u-v*v;if(V>=0){const R=s[S+a[A]]*3;V*=V,P=V*V*(r[R]*u+r[R+1]*v)}let D=.5-M*M-w*w;if(D>=0){const R=s[S+m+a[A+h]]*3;D*=D,L=D*D*(r[R]*M+r[R+1]*w)}let z=.5-p*p-k*k;if(z>=0){const R=s[S+1+a[A+1]]*3;z*=z,I=z*z*(r[R]*p+r[R+1]*k)}return 70*(P+L+I)}noise3D(e,o,a){const{perm:s,permMod12:r,grad3:c,F3:i,G3:n}=this,l=(e+o+a)*i,d=Math.floor(e+l),g=Math.floor(o+l),b=Math.floor(a+l),C=(d+g+b)*n,u=d-C,v=g-C,m=b-C,h=e-u,M=o-v,w=a-m;let p,k,S,A,P,L;h>=M?M>=w?(p=1,k=0,S=0,A=1,P=1,L=0):h>=w?(p=1,k=0,S=0,A=1,P=0,L=1):(p=0,k=0,S=1,A=1,P=0,L=1):M<w?(p=0,k=0,S=1,A=0,P=1,L=1):h<w?(p=0,k=1,S=0,A=0,P=1,L=1):(p=0,k=1,S=0,A=1,P=1,L=0);const I=h-p+n,V=M-k+n,D=w-S+n,z=h-A+2*n,R=M-P+2*n,B=w-L+2*n,_=h-1+3*n,N=M-1+3*n,q=w-1+3*n,$=d&255,O=g&255,G=b&255;let K=0,E=0,Q=0,j=0,U=.6-h*h-M*M-w*w;if(U>=0){const H=r[$+s[O+s[G]]]*3;U*=U,K=U*U*(c[H]*h+c[H+1]*M+c[H+2]*w)}let F=.6-I*I-V*V-D*D;if(F>=0){const H=r[$+p+s[O+k+s[G+S]]]*3;F*=F,E=F*F*(c[H]*I+c[H+1]*V+c[H+2]*D)}let te=.6-z*z-R*R-B*B;if(te>=0){const H=r[$+A+s[O+P+s[G+L]]]*3;te*=te,Q=te*te*(c[H]*z+c[H+1]*R+c[H+2]*B)}let oe=.6-_*_-N*N-q*q;if(oe>=0){const H=r[$+1+s[O+1+s[G+1]]]*3;oe*=oe,j=oe*oe*(c[H]*_+c[H+1]*N+c[H+2]*q)}return 32*(K+E+Q+j)}}const re=(t,e,o,a,s=4,r=2,c=.5)=>{let i=0,n=1,l=1,d=0;for(let g=0;g<s;g++)i+=t.noise3D(e*l,o*l,a*l)*n,d+=n,n*=c,l*=r;return i/d},qe={木炉星:{seed:12345,resolution:512,baseColors:[{color:[58,120,58],weight:.4},{color:[90,140,70],weight:.3},{color:[120,100,60],weight:.2},{color:[40,80,120],weight:.1}],noiseScale:3,octaves:5,bumpStrength:1.2,hasOcean:!0,oceanLevel:.35,oceanColor:[40,80,120]},余烬孪星:{seed:23456,resolution:512,baseColors:[{color:[196,92,58],weight:.5},{color:[180,70,40],weight:.3},{color:[220,120,60],weight:.2}],noiseScale:4,octaves:4,bumpStrength:1.5,hasLava:!0,lavaColor:[255,100,20]},灰烬孪星:{seed:34567,resolution:512,baseColors:[{color:[232,213,163],weight:.4},{color:[200,180,140],weight:.35},{color:[180,160,120],weight:.25}],noiseScale:5,octaves:4,bumpStrength:.8},脆壳星:{seed:45678,resolution:512,baseColors:[{color:[122,155,202],weight:.4},{color:[90,120,170],weight:.3},{color:[60,80,120],weight:.2},{color:[40,50,80],weight:.1}],noiseScale:4,octaves:5,bumpStrength:1.8,hasCracks:!0,crackColor:[20,10,40]},深巨星:{seed:56789,resolution:512,baseColors:[{color:[77,154,122],weight:.5},{color:[60,130,100],weight:.3},{color:[100,180,140],weight:.2}],noiseScale:2,octaves:6,bumpStrength:.4,isGasGiant:!0,bandColors:[[60,140,100],[80,160,120],[50,120,90]]},黑棘星:{seed:67890,resolution:512,baseColors:[{color:[58,90,74],weight:.5},{color:[40,70,55],weight:.3},{color:[30,50,40],weight:.2}],noiseScale:3,octaves:5,bumpStrength:2,hasBrambles:!0},量子卫星:{seed:78901,resolution:256,baseColors:[{color:[186,186,234],weight:.5},{color:[160,160,210],weight:.3},{color:[140,140,190],weight:.2}],noiseScale:4,octaves:3,bumpStrength:.6,isQuantum:!0},闯入者:{seed:89012,resolution:256,baseColors:[{color:[136,221,238],weight:.6},{color:[180,240,250],weight:.3},{color:[100,200,220],weight:.1}],noiseScale:6,octaves:3,bumpStrength:.5,isIcy:!0},废墟月亮:{seed:90123,resolution:256,baseColors:[{color:[136,136,136],weight:.5},{color:[100,100,100],weight:.3},{color:[80,80,80],weight:.2}],noiseScale:5,octaves:4,bumpStrength:1,hasCraters:!0}},ft=t=>{if(!t||!t.baseColors||t.baseColors.length===0)return null;const{seed:e,resolution:o,baseColors:a,noiseScale:s,octaves:r,hasOcean:c,oceanLevel:i,oceanColor:n,isGasGiant:l,bandColors:d,hasCracks:g,crackColor:b,hasLava:C,lavaColor:u}=t,v=document.createElement("canvas");v.width=o,v.height=o;const m=v.getContext("2d"),h=m.createImageData(o,o),M=h.data,w=new we(e),p=new we(e+1e3);for(let S=0;S<o;S++)for(let A=0;A<o;A++){const P=A/o,L=S/o,I=P*Math.PI*2,V=L*Math.PI,D=Math.sin(V)*Math.cos(I),z=Math.sin(V)*Math.sin(I),R=Math.cos(V);let B=re(w,D*s,z*s,R*s,r);B=(B+1)*.5;let _,N,q;if(l&&d&&d.length>0){const O=re(p,D*1.5,z*1.5,R*.5,3)*.3,G=(L+O)*d.length*3%d.length,K=Math.floor(G<0?G+d.length:G),E=d[Math.min(K,d.length-1)],Q=B*.3;_=Math.min(255,E[0]+Q*50),N=Math.min(255,E[1]+Q*50),q=Math.min(255,E[2]+Q*30)}else if(c&&n&&B<i){const O=(i-B)/i;_=n[0]*(1-O*.3),N=n[1]*(1-O*.2),q=n[2]*(1+O*.2)}else{let O=0;_=N=q=0,a.forEach((K,E)=>{const Q=re(p,D*(s+E),z*(s+E),R*(s+E),3),j=K.weight*(.5+Q*.5);_+=K.color[0]*j,N+=K.color[1]*j,q+=K.color[2]*j,O+=j}),_/=O,N/=O,q/=O;const G=(B-.5)*40;_=Math.max(0,Math.min(255,_+G)),N=Math.max(0,Math.min(255,N+G)),q=Math.max(0,Math.min(255,q+G))}if(g&&b){const O=re(p,D*8,z*8,R*8,2);if(Math.abs(O)<.08){const G=1-Math.abs(O)/.08;_=_*(1-G)+b[0]*G,N=N*(1-G)+b[1]*G,q=q*(1-G)+b[2]*G}}if(C&&u){const O=re(p,D*6,z*6,R*6,3);if(O>.5){const G=(O-.5)*2;_=_*(1-G)+u[0]*G,N=N*(1-G)+u[1]*G,q=q*(1-G)+u[2]*G}}const $=(S*o+A)*4;M[$]=_,M[$+1]=N,M[$+2]=q,M[$+3]=255}m.putImageData(h,0,0);const k=new Me(v);return k.wrapS=pe,k.wrapT=pe,k},yt=t=>{if(!t)return null;const{seed:e,resolution:o,noiseScale:a,octaves:s,bumpStrength:r,hasCraters:c}=t,i=document.createElement("canvas");i.width=o,i.height=o;const n=i.getContext("2d"),l=n.createImageData(o,o),d=l.data,g=new we(e),b=new we(e+500),C=new Float32Array(o*o);for(let m=0;m<o;m++)for(let h=0;h<o;h++){const M=h/o,w=m/o,p=M*Math.PI*2,k=w*Math.PI,S=Math.sin(k)*Math.cos(p),A=Math.sin(k)*Math.sin(p),P=Math.cos(k);let L=re(g,S*a,A*a,P*a,s);if(c)for(let I=0;I<5;I++){const V=b.noise2D(I*10,0)*.5+.5,D=b.noise2D(0,I*10)*.5+.5,z=.05+b.noise2D(I,I)*.03,R=M-V,B=w-D,_=Math.sqrt(R*R+B*B);if(_<z){const N=(1-_/z)*.5;L-=N*(1-Math.pow(_/z,2))}}C[m*o+h]=L}const u=r*2;for(let m=0;m<o;m++)for(let h=0;h<o;h++){const M=(h-1+o)%o,w=(h+1)%o,p=(m-1+o)%o,k=(m+1)%o,S=C[m*o+M],A=C[m*o+w],P=C[p*o+h],L=C[k*o+h],I=(A-S)*u,V=(L-P)*u;let D=-I,z=-V,R=1;const B=Math.sqrt(D*D+z*z+R*R);D/=B,z/=B,R/=B;const _=(m*o+h)*4;d[_]=Math.floor((D*.5+.5)*255),d[_+1]=Math.floor((z*.5+.5)*255),d[_+2]=Math.floor((R*.5+.5)*255),d[_+3]=255}n.putImageData(l,0,0);const v=new Me(i);return v.wrapS=pe,v.wrapT=pe,v},vt=t=>{const{seed:e,resolution:o,noiseScale:a,hasOcean:s,oceanLevel:r}=t,c=document.createElement("canvas");c.width=o,c.height=o;const i=c.getContext("2d"),n=i.createImageData(o,o),l=n.data,d=new we(e+2e3);for(let b=0;b<o;b++)for(let C=0;C<o;C++){const u=C/o,v=b/o,m=u*Math.PI*2,h=v*Math.PI,M=Math.sin(h)*Math.cos(m),w=Math.sin(h)*Math.sin(m),p=Math.cos(h);let k=re(d,M*a,w*a,p*a,4);k=(k+1)*.5;let S;s&&k<(r||.35)?S=.1+Math.random()*.1:S=.4+k*.4+Math.random()*.1;const A=Math.floor(S*255),P=(b*o+C)*4;l[P]=A,l[P+1]=A,l[P+2]=A,l[P+3]=255}i.putImageData(n,0,0);const g=new Me(c);return g.wrapS=pe,g.wrapT=pe,g},gt=t=>{const e=qe[t];if(!e||!e.baseColors)return null;const o=ft(e),a=yt(e),s=vt(e);return!o||!a?null:{diffuseMap:o,normalMap:a,roughnessMap:s}},ze={vertexShader:`
    varying vec3 vNormal;
    varying vec3 vPosition;
    varying vec3 vWorldPosition;
    
    void main() {
      vNormal = normalize(normalMatrix * normal);
      vPosition = position;
      vec4 worldPosition = modelMatrix * vec4(position, 1.0);
      vWorldPosition = worldPosition.xyz;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform vec3 glowColor;
    uniform float intensity;
    uniform float power;
    uniform vec3 sunPosition;
    uniform float atmosphereThickness;
    
    varying vec3 vNormal;
    varying vec3 vPosition;
    varying vec3 vWorldPosition;
    
    void main() {
      vec3 viewDirection = normalize(cameraPosition - vWorldPosition);
      float fresnel = pow(1.0 - abs(dot(viewDirection, vNormal)), power);
      
      vec3 sunDir = normalize(sunPosition - vWorldPosition);
      float sunInfluence = max(0.0, dot(vNormal, sunDir));
      float backScatter = pow(max(0.0, dot(-viewDirection, sunDir)), 3.0) * 0.3;
      
      float totalIntensity = intensity * fresnel * (0.6 + sunInfluence * 0.4 + backScatter);
      
      vec3 finalColor = glowColor * totalIntensity;
      float alpha = fresnel * intensity * 0.8;
      
      gl_FragColor = vec4(finalColor, alpha);
    }
  `},bt=(t,e)=>{const{color:o=8965375,thickness:a=50,intensity:s=1,power:r=2.5,layers:c=2}=e,i=new W,n=new ve(o);for(let d=0;d<c;d++){const g=t+a*(.3+d/c*.7),b=s*(1-d*.3),C=r+d*.5,u=new X(g,48,48),v=new me({vertexShader:ze.vertexShader,fragmentShader:ze.fragmentShader,uniforms:{glowColor:{value:n},intensity:{value:b},power:{value:C},sunPosition:{value:new f(0,0,0)},atmosphereThickness:{value:a}},transparent:!0,blending:fe,side:de,depthWrite:!1}),m=new x(u,v);m.userData.isAtmosphereLayer=!0,i.add(m)}const l=xt(t,n,s);return i.add(l),i},xt=(t,e,o)=>{const a=new X(t*1.02,48,48),s=new me({vertexShader:`
      varying vec3 vNormal;
      varying vec3 vViewPosition;
      
      void main() {
        vNormal = normalize(normalMatrix * normal);
        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
        vViewPosition = -mvPosition.xyz;
        gl_Position = projectionMatrix * mvPosition;
      }
    `,fragmentShader:`
      uniform vec3 glowColor;
      uniform float intensity;
      
      varying vec3 vNormal;
      varying vec3 vViewPosition;
      
      void main() {
        vec3 viewDir = normalize(vViewPosition);
        float rim = 1.0 - max(0.0, dot(viewDir, vNormal));
        rim = pow(rim, 3.0);
        
        vec3 finalColor = glowColor * rim * intensity * 0.5;
        float alpha = rim * intensity * 0.4;
        
        gl_FragColor = vec4(finalColor, alpha);
      }
    `,uniforms:{glowColor:{value:e},intensity:{value:o}},transparent:!0,blending:fe,side:Ie,depthWrite:!1});return new x(a,s)},Mt=(t,e)=>{t.children.forEach(o=>{o.material&&o.material.uniforms&&o.material.uniforms.sunPosition&&o.material.uniforms.sunPosition.value.copy(e)})},St={木炉星:{color:8965375,thickness:175,intensity:.8,power:2,layers:3},脆壳星:{color:10066363,thickness:50,intensity:.5,power:2.5,layers:2},深巨星:{color:6728328,thickness:450,intensity:1.2,power:1.8,layers:4},黑棘星:{color:11189162,thickness:250,intensity:.6,power:2.2,layers:2},量子卫星:{color:13421823,thickness:130,intensity:.7,power:2,layers:2}},Ve={vertexShader:`
    varying vec2 vUv;
    varying vec3 vNormal;
    varying vec3 vViewPosition;
    
    void main() {
      vUv = uv;
      vNormal = normalize(normalMatrix * normal);
      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
      vViewPosition = -mvPosition.xyz;
      gl_Position = projectionMatrix * mvPosition;
    }
  `,fragmentShader:`
    uniform float time;
    uniform vec3 color1;
    uniform vec3 color2;
    
    varying vec2 vUv;
    varying vec3 vNormal;
    varying vec3 vViewPosition;
    
    float noise(vec2 p) {
      return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453);
    }
    
    void main() {
      vec3 viewDir = normalize(vViewPosition);
      float rim = 1.0 - max(0.0, dot(viewDir, vNormal));
      rim = pow(rim, 1.5);
      
      float flicker = 0.8 + 0.2 * sin(time * 3.0 + vUv.x * 10.0) * sin(time * 2.0 + vUv.y * 8.0);
      float noise1 = noise(vUv * 20.0 + time * 0.5);
      
      vec3 finalColor = mix(color1, color2, rim) * (1.0 + noise1 * 0.2) * flicker;
      float alpha = rim * 0.8;
      
      gl_FragColor = vec4(finalColor, alpha);
    }
  `},kt=t=>{const e=new W,o=new X(t*1.15,64,64),a=new me({vertexShader:Ve.vertexShader,fragmentShader:Ve.fragmentShader,uniforms:{time:{value:0},color1:{value:new ve(16755251)},color2:{value:new ve(16737792)}},transparent:!0,blending:fe,side:de,depthWrite:!1});e.add(new x(o,a));const s=new X(t*1.4,32,32),r=new J({color:16729088,transparent:!0,opacity:.15,side:de});e.add(new x(s,r));const c=new X(t*2,32,32),i=new J({color:16720384,transparent:!0,opacity:.05,side:de});return e.add(new x(c,i)),e},Pt=(t,e)=>{t.children.forEach(o=>{o.material&&o.material.uniforms&&o.material.uniforms.time&&(o.material.uniforms.time.value=e)})},Ct=(t,e=6710886)=>{const o=new Xe(t,0),a=new T({color:e,roughness:.9,metalness:.1});return new x(o,a)},Rt=(t,e,o=4863784,a=2972199)=>{const s=new W,r=new se(t*.1,t*.15,t,6),c=new T({color:o,roughness:.9}),i=new x(r,c);i.position.y=t/2,s.add(i);const n=new He(e,1),l=new T({color:a,roughness:.8}),d=new x(n,l);return d.position.y=t+e*.5,s.add(d),s},At=(t,e,o,a=9139029)=>{const s=new W,r=new he(t,e,o),c=new T({color:a,roughness:.7}),i=new x(r,c);i.position.y=e/2,s.add(i);const n=new ue(t*.8,e*.4,4),l=new T({color:5917242,roughness:.8}),d=new x(n,l);return d.position.y=e+e*.2,d.rotation.y=Math.PI/4,s.add(d),s},Dt=(t,e=8943462)=>{const o=new W,a=new he(t*.3,t*.1,t*.3),s=new T({color:e,roughness:.6}),r=new x(a,s);r.position.y=t*.05,o.add(r);const c=new he(t*.15,t*.8,t*.15),i=new x(c,s);i.position.y=t*.5,o.add(i);const n=new Ee(t*.12,0),l=new T({color:11193599,emissive:4482730,emissiveIntensity:.5,roughness:.3}),d=new x(n,l);return d.position.y=t*.95,o.add(d),o},zt=(t,e=12888194)=>{const o=new W,a=new se(t*.15,t*.2,t,8),s=new T({color:e,roughness:.7}),r=new x(a,s);r.position.y=t/2,o.add(r);const c=new ue(t*.2,t*.3,8),i=new x(c,s);return i.position.y=t+t*.15,o.add(i),o},Vt=(t,e=8969727)=>{const o=new W,a=new Ee(t,0),s=new T({color:e,emissive:e,emissiveIntensity:.3,roughness:.2,metalness:.8,transparent:!0,opacity:.8}),r=new x(a,s);return r.scale.y=2,o.add(r),o},Gt=(t,e=2771514)=>{const o=new W,a=new ue(t*.3,t,5),s=new T({color:e,roughness:.8}),r=new x(a,s);r.position.y=t/2,o.add(r);for(let c=0;c<3;c++){const i=new ue(t*.15,t*.5,4),n=new x(i,s);n.position.y=t*.3,n.position.x=Math.cos(c*Math.PI*2/3)*t*.2,n.position.z=Math.sin(c*Math.PI*2/3)*t*.2,n.rotation.z=Math.PI/6*(c%2===0?1:-1),o.add(n)}return o},_t=t=>{const e=new W,o=new X(t,16,16),a=new T({color:11206570,emissive:6750054,emissiveIntensity:.8,roughness:.3}),s=new x(o,a);e.add(s);const r=new X(t*2,16,16),c=new J({color:4521796,transparent:!0,opacity:.2}),i=new x(r,c);return e.add(i),e},Lt=t=>{const e=new W,o=new Ke(t,0),a=new T({color:13421806,emissive:8947882,emissiveIntensity:.4,roughness:.4,metalness:.6}),s=new x(o,a);return s.rotation.set(Math.random(),Math.random(),Math.random()),e.add(s),e},It=(t,e=8943462)=>{const o=new W;for(let c=0;c<4;c++){const i=t*(.5+Math.random()*.5),n=new se(t*.1,t*.12,i,6),l=new T({color:e,roughness:.8}),d=new x(n,l);d.position.x=Math.cos(c*Math.PI/2)*t*.4,d.position.z=Math.sin(c*Math.PI/2)*t*.4,d.position.y=i/2,o.add(d)}const a=new he(t,t*.1,t),s=new T({color:e,roughness:.8}),r=new x(a,s);return r.position.y=t*.05,o.add(r),o},Et=t=>{const e=new W,o=new se(t,t,t*.1,16),a=new T({color:5592405,roughness:.5,metalness:.3}),s=new x(o,a);s.position.y=t*.05,e.add(s);const r=new Re(t*.8,t*.05,8,32),c=new T({color:16755200,emissive:16746496,emissiveIntensity:.3}),i=new x(r,c);return i.rotation.x=Math.PI/2,i.position.y=t*.12,e.add(i),e},Tt=t=>{const e=new W,o=new se(t*.3,t*.4,t*.2,8),a=new T({color:4473924,roughness:.5,metalness:.5}),s=new x(o,a);s.position.y=t*.1,e.add(s);const r=new se(t*.1,t*.15,t*.8,8),c=new T({color:6710886,roughness:.4,metalness:.6}),i=new x(r,c);return i.position.y=t*.5,i.rotation.x=Math.PI/6,e.add(i),e},Ot=t=>{const e=new W,o=new se(t*.05,t*.05,t,8),a=new T({color:9127187}),s=new x(o,a);s.position.y=t/2,e.add(s);const r=new je(t*.4,t*.25),c=new T({color:5085818,side:ge,emissive:2976330,emissiveIntensity:.2}),i=new x(r,c);return i.position.y=t*.85,i.position.x=t*.2,e.add(i),e},Qt=t=>{const e=new W,o=new Re(t,t*.2,8,16),a=new T({color:5592405,roughness:.9}),s=new x(o,a);return s.rotation.x=Math.PI/2,e.add(s),e},Ft=t=>{const e=new W,o=new Re(t,t*.1,8,32),a=new T({color:12888194,roughness:.5,metalness:.3}),s=new x(o,a);s.rotation.x=Math.PI/2,s.position.y=t,e.add(s);const r=new We(t*.85,32),c=new J({color:4482730,transparent:!0,opacity:.5,side:ge}),i=new x(r,c);i.rotation.x=Math.PI/2,i.position.y=t,e.add(i);const n=new se(t*.15,t*.2,t*.3,8),l=new x(n,a);return l.position.y=t*.15,e.add(l),e},Ue={余烬孪星:{landmarks:[{type:"ruin",count:3,sizeRange:[8,15],color:10518624},{type:"obelisk",count:5,sizeRange:[6,12]},{type:"rock",count:20,sizeRange:[2,6],color:12868666}]},灰烬孪星:{landmarks:[{type:"tower",count:4,sizeRange:[10,20],color:13943970},{type:"portal",count:2,sizeRange:[5,8]},{type:"rock",count:15,sizeRange:[2,5],color:15259043}]},木炉星:{landmarks:[{type:"building",count:8,sizeRange:[4,8]},{type:"tree",count:25,sizeRange:[5,12]},{type:"launchPad",count:1,sizeRange:[6,6]},{type:"telescope",count:2,sizeRange:[4,6]},{type:"rock",count:15,sizeRange:[1,4]}]},废墟月亮:{landmarks:[{type:"crater",count:5,sizeRange:[3,8]},{type:"ruin",count:2,sizeRange:[5,10],color:6710886},{type:"rock",count:20,sizeRange:[1,4],color:8947848}]},脆壳星:{landmarks:[{type:"tower",count:3,sizeRange:[12,18],color:9087690},{type:"ruin",count:4,sizeRange:[8,14],color:8035274},{type:"crystal",count:8,sizeRange:[3,7],color:6719692},{type:"rock",count:15,sizeRange:[2,5],color:5929898}]},深巨星:{landmarks:[{type:"islandMarker",count:6,sizeRange:[8,12]},{type:"tower",count:2,sizeRange:[15,25],color:6138506},{type:"rock",count:10,sizeRange:[3,8],color:5085818}]},黑棘星:{landmarks:[{type:"thorn",count:30,sizeRange:[8,20]},{type:"glowingSeed",count:15,sizeRange:[1,3]},{type:"rock",count:10,sizeRange:[3,8],color:3824202}]},闯入者:{landmarks:[{type:"crystal",count:12,sizeRange:[2,6],color:11202303},{type:"rock",count:10,sizeRange:[1,4],color:8969710}]},量子卫星:{landmarks:[{type:"quantumShard",count:20,sizeRange:[2,5]},{type:"obelisk",count:3,sizeRange:[5,10]},{type:"rock",count:10,sizeRange:[1,4],color:12237546}]}},Nt={rock:(t,e)=>Ct(t,e),tree:t=>Rt(t,t*.6),building:t=>At(t,t*1.5,t),obelisk:t=>Dt(t),tower:(t,e)=>zt(t,e),crystal:(t,e)=>Vt(t,e),thorn:t=>Gt(t),glowingSeed:t=>_t(t),quantumShard:t=>Lt(t),ruin:(t,e)=>It(t,e),launchPad:t=>Et(t),telescope:t=>Tt(t),islandMarker:t=>Ot(t),crater:t=>Qt(t),portal:t=>Ft(t)},Bt=(t,e,o)=>{const a=Ue[t];a&&a.landmarks.forEach(s=>{const{type:r,count:c,sizeRange:i,color:n}=s,l=Nt[r];if(l)for(let d=0;d<c;d++){const g=i[0]+Math.random()*(i[1]-i[0]),b=l(g,n),C=Math.random()*Math.PI*2,u=Math.acos(2*Math.random()-1),v=Math.sin(u)*Math.cos(C),m=Math.sin(u)*Math.sin(C),h=Math.cos(u),M=new f(v,m,h).multiplyScalar(e);b.position.copy(M);const w=M.clone().normalize(),p=new f(0,1,0),k=new Y().setFromUnitVectors(p,w);b.quaternion.copy(k),b.rotateY(Math.random()*Math.PI*2),o.add(b)}})},qt=()=>{const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d"),o=e.createRadialGradient(32,32,0,32,32,32);return o.addColorStop(0,"rgba(255, 255, 255, 1)"),o.addColorStop(.15,"rgba(255, 255, 255, 1)"),o.addColorStop(.3,"rgba(255, 255, 255, 0.8)"),o.addColorStop(.5,"rgba(255, 255, 255, 0.4)"),o.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=o,e.fillRect(0,0,64,64),new Me(t)},Ut=()=>{const t=new Ae,e=[],o=[];for(let s=0;s<15e3;s++){const r=4e4+Math.random()*5e4,c=Math.random()*Math.PI*2,i=Math.acos(2*Math.random()-1);e.push(r*Math.sin(i)*Math.cos(c),r*Math.sin(i)*Math.sin(c),r*Math.cos(i));const n=Math.random();n<.1?o.push(1,.9,.7):n<.2?o.push(.85,.95,1):o.push(1,1,1)}t.setAttribute("position",new be(e,3)),t.setAttribute("color",new be(o,3));const a=new $e({size:2.5,map:qt(),vertexColors:!0,transparent:!0,opacity:1,sizeAttenuation:!0,depthWrite:!1,blending:fe});return new Ye(t,a)},Wt=t=>{const e=new W,o=t.name==="木炉星"?0:Math.random()*Math.PI*2;e.userData={...t,angle:o};const a=t.isStar||qe[t.name]?64:32,s=new X(t.size,a,a);let r;if(t.isStar)r=new J({color:t.color});else{const n=gt(t.name);n?r=new T({map:n.diffuseMap,normalMap:n.normalMap,normalScale:new Ze(1.5,1.5),roughnessMap:n.roughnessMap,roughness:.7,metalness:.1,emissive:new ve(t.emissive),emissiveIntensity:.15}):r=new T({color:t.color,emissive:t.emissive,emissiveIntensity:.4,roughness:.6,metalness:.2})}const c=new x(s,r);if(e.add(c),e.userData.mesh=c,!t.isStar){const n=new W;Ue[t.name]&&Bt(t.name,t.size,n),c.add(n)}let i=null;if(t.isStar){i=kt(t.size),e.add(i);const n=new Te(16768392,3,5e4);e.add(n)}if(t.hasAtmosphere&&t.atmosphereThickness){const n=St[t.name];if(n){const l=bt(t.size,n);l.userData.isAtmosphere=!0,e.add(l),e.userData.atmosphere=l}else{const l=t.size+t.atmosphereThickness,d=new X(l,48,48),g=new J({color:t.atmosphereColor,transparent:!0,opacity:.12,side:de});e.add(new x(d,g))}}if(t.hasBlackHole){const n=t.blackHoleSize||t.size*.15,l=new X(n,32,32),d=new J({color:0}),g=new x(l,d);g.position.set(0,0,0),e.add(g);const b=new Je(n*1.2,n*2.5,64),C=new me({vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        varying vec2 vUv;
        void main() {
          float dist = length(vUv - 0.5) * 2.0;
          float alpha = smoothstep(0.0, 0.5, dist) * smoothstep(1.0, 0.6, dist);
          vec3 color = mix(vec3(0.5, 0.3, 1.0), vec3(0.2, 0.1, 0.5), dist);
          gl_FragColor = vec4(color, alpha * 0.7);
        }
      `,transparent:!0,side:ge,depthWrite:!1,blending:fe}),u=new x(b,C);u.rotation.x=Math.PI/2,e.add(u);const v=new X(n*1.8,32,32),m=new J({color:4465322,transparent:!0,opacity:.25,side:de});e.add(new x(v,m))}if(t.isComet){const n=new ue(t.size*.6,t.size*5,8),l=new J({color:6741503,transparent:!0,opacity:.3,side:ge}),d=new x(n,l);d.rotation.x=Math.PI/2,d.position.z=t.size*2.5,e.add(d),e.userData.tail=d}if(t.isQuantum){const n=t.size+(t.atmosphereThickness||130),l=new X(n,48,48),d=new me({vertexShader:`
        varying vec3 vNormal;
        varying vec3 vViewPosition;
        void main() {
          vNormal = normalize(normalMatrix * normal);
          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
          vViewPosition = -mvPosition.xyz;
          gl_Position = projectionMatrix * mvPosition;
        }
      `,fragmentShader:`
        varying vec3 vNormal;
        varying vec3 vViewPosition;
        void main() {
          vec3 viewDir = normalize(vViewPosition);
          float rim = 1.0 - abs(dot(viewDir, vNormal));
          float density = 0.85 + rim * 0.15;
          vec3 fogColor = vec3(0.35, 0.35, 0.4);
          gl_FragColor = vec4(fogColor, density);
        }
      `,transparent:!0,side:Ie,depthWrite:!1}),g=new x(l,d);e.add(g);const b=new X(t.size*1.05,32,32),C=new J({color:4473941,transparent:!0,opacity:.95});e.add(new x(b,C));const u=new X(n*1.08,32,32),v=new J({color:5592422,transparent:!0,opacity:.1,side:de});e.add(new x(u,v))}return{group:e,sunCoronaGroup:i}},Ge=(t,e=!1)=>{const a=new Ae,s=[];for(let i=0;i<=128;i++){const n=i/128*Math.PI*2;s.push(Math.cos(n)*t,0,Math.sin(n)*t)}a.setAttribute("position",new be(s,3));const r=e?new Oe({color:4478310,transparent:!0,opacity:.3,dashSize:2,gapSize:1}):new et({color:3359829,transparent:!0,opacity:.25}),c=new Qe(a,r);return e&&c.computeLineDistances(),c},jt=(t,e)=>{const a=new Ae,s=[],r=Math.sqrt(t*t-e*e);for(let n=0;n<=128;n++){const l=n/128*Math.PI*2;s.push(Math.cos(l)*t-r,0,Math.sin(l)*e)}a.setAttribute("position",new be(s,3));const c=new Oe({color:4491434,transparent:!0,opacity:.35,dashSize:1.5,gapSize:1}),i=new Qe(a,c);return i.computeLineDistances(),i},Kt=t=>{const e=new W,o=new ue(1.5,6,8),a=new T({color:13404228,emissive:4465169,emissiveIntensity:.3,roughness:.4,metalness:.6}),s=new x(o,a);s.rotation.x=Math.PI/2,e.add(s);const r=new he(8,.3,2),c=new T({color:8939059,roughness:.5,metalness:.4}),i=new x(r,c);i.position.z=1,e.add(i);const n=new X(1,16,16,0,Math.PI*2,0,Math.PI/2),l=new T({color:8965375,transparent:!0,opacity:.7,roughness:.1,metalness:.8}),d=new x(n,l);d.rotation.x=-Math.PI/2,d.position.z=-1.5,e.add(d);const g=new se(.8,1,1.5,8),b=new T({color:4473924,roughness:.3,metalness:.8}),C=new x(g,b);C.rotation.x=Math.PI/2,C.position.z=3.5,e.add(C);const u=(h,M,w=1)=>{const p=new ue(.5*w,2*w,8),k=new J({color:16737792,transparent:!0,opacity:0,depthTest:!1}),S=new x(p,k);return S.position.copy(h),S.rotation.set(M.x,M.y,M.z),S.renderOrder=999,e.add(S),S},v={back:u(new f(0,0,5),new f(-Math.PI/2,0,0),1.2),front:u(new f(0,0,-4),new f(Math.PI/2,0,0),.8),left:u(new f(2,0,0),new f(0,0,Math.PI/2),.6),right:u(new f(-2,0,0),new f(0,0,-Math.PI/2),.6),bottom:u(new f(0,2,1),new f(0,0,0),.6),top:u(new f(0,-2,1),new f(Math.PI,0,0),.6)};e.userData.thrusters=v;const m=new Te(16777130,.5,50);return m.position.set(0,0,-2.5),e.add(m),e.position.copy(t),e},_e=(t,e)=>{const o=t==null?void 0:t.userData.thrusters;if(!o)return;const a=.8+Math.random()*.4;o.back.material.opacity=e.forward?.9:0,e.forward&&(o.back.scale.y=a),o.front.material.opacity=e.backward?.8:0,e.backward&&(o.front.scale.y=a),o.left.material.opacity=e.left?.7:0,e.left&&(o.left.scale.y=a),o.right.material.opacity=e.right?.7:0,e.right&&(o.right.scale.y=a),o.top.material.opacity=e.up?.7:0,e.up&&(o.top.scale.y=a),o.bottom.material.opacity=e.down?.7:0,e.down&&(o.bottom.scale.y=a)},Ht=(t,e)=>{const o=new f;return e.forEach(a=>{const s=a.userData;if(!s.mass)return;const r=new f().subVectors(a.position,t),c=r.length();if(c<s.size)return;const i=ht*s.mass/(c*c);r.normalize().multiplyScalar(i),o.add(r)}),o},ke=(t,e)=>{let o=null,a=1/0;return e.forEach(s=>{const r=s.userData;if(r.isStar)return;const c=t.distanceTo(s.position)-r.size;c<a&&(a=c,o=s)}),{body:o,distance:a}},ce=(t,e,o)=>{const a=t.userData;if(a.isStar)return new f(0,0,0);const s=t.position.clone(),r=.016;let c,i;if(a.isComet&&a.orbitA&&a.orbitB){const n=Math.sqrt(a.orbitA*a.orbitA-a.orbitB*a.orbitB),l=a.angle+a.orbitSpeed*r*60;c=Math.cos(l)*a.orbitA-n,i=Math.sin(l)*a.orbitB}else if(a.isTwin){const n=o+Be*r*60,l=Math.cos(n)*a.orbitRadius,d=Math.sin(n)*a.orbitRadius,g=400,b=n*10;c=l+Math.cos(b)*g*a.twinSide,i=d+Math.sin(b)*g*a.twinSide}else if(a.moonOf){const n=e.find(l=>l.userData.name===a.moonOf);if(n){const l=ce(n,e,o),d=(a.moonAngle||0)+a.moonOrbitSpeed*r*60,g=-Math.sin(d)*a.moonOrbitRadius*a.moonOrbitSpeed*60,b=Math.cos(d)*a.moonOrbitRadius*a.moonOrbitSpeed*60;return new f(l.x+g,0,l.z+b)}return new f(0,0,0)}else if(a.orbitRadius){const n=a.angle+a.orbitSpeed*r*60;c=Math.cos(n)*a.orbitRadius,i=Math.sin(n)*a.orbitRadius}else return new f(0,0,0);return new f((c-s.x)/r,0,(i-s.z)/r)},Le=(t,e,o,a,s)=>{let r=o+Be*t*60,c=s;return e.forEach(i=>{const n=i.userData;if(n.isQuantum){const l=Ce[a],d=e.find(g=>g.userData.name===l);d&&(c+=n.moonOrbitSpeed*t*60,i.position.x=d.position.x+Math.cos(c)*n.moonOrbitRadius,i.position.y=Math.sin(c)*n.moonOrbitRadius*.3,i.position.z=d.position.z+Math.sin(c)*n.moonOrbitRadius);return}if(n.moonOf){const l=e.find(d=>d.userData.name===n.moonOf);l&&(n.moonAngle=(n.moonAngle||0)+n.moonOrbitSpeed*t*60,i.position.x=l.position.x+Math.cos(n.moonAngle)*n.moonOrbitRadius,i.position.y=Math.sin(n.moonAngle)*n.moonOrbitRadius*.2,i.position.z=l.position.z+Math.sin(n.moonAngle)*n.moonOrbitRadius);return}if(n.orbitRadius>0||n.isComet)if(n.angle+=n.orbitSpeed*t*60,n.isComet&&n.orbitA&&n.orbitB){const l=Math.sqrt(n.orbitA*n.orbitA-n.orbitB*n.orbitB);if(i.position.x=Math.cos(n.angle)*n.orbitA-l,i.position.z=Math.sin(n.angle)*n.orbitB,n.tail){const d=n.orbitA*Math.sin(n.angle),g=-n.orbitB*Math.cos(n.angle);i.rotation.y=Math.atan2(d,g)}}else if(n.isTwin){const l=Math.cos(r)*n.orbitRadius,d=Math.sin(r)*n.orbitRadius,g=400,b=r*10;i.position.x=l+Math.cos(b)*g*n.twinSide,i.position.z=d+Math.sin(b)*g*n.twinSide}else i.position.x=Math.cos(n.angle)*n.orbitRadius,i.position.z=Math.sin(n.angle)*n.orbitRadius;n.mesh&&n.rotationSpeed&&(n.mesh.rotation.y+=n.rotationSpeed*t*60)}),{twinSystemAngle:r,quantumAngle:c}};let Pe=0;const Xt=t=>{const e=Se({position:new f().copy(t),velocity:new f(0,0,0),rotation:new Fe(0,0,0),thrust:50,rotationSpeed:2,maxSpeed:500,fuel:100,isLanded:!1,landedOn:null,landedLocalDir:null,landedLocalQuaternion:new Y,isMatchingVelocity:!1,targetVelocity:new f(0,0,0),matchingTarget:null,initialVelocityDiff:0}),o=Se({forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1,rollLeft:!1,rollRight:!1,pitchUp:!1,pitchDown:!1,boost:!1,matchVelocity:!1}),a=Se({speed:0,altitude:0,nearestBody:null,nearestDistance:0,isThrusting:!1,isMatchingVelocity:!1,matchingProgress:0}),s=ye("first");let r=null;const c=u=>{r=u},i=(u,v)=>{if(e.isMatchingVelocity){e.isMatchingVelocity=!1,e.matchingTarget=null,e.initialVelocityDiff=0;return}const m=ke(e.position,u);m.body&&(e.isMatchingVelocity=!0,e.matchingTarget=m.body,e.targetVelocity.copy(ce(m.body,u,v)),e.initialVelocityDiff=new f().subVectors(e.targetVelocity,e.velocity).length())},n=(u,v,m)=>{if(!e.isMatchingVelocity||!e.matchingTarget)return;const h=ce(e.matchingTarget,v,m);e.targetVelocity.copy(h);const M=new f().subVectors(e.targetVelocity,e.velocity),w=M.length();if(w<.5){e.velocity.copy(e.targetVelocity),e.isMatchingVelocity=!1,e.matchingTarget=null;return}const k=25*u;if(w<=k)e.velocity.copy(e.targetVelocity);else{const S=M.normalize().multiplyScalar(k);e.velocity.add(S)}a.matchingProgress=(1-w/e.initialVelocityDiff)*100},l=(u,v)=>{if(!e.isLanded||!e.landedOn)return;const m=e.landedOn,h=new f().subVectors(e.position,m.position).normalize(),M=ce(m,u,v);e.velocity.copy(M).add(h.multiplyScalar(5));const w=m.userData.rotationSpeed||0,p=m.userData.size+.5,k=new f(0,1,0),S=new f(h.x,0,h.z);if(S.lengthSq()>.001){S.normalize();const A=new f().crossVectors(k,S).normalize(),L=Math.sqrt(h.x*h.x+h.z*h.z)*p*w;e.velocity.add(A.multiplyScalar(L))}e.isLanded=!1,e.landedOn=null,e.landedLocalDir=null};return{ship:e,controls:o,hud:a,viewMode:s,setShipMesh:c,matchVelocityWithNearest:i,launch:l,updateShip:(u,v,m)=>{var I;if(Pe=m,e.isLanded&&e.landedOn){const V=e.landedOn,D=V.userData.mesh,z=D?D.rotation.y:0,R=new Y().setFromAxisAngle(new f(0,1,0),z),B=e.landedLocalDir.clone().applyQuaternion(R);e.position.copy(V.position).add(B.multiplyScalar(V.userData.size+.5));const _=R.clone().multiply(e.landedLocalQuaternion);if(e.rotation.setFromQuaternion(_),a.speed="0",a.altitude="0",o.forward||o.backward||o.left||o.right){const N=7*(o.boost?3:1)*u,q=(o.forward?1:0)-(o.backward?1:0),$=(o.right?1:0)-(o.left?1:0),O=new f(0,0,-1).applyQuaternion(e.landedLocalQuaternion),G=new f(1,0,0).applyQuaternion(e.landedLocalQuaternion),K=new f().addScaledVector(O,q).addScaledVector(G,$).normalize();if(K.lengthSq()>.001){const E=e.landedLocalDir.clone().normalize(),Q=new f().crossVectors(E,K).normalize(),j=N/(V.userData.size+.5),U=new Y().setFromAxisAngle(Q,j);e.landedLocalDir.applyQuaternion(U),e.landedLocalQuaternion.premultiply(U)}}o.up&&l(v,m),r&&(r.position.copy(e.position),r.rotation.copy(e.rotation),_e(r,o));return}const h=new Y().setFromEuler(e.rotation),M=new f(0,0,-1).applyQuaternion(h),w=new f(1,0,0).applyQuaternion(h),p=new f(0,1,0).applyQuaternion(h),k=o.boost?2.5:1;o.forward&&e.velocity.add(M.clone().multiplyScalar(e.thrust*k*u)),o.backward&&e.velocity.add(M.clone().multiplyScalar(-e.thrust*.5*u)),o.left&&e.velocity.add(w.clone().multiplyScalar(-e.thrust*.5*u)),o.right&&e.velocity.add(w.clone().multiplyScalar(e.thrust*.5*u)),o.up&&e.velocity.add(p.clone().multiplyScalar(e.thrust*.5*u)),o.down&&e.velocity.add(p.clone().multiplyScalar(-e.thrust*.5*u));const S=Ht(e.position,v);e.velocity.add(S.multiplyScalar(u)),n(u,v,m),e.velocity.length()>e.maxSpeed&&e.velocity.normalize().multiplyScalar(e.maxSpeed),e.position.add(e.velocity.clone().multiplyScalar(u)),r&&(r.position.copy(e.position),r.rotation.copy(e.rotation),_e(r,o));const P=ke(e.position,v);let L=e.velocity.length();if(P.body){const V=ce(P.body,v,Pe);L=new f().subVectors(e.velocity,V).length()}if(a.speed=L.toFixed(0),a.nearestBody=((I=P.body)==null?void 0:I.userData.name)||null,a.nearestDistance=P.distance.toFixed(0),a.altitude=P.distance.toFixed(0),a.isThrusting=o.forward||o.backward||o.left||o.right||o.up||o.down,a.isMatchingVelocity=e.isMatchingVelocity,P.distance<.5&&P.body){e.isLanded=!0,e.landedOn=P.body;const V=P.body.userData.mesh?P.body.userData.mesh.rotation.y:0;e.landedLocalDir=new f().subVectors(e.position,P.body.position).normalize(),e.landedLocalDir.applyAxisAngle(new f(0,1,0),-V);const D=new Y().setFromEuler(e.rotation),z=new Y().setFromAxisAngle(new f(0,1,0),V);e.landedLocalQuaternion.copy(z.invert().multiply(D));const R=ce(P.body,v,Pe);e.velocity.copy(R)}},updateCamera:(u,v)=>{const m=new Y;m.setFromEuler(e.rotation),new f(0,0,-1).applyQuaternion(m);const h=new f(0,1,0).applyQuaternion(m),M=new f(0,0,1).applyQuaternion(m);if(s.value==="first")u.position.copy(e.position),u.quaternion.copy(m),r&&(r.visible=!1);else if(s.value==="third"){const w=M.clone().multiplyScalar(40).add(h.clone().multiplyScalar(15));u.position.copy(e.position).add(w),u.lookAt(e.position),r&&(r.visible=!0)}else if(s.value==="orbit"){const w=ke(e.position,v);if(w.body){const p=w.body.position.clone(),k=new f().subVectors(e.position,p).normalize();u.position.copy(p).add(k.multiplyScalar(w.body.userData.size*4+10)),u.lookAt(e.position),r&&(r.visible=!0)}}},handleMouseMove:(u,v)=>{if(!v)return;const m=.002;if(e.isLanded&&e.landedOn){const p=e.landedLocalDir.clone().normalize(),k=new f(0,0,-1).applyQuaternion(e.landedLocalQuaternion);let S=new f().crossVectors(k,p).normalize();if(S.lengthSq()<.001){const I=new f(0,1,0).applyQuaternion(e.landedLocalQuaternion);S=new f().crossVectors(I,p).normalize()}const A=new Y().setFromAxisAngle(p,-u.movementX*m),P=new Y().setFromAxisAngle(S,-u.movementY*m);e.landedLocalQuaternion.premultiply(A),e.landedLocalQuaternion.multiply(P);const L=new f(0,0,-1).applyQuaternion(e.landedLocalQuaternion);if(Math.abs(L.dot(p))<.999){const I=new f().crossVectors(L,p).normalize(),V=new f().crossVectors(p,I).normalize(),D=new tt().makeBasis(I,p,V.negate());e.landedLocalQuaternion.setFromRotationMatrix(D)}return}const h=new Y().setFromEuler(e.rotation),M=new Y().setFromAxisAngle(new f(0,1,0),-u.movementX*m),w=new Y().setFromAxisAngle(new f(1,0,0),-u.movementY*m);h.multiply(M),h.multiply(w),e.rotation.setFromQuaternion(h)},cycleViewMode:()=>{const u=["first","third","orbit"],v=u.indexOf(s.value);s.value=u[(v+1)%u.length]}}},$t={class:"backdrop-blur-sm bg-black/50 rounded-xl border border-cyan-500/30 p-4 min-w-[220px]"},Yt={class:"text-xs text-cyan-300/60 uppercase tracking-wider mb-3 flex items-center gap-2"},Zt={key:0,class:"px-1.5 py-0.5 bg-orange-500/30 text-orange-300 rounded text-[10px] animate-pulse"},Jt={key:1,class:"px-1.5 py-0.5 bg-cyan-500/30 text-cyan-300 rounded text-[10px] animate-pulse"},eo={class:"space-y-2 text-sm"},to={class:"flex justify-between"},oo={class:"text-cyan-100 font-mono"},no={class:"flex justify-between"},ao={class:"text-cyan-100 font-mono"},so={key:0,class:"flex justify-between"},io={class:"text-amber-200"},ro={key:1,class:"mt-2 pt-2 border-t border-cyan-500/20"},co={class:"flex justify-between items-center"},lo={class:"text-cyan-300 font-mono text-xs"},uo={class:"mt-1.5 h-1.5 bg-cyan-900/50 rounded-full overflow-hidden"},po={class:"mt-3 pt-3 border-t border-cyan-500/20"},mo={class:"flex justify-between text-xs"},ho={class:"text-cyan-100/80 font-mono text-[10px]"},wo={__name:"SpaceshipHUD",props:{hud:{type:Object,required:!0},ship:{type:Object,required:!0}},setup(t){return(e,o)=>{var a;return ee(),ne("div",$t,[y("div",Yt,[o[0]||(o[0]=Z(" 飞船状态 ",-1)),t.hud.isThrusting?(ee(),ne("span",Zt," 推进中 ")):le("",!0),t.hud.isMatchingVelocity?(ee(),ne("span",Jt," 速度同步 ")):le("",!0)]),y("div",eo,[y("div",to,[o[1]||(o[1]=y("span",{class:"text-cyan-200/60"},"速度",-1)),y("span",oo,ae(t.hud.speed)+" m/s",1)]),y("div",no,[o[2]||(o[2]=y("span",{class:"text-cyan-200/60"},"距离",-1)),y("span",ao,ae(t.hud.altitude)+" m",1)]),t.hud.nearestBody?(ee(),ne("div",so,[o[3]||(o[3]=y("span",{class:"text-cyan-200/60"},"最近天体",-1)),y("span",io,ae(t.hud.nearestBody),1)])):le("",!0),t.hud.isMatchingVelocity?(ee(),ne("div",ro,[y("div",co,[o[4]||(o[4]=y("span",{class:"text-cyan-200/60"},"同步中",-1)),y("span",lo,ae((a=t.ship.matchingTarget)==null?void 0:a.userData.name),1)]),y("div",uo,[y("div",{class:"h-full bg-gradient-to-r from-cyan-500 to-cyan-300 transition-all duration-150",style:rt({width:`${t.ship.initialVelocityDiff>.5?Math.max(0,100-Math.sqrt(Math.pow(t.ship.velocity.x-t.ship.targetVelocity.x,2)+Math.pow(t.ship.velocity.z-t.ship.targetVelocity.z,2))/t.ship.initialVelocityDiff*100):100}%`})},null,4)])])):le("",!0)]),y("div",po,[y("div",mo,[o[5]||(o[5]=y("span",{class:"text-cyan-200/60"},"坐标 (m)",-1)),y("span",ho,ae(Math.round(t.ship.position.x))+", "+ae(Math.round(t.ship.position.y))+", "+ae(Math.round(t.ship.position.z)),1)])])])}}},fo={key:0},yo={__name:"ControlsPanel",props:{visible:{type:Boolean,default:!0}},setup(t){return(e,o)=>(ee(),ct(lt,{"enter-active-class":"transition-all duration-300 ease-out","leave-active-class":"transition-all duration-200 ease-in","enter-from-class":"opacity-0 translate-x-4","leave-to-class":"opacity-0 translate-x-4"},{default:Ne(()=>[t.visible?(ee(),ne("div",fo,[...o[0]||(o[0]=[y("div",{class:"backdrop-blur-sm bg-black/50 rounded-xl border border-cyan-500/30 p-4 text-xs"},[y("div",{class:"text-cyan-300/60 uppercase tracking-wider mb-3"},"控制说明 (H 隐藏)"),y("div",{class:"grid grid-cols-2 gap-x-6 gap-y-1 text-cyan-200/80"},[y("div",null,[y("span",{class:"text-cyan-400"},"鼠标"),Z(" 视角控制")]),y("div",null,[y("span",{class:"text-cyan-400"},"点击"),Z(" 锁定鼠标")]),y("div",null,[y("span",{class:"text-cyan-400"},"W/S"),Z(" 前进/后退")]),y("div",null,[y("span",{class:"text-cyan-400"},"A/D"),Z(" 左移/右移")]),y("div",null,[y("span",{class:"text-cyan-400"},"Space"),Z(" 上升")]),y("div",null,[y("span",{class:"text-cyan-400"},"Ctrl"),Z(" 下降")]),y("div",null,[y("span",{class:"text-cyan-400"},"Q/E"),Z(" 左转/右转")]),y("div",null,[y("span",{class:"text-cyan-400"},"↑/↓"),Z(" 俯仰")]),y("div",null,[y("span",{class:"text-cyan-400"},"Shift"),Z(" 加速")]),y("div",null,[y("span",{class:"text-cyan-400"},"X"),Z(" 速度同步")]),y("div",null,[y("span",{class:"text-cyan-400"},"F"),Z(" 起飞")]),y("div",null,[y("span",{class:"text-cyan-400"},"V"),Z(" 切换视角")])])],-1)])])):le("",!0)]),_:1}))}},vo={class:"fixed inset-0 w-full h-full overflow-hidden bg-[#020206] outline-none",tabindex:"0"},go={key:0,class:"absolute inset-0 flex items-center justify-center z-50 bg-[#020206]"},bo={class:"absolute top-4 left-1/2 -translate-x-1/2 z-10"},xo={key:0,class:"px-4 py-2 rounded-lg bg-green-900/60 backdrop-blur-sm border border-green-400/50 text-green-200"},Mo={class:"absolute bottom-4 left-4 md:bottom-6 md:left-6 z-10 space-y-2"},So={class:"absolute bottom-4 right-4 md:bottom-6 md:right-6 z-10"},ko={class:"absolute bottom-4 left-1/2 -translate-x-1/2 z-10 flex gap-2"},Po={__name:"SpaceshipSimulator",setup(t){const e=ye(null),o=ye(!0),a=ye(!0);let s,r,c,i=null,n=0,l=[],d=Math.random()*Math.PI*2,g=0,b=0,C=null,u=new f(0,0,0),v=0,m=!1,h=null;const M=new f(8943,50,50),{ship:w,controls:p,hud:k,viewMode:S,setShipMesh:A,matchVelocityWithNearest:P,launch:L,updateShip:I,updateCamera:V,handleMouseMove:D,cycleViewMode:z}=Xt(M),R=()=>{s=new ot,r=new nt(45,e.value.clientWidth/e.value.clientHeight,.5,15e4),c=new at({antialias:!0,alpha:!0}),c.setSize(e.value.clientWidth,e.value.clientHeight),c.setPixelRatio(Math.min(window.devicePixelRatio,2)),c.toneMapping=st,c.toneMappingExposure=1,e.value.appendChild(c.domElement),s.add(Ut());const E=new it(3359829,.6);s.add(E);let Q=!1;wt.forEach(F=>{const{group:te,sunCoronaGroup:oe}=Wt(F);s.add(te),l.push(te),oe&&(C=oe),F.orbitRadius>0&&!F.isTwin&&!F.isComet&&!F.isQuantum&&s.add(Ge(F.orbitRadius)),F.isTwin&&!Q&&(s.add(Ge(F.orbitRadius)),Q=!0),F.isComet&&F.orbitA&&F.orbitB&&s.add(jt(F.orbitA,F.orbitB))}),h=Kt(w.position),A(h),s.add(h);const j=Le(.016,l,d,g,b);d=j.twinSystemAngle,b=j.quantumAngle;const U=l.find(F=>F.userData.name==="木炉星");if(U){const F=U.position,te=U.userData.size;w.position.set(F.x,F.y+te+.5,F.z),h.position.copy(w.position),w.isLanded=!0,w.landedOn=U,w.landedLocalDir=new f(0,1,0),w.landedBodyRotationY=U.userData.mesh?U.userData.mesh.rotation.y:0,w.landedRotation=new Fe(0,0,0),w.rotation.copy(w.landedRotation);const oe=ce(U,l,d);w.velocity.copy(oe)}o.value=!1},B=E=>{i=requestAnimationFrame(B);const Q=Math.min((E-n)/1e3,.1);n=E,v+=Q;const j=Le(Q,l,d,g,b);d=j.twinSystemAngle,b=j.quantumAngle,I(Q,l,d),V(r,l),C&&Pt(C,v),l.forEach(U=>{U.userData.atmosphere&&Mt(U.userData.atmosphere,u)}),c.render(s,r)},_=E=>{switch(E.code){case"KeyW":p.forward=!0;break;case"KeyS":p.backward=!0;break;case"KeyA":p.left=!0;break;case"KeyD":p.right=!0;break;case"Space":p.up=!0;break;case"ControlLeft":case"ControlRight":p.down=!0;break;case"KeyQ":p.rollLeft=!0;break;case"KeyE":p.rollRight=!0;break;case"ArrowUp":p.pitchUp=!0;break;case"ArrowDown":p.pitchDown=!0;break;case"ShiftLeft":case"ShiftRight":p.boost=!0;break;case"KeyX":P(l,d);break;case"KeyF":L(l,d);break;case"KeyH":a.value=!a.value;break;case"KeyV":z();break}},N=E=>{switch(E.code){case"KeyW":p.forward=!1;break;case"KeyS":p.backward=!1;break;case"KeyA":p.left=!1;break;case"KeyD":p.right=!1;break;case"Space":p.up=!1;break;case"ControlLeft":case"ControlRight":p.down=!1;break;case"KeyQ":p.rollLeft=!1;break;case"KeyE":p.rollRight=!1;break;case"ArrowUp":p.pitchUp=!1;break;case"ArrowDown":p.pitchDown=!1;break;case"ShiftLeft":case"ShiftRight":p.boost=!1;break}},q=()=>{e.value&&(r.aspect=e.value.clientWidth/e.value.clientHeight,r.updateProjectionMatrix(),c.setSize(e.value.clientWidth,e.value.clientHeight))},$=E=>{D(E,m)},O=()=>{m=document.pointerLockElement===e.value},G=()=>{!m&&e.value&&e.value.requestPointerLock()},K=()=>{if(document.visibilityState==="visible"){let E;do E=Math.floor(Math.random()*Ce.length);while(E===g&&Ce.length>1);g=E,b=Math.random()*Math.PI*2}};return ut(()=>{typeof window<"u"&&e.value&&(R(),n=performance.now(),B(n),window.addEventListener("resize",q),window.addEventListener("keydown",_),window.addEventListener("keyup",N),document.addEventListener("visibilitychange",K),document.addEventListener("pointerlockchange",O),document.addEventListener("mousemove",$),e.value.addEventListener("click",G),e.value.focus())}),pt(()=>{i&&cancelAnimationFrame(i),window.removeEventListener("resize",q),window.removeEventListener("keydown",_),window.removeEventListener("keyup",N),document.removeEventListener("visibilitychange",K),document.removeEventListener("pointerlockchange",O),document.removeEventListener("mousemove",$),e.value&&e.value.removeEventListener("click",G),c&&c.dispose()}),(E,Q)=>{var j;return ee(),ne("div",vo,[o.value?(ee(),ne("div",go,[...Q[1]||(Q[1]=[y("div",{class:"text-center"},[y("div",{class:"w-16 h-16 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),y("div",{class:"text-amber-200/80 text-lg tracking-widest font-light"},"初始化飞船系统...")],-1)])])):le("",!0),y("div",{ref_key:"containerRef",ref:e,class:"w-full h-full"},null,512),Q[2]||(Q[2]=De("",2)),y("div",bo,[ie(w).isLanded?(ee(),ne("div",xo," 已降落于 "+ae((j=ie(w).landedOn)==null?void 0:j.userData.name)+" · 按 Space 起飞 ",1)):le("",!0)]),y("div",Mo,[xe(wo,{hud:ie(k),ship:ie(w)},null,8,["hud","ship"])]),y("div",So,[xe(yo,{visible:a.value},null,8,["visible"])]),Q[3]||(Q[3]=De("",1)),y("div",ko,[y("button",{onClick:Q[0]||(Q[0]=(...U)=>ie(z)&&ie(z)(...U)),class:"px-3 py-1.5 rounded-lg bg-black/50 backdrop-blur-sm border border-cyan-500/30 text-cyan-200/80 text-xs hover:bg-cyan-900/30 hover:border-cyan-400/50 transition-all"}," 视角 (V): "+ae(ie(S)==="first"?"第一人称":ie(S)==="third"?"第三人称":"轨道"),1)])])}}},Co=dt(Po,[["__scopeId","data-v-1f365648"]]),zo=JSON.parse('{"title":"星际拓荒飞船模拟器","description":"","frontmatter":{"layout":false,"title":"星际拓荒飞船模拟器"},"headers":[],"relativePath":"workshop/spaceship-simulator.md","filePath":"workshop/spaceship-simulator.md"}'),Ro={name:"workshop/spaceship-simulator.md"},Vo=Object.assign(Ro,{setup(t){return(e,o)=>{const a=mt("ClientOnly");return ee(),ne("div",null,[xe(a,null,{default:Ne(()=>[xe(Co)]),_:1})])}}});export{zo as __pageData,Vo as default};
