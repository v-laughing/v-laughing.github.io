import{m as Z}from"./chunks/music-list.fErWNRzq.js";import{_ as Mt,p as l,h as y,q,v as Lt,x as St,c as o,o as r,j as n,e as b,t as v,F as tt,B as et,n as C,P as jt,G as Ct}from"./chunks/framework.DQcV7ckZ.js";const Rt={class:"relative h-[calc(100vh-var(--vp-nav-height))] overflow-hidden"},It={class:"relative mx-auto max-w-[1200px] h-full px-4 md:px-6 py-4 md:py-6 flex flex-col min-h-0"},Nt={class:"group relative mx-auto w-full max-w-[980px] flex-1 min-h-0"},Tt={class:"relative h-full flex flex-col min-h-0"},Pt={class:"shrink-0 px-5 md:px-8 pt-5 md:pt-6 pb-4 md:pb-5"},Et={class:"text-center text-[#f3e7dc] dark:text-gray-100"},At={key:0,class:"mt-3 text-xs md:text-sm text-[#f6e9de]/80 dark:text-white/70"},$t={class:"text-xl md:text-2xl font-semibold tracking-wide"},Ft={class:"mt-2 flex items-center justify-center gap-3 text-xs md:text-sm opacity-80 flex-wrap"},zt={class:"flex items-center gap-1.5"},Bt={class:"flex items-center gap-1.5"},Vt={key:1,class:"mt-2 text-xs opacity-70 flex items-center justify-center gap-4 flex-wrap"},Ut={key:0},qt={key:1},Ot={class:"flex-1 min-h-0 overflow-y-auto px-5 md:px-8 py-6 md:py-8 scroll-smooth hide-scrollbar"},Wt={class:"flex flex-col gap-6 md:gap-7"},Dt=["onClick"],Kt={class:"flex flex-col items-center gap-1.5"},Gt={class:"controls shrink-0 px-4 md:px-6 pb-3 md:pb-4 transition-opacity duration-300 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:pointer-events-auto"},Ht={class:"w-full flex justify-center"},Jt={class:"flex items-center gap-2.5 md:gap-3.5 w-[min(520px,100%)]"},Qt={key:0,class:"w-5 h-5 md:w-5 md:h-5 text-[#f6e9de] dark:text-white",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},Xt={key:1,class:"w-5 h-5 md:w-5 md:h-5 text-[#f6e9de] dark:text-white ml-0.5",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},Yt={class:"flex-1 min-w-0 max-w-[360px]"},Zt=["max","value","disabled"],te={class:"-mt-0.5 flex items-center justify-between text-[11px] md:text-xs text-[#f6e9de]/70 dark:text-white/60"},ee=["aria-expanded"],ne={key:0,class:"absolute right-0 bottom-[calc(100%+10px)] w-[min(90vw,280px)] rounded-2xl border border-white/15 bg-[#1a1410]/95 dark:bg-gray-900/95 backdrop-blur-xl shadow-2xl shadow-black/30 ring-1 ring-white/10 p-3 md:p-4 text-[#f6e9de] dark:text-gray-100 transition-colors duration-300"},ae={class:"mt-4 flex flex-col gap-4"},ie={class:"flex flex-col gap-2"},se={class:"flex items-center justify-between text-xs opacity-80"},oe={class:"tabular-nums"},re=["value"],le={class:"flex flex-col gap-2"},ue={class:"flex items-center justify-between text-xs opacity-80"},de={class:"tabular-nums"},ce={class:"flex flex-wrap gap-2"},me=["onClick"],ve={class:"flex flex-col gap-2"},fe={class:"flex items-center justify-between text-xs opacity-80"},pe={class:"tabular-nums"},xe={key:0},he={key:1},we={key:2},ye={class:"flex flex-wrap gap-2"},be=["src"],ge={key:0,class:"mt-3 text-center text-sm text-white/70"},ke={__name:"LyricMusicPlayer",setup(nt){const f=Array.isArray(Z)?Z:[],x=l(""),g=y(()=>f.length?f.find(e=>(e==null?void 0:e.id)===x.value)||f[0]:null),at=y(()=>x.value?f.length?!f.some(e=>(e==null?void 0:e.id)===x.value):!0:!1),it=y(()=>{var e;return((e=g.value)==null?void 0:e.title)||"未知歌曲"}),st=y(()=>{var e;return((e=g.value)==null?void 0:e.artist)||"未知歌手"}),ot=y(()=>{var e;return((e=g.value)==null?void 0:e.album)||""}),rt=y(()=>{var t;const e=(t=g.value)==null?void 0:t.audio;return e?new URL(e,import.meta.url).href:""}),lt=y(()=>{var t;const e=(t=g.value)==null?void 0:t.lrc;return e?new URL(e,import.meta.url).href:""}),p=l(null),R=l([]),k=l(""),_=l(""),$=l(!1),F=l(!1),I=l(0),N=l(0),M=l(!1),O=l(null),L=l(20),S=l(1),ut=[.5,.75,1,1.25,1.5,2],h=l("order"),w=l(-1),T=l([]),W=l(!1),dt=y(()=>!f.length||!g.value?-1:f.findIndex(e=>{var t;return(e==null?void 0:e.id)===((t=g.value)==null?void 0:t.id)}));function P(e,t,a){return Number.isFinite(e)?Math.min(a,Math.max(t,e)):t}function D(e){if(!Number.isFinite(e)||e<0)return"00:00";const t=Math.floor(e),a=Math.floor(t/60),i=t%60;return`${String(a).padStart(2,"0")}:${String(i).padStart(2,"0")}`}function ct(e){const t=String(e||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`),a=/\[(\d{2}):(\d{2})(?:[.:](\d{1,3}))?\]/g,i=[];for(const s of t){const u=String(s||""),d=[];let c;for(;(c=a.exec(u))!==null;){const m=Number(c[1]),kt=Number(c[2]),_t=c[3]?Number(c[3].padEnd(3,"0")):0,Y=m*60*1e3+kt*1e3+_t;Number.isFinite(Y)&&d.push(Y)}if(!d.length)continue;const j=u.replace(a,"").trimEnd();for(const m of d)i.push({timeMs:m,time:m/1e3,text:j||" "})}return i.sort((s,u)=>s.timeMs-u.timeMs),i}function mt(e){const t=String(e||"").trim(),a=t.match(/^作词\s*[:：]\s*(.+)$/);if(a)return{type:"lyricist",value:a[1].trim()};const i=t.match(/^作曲\s*[:：]\s*(.+)$/);return i?{type:"composer",value:i[1].trim()}:null}function vt(e){const t=String(e||"").trim();if(!t)return{kind:"empty",value:""};const a=mt(t);if(a)return{kind:a.type,value:a.value};const i=t.match(/^R\s*[:：]\s*(.*)$/i);if(i)return{kind:"romaji",value:(i[1]||"").trim()};const s=t.match(/^T\s*[:：]\s*(.*)$/i);return s?{kind:"trans",value:(s[1]||"").trim()}:{kind:"main",value:t}}function ft(e){const t=R.value;if(!t.length)return-1;let a=0,i=t.length-1,s=-1;for(;a<=i;){const u=a+i>>1;t[u].time<=e+.03?(s=u,a=u+1):i=u-1}return s}async function pt(e){const t=String(e||"").trim();if(!t){R.value=[],w.value=-1,T.value=[],k.value="",_.value="";return}const i=await(await fetch(t)).text(),s=ct(i);k.value="",_.value="";const u=new Map;for(const d of s){const{kind:c,value:j}=vt(d.text);if(c==="lyricist"){k.value=j;continue}if(c==="composer"){_.value=j;continue}if(c==="empty")continue;let m=u.get(d.timeMs);m||(m={time:d.time,timeMs:d.timeMs,main:"",romaji:"",trans:""},u.set(d.timeMs,m)),c==="main"&&!m.main&&(m.main=j),c==="romaji"&&!m.romaji&&(m.romaji=j),c==="trans"&&!m.trans&&(m.trans=j)}R.value=Array.from(u.values()).sort((d,c)=>d.timeMs-c.timeMs).filter(d=>String(d.main||"").trim()||String(d.romaji||"").trim()||String(d.trans||"").trim()),w.value=-1,T.value=[]}function xt(){const e=p.value;if(!e)return;N.value=e.currentTime||0;const t=ft(N.value);t!==w.value&&(w.value=t)}function ht(){const e=p.value;I.value=(e==null?void 0:e.duration)||0,$.value=!0}function wt(){const e=p.value;e&&(e.paused?e.play().catch(()=>{}):e.pause())}function z(e){const t=p.value;!t||!Number.isFinite(e)||(t.currentTime=Math.max(0,Math.min(e,I.value||e)))}function yt(){M.value=!M.value}function E(){M.value=!1}function B(){const e=p.value;e&&(e.volume=P(Number(L.value)/100,0,1))}function V(){const e=p.value;e&&(e.playbackRate=P(Number(S.value),.25,4))}function K(e){const t=f,a=t.length;if(!a)return;const i=(e%a+a)%a,s=t[i];if(!(!s||!s.id)){if(x.value=s.id,typeof window<"u")try{const u=new URL(window.location.href);u.searchParams.set("id",String(s.id)),window.history.pushState({},"",u)}catch{}U()}}function G(){if(typeof window>"u")return;const e=new URLSearchParams(window.location.search||"");x.value=e.get("id")||""}async function U(){const e=p.value;if(E(),$.value=!1,I.value=0,N.value=0,w.value=-1,T.value=[],R.value=[],k.value="",_.value="",e){try{e.pause()}catch{}try{e.currentTime=0}catch{}}if(await pt(lt.value),await jt(),e){try{e.load()}catch{}B(),V()}}q(w,e=>{if(e<0)return;const t=T.value[e];if(t)try{t.scrollIntoView({behavior:W.value?"auto":"smooth",block:"center"})}catch{}});let A=0;function H(){xt(),A=window.requestAnimationFrame(H)}q(L,()=>{B();try{localStorage.setItem("lyric-music-player:volumePercent",String(L.value))}catch{}}),q(S,()=>{V();try{localStorage.setItem("lyric-music-player:playbackRate",String(S.value))}catch{}}),Lt(async()=>{W.value=typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,G(),await U();const e=p.value;if(e){try{const t=localStorage.getItem("lyric-music-player:volumePercent");t!=null&&(L.value=P(Number(t),0,100));const a=localStorage.getItem("lyric-music-player:playbackRate");a!=null&&(S.value=P(Number(a),.25,4))}catch{}B(),V(),A=window.requestAnimationFrame(H);try{e.play().catch(()=>{})}catch{}window.addEventListener("keydown",J),window.addEventListener("pointerdown",Q,{capture:!0}),window.addEventListener("popstate",X)}}),St(()=>{A&&window.cancelAnimationFrame(A),window.removeEventListener("keydown",J),window.removeEventListener("pointerdown",Q,{capture:!0}),window.removeEventListener("popstate",X)});function bt(e){return t=>{t&&(T.value[e]=t)}}function J(e){M.value&&e.key==="Escape"&&E()}function Q(e){if(!M.value)return;const t=O.value;t&&(t.contains(e.target)||E())}function X(){const e=x.value;G(),x.value!==e&&U()}function gt(){const e=h.value,t=f.length;if(!t)return;if(e==="loop"){z(0);const s=p.value;if(s)try{s.play().catch(()=>{})}catch{}return}const a=dt.value;if(e==="shuffle"){let s=Math.floor(Math.random()*t);t>1&&s===a&&(s=(s+1)%t),K(s);return}const i=a<0?0:(a+1)%t;K(i)}return(e,t)=>(r(),o("div",Rt,[t[20]||(t[20]=n("div",{class:"absolute inset-0 bg-gradient-to-br from-[#241d19] via-[#3c2b23] to-[#6b4a38] dark:from-[#020617] dark:via-[#020617] dark:to-[#020617]"},null,-1)),t[21]||(t[21]=n("div",{class:"absolute inset-0 bg-black/40 dark:bg-black/70"},null,-1)),t[22]||(t[22]=n("div",{class:"absolute inset-0 backdrop-blur-3xl bg-white/14 dark:bg-slate-900/70"},null,-1)),n("div",It,[n("div",Nt,[n("div",Tt,[n("div",Pt,[n("div",Et,[t[10]||(t[10]=n("div",{class:"flex items-center justify-between gap-3"},[n("a",{href:"./","data-no-spa":"",class:"h-10 min-w-[44px] px-3 rounded-xl bg-white/10 hover:bg-white/16 transition-colors duration-300 text-xs flex items-center justify-center","aria-label":"返回音乐列表"}," 返回 "),n("div",{class:"flex-1"})],-1)),at.value?(r(),o("div",At," 未找到对应歌曲 id="+v(x.value)+"，已自动播放默认歌曲。 ",1)):b("",!0),n("div",$t,v(it.value),1),n("div",Ft,[n("div",zt,[t[7]||(t[7]=n("svg",{class:"w-4 h-4 opacity-90",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[n("path",{d:"M12 12c2.761 0 5-2.239 5-5S14.761 2 12 2 7 4.239 7 7s2.239 5 5 5zm0 2c-4.418 0-8 2.239-8 5v2h16v-2c0-2.761-3.582-5-8-5z"})],-1)),n("div",null,v(st.value),1)]),t[9]||(t[9]=n("div",{class:"opacity-70"},"•",-1)),n("div",Bt,[t[8]||(t[8]=n("svg",{class:"w-4 h-4 opacity-90",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[n("path",{d:"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 3a7 7 0 110 14 7 7 0 010-14zm0 4a3 3 0 100 6 3 3 0 000-6z"})],-1)),n("div",null,v(ot.value),1)])]),k.value||_.value?(r(),o("div",Vt,[k.value?(r(),o("div",Ut,"作词："+v(k.value),1)):b("",!0),_.value?(r(),o("div",qt,"作曲："+v(_.value),1)):b("",!0)])):b("",!0)]),t[11]||(t[11]=n("div",{class:"mt-4 h-px bg-white/12 dark:bg-white/10"},null,-1))]),n("div",Ot,[n("div",Wt,[(r(!0),o(tt,null,et(R.value,(a,i)=>(r(),o("div",{key:a.timeMs+"-"+i,ref_for:!0,ref:bt(i),class:"text-center select-none",onClick:s=>z(a.time)},[n("div",Kt,[a.romaji?(r(),o("div",{key:0,class:C(["transition-all duration-300",i===w.value?"text-[#f6e9de]/85 dark:text-white/75 text-sm md:text-base font-medium":"text-[#f6e9de]/45 dark:text-white/35 text-xs md:text-sm font-medium opacity-80"])},v(a.romaji),3)):b("",!0),n("div",{class:C(["transition-all duration-300",i===w.value?"text-[#f6e9de] dark:text-white text-3xl md:text-4xl font-semibold opacity-100":"text-[#f6e9de]/55 dark:text-white/45 text-lg md:text-xl font-medium opacity-70 hover:opacity-90"])},v(a.main),3),a.trans?(r(),o("div",{key:1,class:C(["transition-all duration-300",i===w.value?"text-[#f6e9de]/85 dark:text-white/75 text-sm md:text-base font-medium":"text-[#f6e9de]/45 dark:text-white/35 text-xs md:text-sm font-medium opacity-80"])},v(a.trans),3)):b("",!0)])],8,Dt))),128))])]),n("div",Gt,[n("div",Ht,[n("div",Jt,[n("button",{type:"button",class:"h-9 w-9 md:h-10 md:w-10 rounded-full bg-white/15 dark:bg-white/10 hover:bg-white/25 dark:hover:bg-white/15 transition-colors duration-300 flex items-center justify-center",onClick:wt,"aria-label":"播放/暂停"},[F.value?(r(),o("svg",Qt,[...t[12]||(t[12]=[n("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)])])):(r(),o("svg",Xt,[...t[13]||(t[13]=[n("path",{d:"M8 5v14l11-7z"},null,-1)])]))]),n("div",Yt,[n("input",{class:"w-full h-8 accent-white/80",type:"range",min:"0",max:I.value||0,step:"0.05",value:N.value,disabled:!$.value,onInput:t[0]||(t[0]=a=>z(Number(a.target.value)))},null,40,Zt),n("div",te,[n("div",null,v(D(N.value)),1),n("div",null,v(D(I.value)),1)])]),n("div",{ref_key:"menuWrapRef",ref:O,class:"relative shrink-0"},[n("button",{type:"button",class:"h-9 w-9 md:h-10 md:w-10 rounded-full bg-white/15 dark:bg-white/10 hover:bg-white/25 dark:hover:bg-white/15 transition-colors duration-300 flex items-center justify-center","aria-expanded":M.value?"true":"false","aria-label":"播放设置",onClick:yt},[...t[14]||(t[14]=[n("svg",{class:"w-5 h-5 md:w-5 md:h-5 text-[#f6e9de] dark:text-white",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[n("path",{d:"M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.5.5 0 00.12-.64l-1.92-3.32a.5.5 0 00-.6-.22l-2.39.96a7.03 7.03 0 00-1.63-.94l-.36-2.54A.5.5 0 0013.9 1h-3.8a.5.5 0 00-.49.42l-.36 2.54c-.58.22-1.12.53-1.63.94l-2.39-.96a.5.5 0 00-.6.22L2.71 7.48a.5.5 0 00.12.64l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94L2.83 14.52a.5.5 0 00-.12.64l1.92 3.32c.13.22.39.3.6.22l2.39-.96c.5.41 1.05.72 1.63.94l.36 2.54c.04.24.25.42.49.42h3.8c.24 0 .45-.18.49-.42l.36-2.54c.58-.22 1.12-.53 1.63-.94l2.39.96c.22.09.47 0 .6-.22l1.92-3.32a.5.5 0 00-.12-.64l-2.03-1.58zM12 15.5A3.5 3.5 0 1112 8a3.5 3.5 0 010 7.5z"})],-1)])],8,ee),M.value?(r(),o("div",ne,[n("div",{class:"flex items-center justify-between gap-3"},[t[16]||(t[16]=n("div",{class:"text-sm font-semibold tracking-wide"},"播放设置",-1)),n("button",{type:"button",class:"h-8 w-8 rounded-full bg-white/10 hover:bg-white/18 transition-colors duration-300 flex items-center justify-center","aria-label":"关闭菜单",onClick:E},[...t[15]||(t[15]=[n("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[n("path",{d:"M18.3 5.71a1 1 0 00-1.41 0L12 10.59 7.11 5.7A1 1 0 105.7 7.11L10.59 12l-4.9 4.89a1 1 0 101.41 1.42L12 13.41l4.89 4.9a1 1 0 001.42-1.41L13.41 12l4.9-4.89a1 1 0 000-1.4z"})],-1)])])]),n("div",ae,[n("div",ie,[n("div",se,[t[17]||(t[17]=n("div",null,"音量",-1)),n("div",oe,v(L.value)+"%",1)]),n("input",{class:"w-full h-9 accent-white/80",type:"range",min:"0",max:"100",step:"1",value:L.value,onInput:t[1]||(t[1]=a=>L.value=Number(a.target.value))},null,40,re)]),n("div",le,[n("div",ue,[t[18]||(t[18]=n("div",null,"速度",-1)),n("div",de,v(Number(S.value).toFixed(2))+"x",1)]),n("div",ce,[(r(),o(tt,null,et(ut,a=>n("button",{key:a,type:"button",class:C(["h-10 px-3 rounded-xl border border-white/15 bg-white/8 hover:bg-white/14 transition-colors duration-300 text-xs md:text-sm",a===S.value?"bg-white/18 border-white/25":""]),onClick:i=>S.value=a},v(a)+"x ",11,me)),64))])]),n("div",ve,[n("div",fe,[t[19]||(t[19]=n("div",null,"播放模式",-1)),n("div",pe,[h.value==="order"?(r(),o("span",xe,"顺序播放")):h.value==="loop"?(r(),o("span",he,"循环播放")):(r(),o("span",we,"随机播放"))])]),n("div",ye,[n("button",{type:"button",class:C(["h-9 px-3 rounded-xl border border-white/15 bg-white/8 hover:bg-white/14 transition-colors duration-300 text-xs md:text-sm",h.value==="order"?"bg-white/18 border-white/25":""]),onClick:t[2]||(t[2]=a=>h.value="order")}," 顺序 ",2),n("button",{type:"button",class:C(["h-9 px-3 rounded-xl border border-white/15 bg-white/8 hover:bg-white/14 transition-colors duration-300 text-xs md:text-sm",h.value==="loop"?"bg-white/18 border-white/25":""]),onClick:t[3]||(t[3]=a=>h.value="loop")}," 循环 ",2),n("button",{type:"button",class:C(["h-9 px-3 rounded-xl border border-white/15 bg-white/8 hover:bg-white/14 transition-colors duration-300 text-xs md:text-sm",h.value==="shuffle"?"bg-white/18 border-white/25":""]),onClick:t[4]||(t[4]=a=>h.value="shuffle")}," 随机 ",2)])])])])):b("",!0)],512)])])])])]),n("audio",{ref_key:"audioRef",ref:p,src:rt.value||void 0,preload:"metadata",onLoadedmetadata:ht,onPlay:t[5]||(t[5]=a=>F.value=!0),onPause:t[6]||(t[6]=a=>F.value=!1),onEnded:gt},null,40,be),R.value.length?b("",!0):(r(),o("div",ge," 歌词加载中… "))])]))}},_e=Mt(ke,[["__scopeId","data-v-231116bc"]]),je=JSON.parse('{"title":"播放","description":"音乐播放页","frontmatter":{"layout":"page","title":"播放","description":"音乐播放页"},"headers":[],"relativePath":"music/player.md","filePath":"music/player.md"}'),Me={name:"music/player.md"},Ce=Object.assign(Me,{setup(nt){return(f,x)=>(r(),o("div",null,[Ct(_e)]))}});export{je as __pageData,Ce as default};
