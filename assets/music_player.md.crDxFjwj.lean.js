import{m as X}from"./chunks/music-list.Duabxupp.js";import{_ as gt,p as s,h as M,q as B,v as bt,x as kt,c as o,o as l,j as a,e as h,t as d,F as Y,B as Z,n as E,P as _t,G as Mt}from"./chunks/framework.DdddRsJj.js";const Lt={class:"relative h-[calc(100vh-var(--vp-nav-height))] overflow-hidden"},St={class:"relative mx-auto max-w-[1200px] h-full px-4 md:px-6 py-4 md:py-6 flex flex-col min-h-0"},jt={class:"group relative mx-auto w-full max-w-[980px] flex-1 min-h-0 rounded-2xl border border-white/15 bg-white/8 dark:bg-white/6 backdrop-blur-2xl shadow-2xl shadow-black/25 ring-1 ring-white/10"},Rt={class:"relative h-full flex flex-col min-h-0"},Nt={class:"shrink-0 px-5 md:px-8 pt-5 md:pt-6 pb-4 md:pb-5"},Ct={class:"text-center text-[#f3e7dc] dark:text-gray-100"},Tt={key:0,class:"mt-3 text-xs md:text-sm text-[#f6e9de]/80 dark:text-white/70"},Pt={class:"text-xl md:text-2xl font-semibold tracking-wide"},At={class:"mt-2 flex items-center justify-center gap-3 text-xs md:text-sm opacity-80 flex-wrap"},Et={class:"flex items-center gap-1.5"},Ft={class:"flex items-center gap-1.5"},zt={key:1,class:"mt-2 text-xs opacity-70 flex items-center justify-center gap-4 flex-wrap"},It={key:0},$t={key:1},Bt={class:"flex-1 min-h-0 overflow-y-auto px-5 md:px-8 py-6 md:py-8 scroll-smooth hide-scrollbar"},Vt={class:"flex flex-col gap-6 md:gap-7"},qt=["onClick"],Ot={class:"flex flex-col items-center gap-1.5"},Ut={class:"controls shrink-0 px-5 md:px-8 pb-4 md:pb-5 transition-opacity duration-300 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:pointer-events-auto"},Wt={class:"flex items-center gap-3 md:gap-4"},Dt={key:0,class:"w-6 h-6 text-[#f6e9de] dark:text-white",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},Kt={key:1,class:"w-6 h-6 text-[#f6e9de] dark:text-white ml-0.5",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},Gt={class:"flex-1"},Ht=["max","value","disabled"],Jt={class:"-mt-1 flex items-center justify-between text-xs text-[#f6e9de]/70 dark:text-white/60"},Qt=["aria-expanded"],Xt={key:0,class:"absolute right-0 bottom-[calc(100%+10px)] w-[min(92vw,320px)] rounded-2xl border border-white/15 bg-[#1a1410]/95 dark:bg-gray-900/95 backdrop-blur-xl shadow-2xl shadow-black/30 ring-1 ring-white/10 p-4 md:p-5 text-[#f6e9de] dark:text-gray-100 transition-colors duration-300"},Yt={class:"mt-4 flex flex-col gap-4"},Zt={class:"flex flex-col gap-2"},te={class:"flex items-center justify-between text-xs opacity-80"},ee={class:"tabular-nums"},ae=["value"],ie={class:"flex flex-col gap-2"},ne={class:"flex items-center justify-between text-xs opacity-80"},se={class:"tabular-nums"},re={class:"flex flex-wrap gap-2"},oe=["onClick"],le=["src"],ue={key:0,class:"mt-3 text-center text-sm text-white/70"},ce={__name:"LyricMusicPlayer",setup(tt){const L=Array.isArray(X)?X:[],x=s(""),j=M(()=>L.length?L.find(e=>(e==null?void 0:e.id)===x.value)||L[0]:null),et=M(()=>x.value?L.length?!L.some(e=>(e==null?void 0:e.id)===x.value):!0:!1),at=M(()=>{var e;return((e=j.value)==null?void 0:e.title)||"未知歌曲"}),it=M(()=>{var e;return((e=j.value)==null?void 0:e.artist)||"未知歌手"}),nt=M(()=>{var e;return((e=j.value)==null?void 0:e.album)||""}),st=M(()=>{var t;const e=(t=j.value)==null?void 0:t.audio;return e?new URL(e,import.meta.url).href:""}),rt=M(()=>{var t;const e=(t=j.value)==null?void 0:t.lrc;return e?new URL(e,import.meta.url).href:""}),f=s(null),S=s([]),w=s(""),y=s(""),F=s(!1),z=s(!1),R=s(0),N=s(0),g=s(!1),V=s(null),b=s(20),k=s(1),ot=[.5,.75,1,1.25,1.5,2],p=s(-1),C=s([]),q=s(!1);function T(e,t,i){return Number.isFinite(e)?Math.min(i,Math.max(t,e)):t}function O(e){if(!Number.isFinite(e)||e<0)return"00:00";const t=Math.floor(e),i=Math.floor(t/60),n=t%60;return`${String(i).padStart(2,"0")}:${String(n).padStart(2,"0")}`}function lt(e){const t=String(e||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`),i=/\[(\d{2}):(\d{2})(?:\.(\d{1,3}))?\]/g,n=[];for(const v of t){const m=String(v||""),r=[];let u;for(;(u=i.exec(m))!==null;){const c=Number(u[1]),wt=Number(u[2]),yt=u[3]?Number(u[3].padEnd(3,"0")):0,Q=c*60*1e3+wt*1e3+yt;Number.isFinite(Q)&&r.push(Q)}if(!r.length)continue;const _=m.replace(i,"").trimEnd();for(const c of r)n.push({timeMs:c,time:c/1e3,text:_||" "})}return n.sort((v,m)=>v.timeMs-m.timeMs),n}function ut(e){const t=String(e||"").trim(),i=t.match(/^作词\s*[:：]\s*(.+)$/);if(i)return{type:"lyricist",value:i[1].trim()};const n=t.match(/^作曲\s*[:：]\s*(.+)$/);return n?{type:"composer",value:n[1].trim()}:null}function ct(e){const t=String(e||"").trim();if(!t)return{kind:"empty",value:""};const i=ut(t);if(i)return{kind:i.type,value:i.value};const n=t.match(/^R\s*[:：]\s*(.*)$/i);if(n)return{kind:"romaji",value:(n[1]||"").trim()};const v=t.match(/^T\s*[:：]\s*(.*)$/i);return v?{kind:"trans",value:(v[1]||"").trim()}:{kind:"main",value:t}}function dt(e){const t=S.value;if(!t.length)return-1;let i=0,n=t.length-1,v=-1;for(;i<=n;){const m=i+n>>1;t[m].time<=e+.03?(v=m,i=m+1):n=m-1}return v}async function mt(e){const t=String(e||"").trim();if(!t){S.value=[],p.value=-1,C.value=[],w.value="",y.value="";return}const n=await(await fetch(t)).text(),v=lt(n);w.value="",y.value="";const m=new Map;for(const r of v){const{kind:u,value:_}=ct(r.text);if(u==="lyricist"){w.value=_;continue}if(u==="composer"){y.value=_;continue}if(u==="empty")continue;let c=m.get(r.timeMs);c||(c={time:r.time,timeMs:r.timeMs,main:"",romaji:"",trans:""},m.set(r.timeMs,c)),u==="main"&&!c.main&&(c.main=_),u==="romaji"&&!c.romaji&&(c.romaji=_),u==="trans"&&!c.trans&&(c.trans=_)}S.value=Array.from(m.values()).sort((r,u)=>r.timeMs-u.timeMs).filter(r=>String(r.main||"").trim()||String(r.romaji||"").trim()||String(r.trans||"").trim()),p.value=-1,C.value=[]}function vt(){const e=f.value;if(!e)return;N.value=e.currentTime||0;const t=dt(N.value);t!==p.value&&(p.value=t)}function ft(){const e=f.value;R.value=(e==null?void 0:e.duration)||0,F.value=!0}function pt(){const e=f.value;e&&(e.paused?e.play().catch(()=>{}):e.pause())}function U(e){const t=f.value;!t||!Number.isFinite(e)||(t.currentTime=Math.max(0,Math.min(e,R.value||e)))}function xt(){g.value=!g.value}function P(){g.value=!1}function I(){const e=f.value;e&&(e.volume=T(Number(b.value)/100,0,1))}function $(){const e=f.value;e&&(e.playbackRate=T(Number(k.value),.25,4))}function W(){if(typeof window>"u")return;const e=new URLSearchParams(window.location.search||"");x.value=e.get("id")||""}async function D(){const e=f.value;if(P(),F.value=!1,R.value=0,N.value=0,p.value=-1,C.value=[],S.value=[],w.value="",y.value="",e){try{e.pause()}catch{}try{e.currentTime=0}catch{}}if(await mt(rt.value),await _t(),e){try{e.load()}catch{}I(),$()}}B(p,e=>{if(e<0)return;const t=C.value[e];if(t)try{t.scrollIntoView({behavior:q.value?"auto":"smooth",block:"center"})}catch{}});let A=0;function K(){vt(),A=window.requestAnimationFrame(K)}B(b,()=>{I();try{localStorage.setItem("lyric-music-player:volumePercent",String(b.value))}catch{}}),B(k,()=>{$();try{localStorage.setItem("lyric-music-player:playbackRate",String(k.value))}catch{}}),bt(async()=>{if(q.value=typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,W(),await D(),!!f.value){try{const t=localStorage.getItem("lyric-music-player:volumePercent");t!=null&&(b.value=T(Number(t),0,100));const i=localStorage.getItem("lyric-music-player:playbackRate");i!=null&&(k.value=T(Number(i),.25,4))}catch{}I(),$(),A=window.requestAnimationFrame(K),window.addEventListener("keydown",G),window.addEventListener("pointerdown",H,{capture:!0}),window.addEventListener("popstate",J)}}),kt(()=>{A&&window.cancelAnimationFrame(A),window.removeEventListener("keydown",G),window.removeEventListener("pointerdown",H,{capture:!0}),window.removeEventListener("popstate",J)});function ht(e){return t=>{t&&(C.value[e]=t)}}function G(e){g.value&&e.key==="Escape"&&P()}function H(e){if(!g.value)return;const t=V.value;t&&(t.contains(e.target)||P())}function J(){const e=x.value;W(),x.value!==e&&D()}return(e,t)=>(l(),o("div",Lt,[t[17]||(t[17]=a("div",{class:"absolute inset-0 bg-gradient-to-br from-[#241d19] via-[#3c2b23] to-[#6b4a38] dark:from-[#0b1220] dark:via-[#111827] dark:to-[#0b1220]"},null,-1)),t[18]||(t[18]=a("div",{class:"absolute inset-0 bg-black/10 dark:bg-black/40"},null,-1)),t[19]||(t[19]=a("div",{class:"absolute inset-0 backdrop-blur-2xl bg-white/5 dark:bg-white/3"},null,-1)),a("div",St,[a("div",jt,[t[16]||(t[16]=a("div",{class:"pointer-events-none absolute inset-0 rounded-2xl bg-gradient-to-b from-white/10 to-transparent dark:from-white/6"},null,-1)),a("div",Rt,[a("div",Nt,[a("div",Ct,[t[7]||(t[7]=a("div",{class:"flex items-center justify-between gap-3"},[a("a",{href:"./","data-no-spa":"",class:"h-10 min-w-[44px] px-3 rounded-xl bg-white/10 hover:bg-white/16 transition-colors duration-300 text-xs flex items-center justify-center","aria-label":"返回音乐列表"}," 返回 "),a("div",{class:"flex-1"})],-1)),et.value?(l(),o("div",Tt," 未找到对应歌曲 id="+d(x.value)+"，已自动播放默认歌曲。 ",1)):h("",!0),a("div",Pt,d(at.value),1),a("div",At,[a("div",Et,[t[4]||(t[4]=a("svg",{class:"w-4 h-4 opacity-90",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[a("path",{d:"M12 12c2.761 0 5-2.239 5-5S14.761 2 12 2 7 4.239 7 7s2.239 5 5 5zm0 2c-4.418 0-8 2.239-8 5v2h16v-2c0-2.761-3.582-5-8-5z"})],-1)),a("div",null,d(it.value),1)]),t[6]||(t[6]=a("div",{class:"opacity-70"},"•",-1)),a("div",Ft,[t[5]||(t[5]=a("svg",{class:"w-4 h-4 opacity-90",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[a("path",{d:"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 3a7 7 0 110 14 7 7 0 010-14zm0 4a3 3 0 100 6 3 3 0 000-6z"})],-1)),a("div",null,d(nt.value),1)])]),w.value||y.value?(l(),o("div",zt,[w.value?(l(),o("div",It,"作词："+d(w.value),1)):h("",!0),y.value?(l(),o("div",$t,"作曲："+d(y.value),1)):h("",!0)])):h("",!0)]),t[8]||(t[8]=a("div",{class:"mt-4 h-px bg-white/12 dark:bg-white/10"},null,-1))]),a("div",Bt,[a("div",Vt,[(l(!0),o(Y,null,Z(S.value,(i,n)=>(l(),o("div",{key:i.timeMs+"-"+n,ref_for:!0,ref:ht(n),class:"text-center select-none",onClick:v=>U(i.time)},[a("div",Ot,[i.romaji?(l(),o("div",{key:0,class:E(["transition-all duration-300",n===p.value?"text-[#f6e9de]/85 dark:text-white/75 text-sm md:text-base font-medium":"text-[#f6e9de]/45 dark:text-white/35 text-xs md:text-sm font-medium opacity-80"])},d(i.romaji),3)):h("",!0),a("div",{class:E(["transition-all duration-300",n===p.value?"text-[#f6e9de] dark:text-white text-3xl md:text-4xl font-semibold opacity-100":"text-[#f6e9de]/55 dark:text-white/45 text-lg md:text-xl font-medium opacity-70 hover:opacity-90"])},d(i.main),3),i.trans?(l(),o("div",{key:1,class:E(["transition-all duration-300",n===p.value?"text-[#f6e9de]/85 dark:text-white/75 text-sm md:text-base font-medium":"text-[#f6e9de]/45 dark:text-white/35 text-xs md:text-sm font-medium opacity-80"])},d(i.trans),3)):h("",!0)])],8,qt))),128))])]),a("div",Ut,[a("div",Wt,[a("button",{type:"button",class:"h-11 w-11 md:h-12 md:w-12 rounded-full bg-white/15 dark:bg-white/10 hover:bg-white/25 dark:hover:bg-white/15 transition-colors duration-300 flex items-center justify-center",onClick:pt,"aria-label":"播放/暂停"},[z.value?(l(),o("svg",Dt,[...t[9]||(t[9]=[a("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)])])):(l(),o("svg",Kt,[...t[10]||(t[10]=[a("path",{d:"M8 5v14l11-7z"},null,-1)])]))]),a("div",Gt,[a("input",{class:"w-full h-11 accent-white/80",type:"range",min:"0",max:R.value||0,step:"0.05",value:N.value,disabled:!F.value,onInput:t[0]||(t[0]=i=>U(Number(i.target.value)))},null,40,Ht),a("div",Jt,[a("div",null,d(O(N.value)),1),a("div",null,d(O(R.value)),1)])]),a("div",{ref_key:"menuWrapRef",ref:V,class:"relative shrink-0"},[a("button",{type:"button",class:"h-11 w-11 md:h-12 md:w-12 rounded-full bg-white/15 dark:bg-white/10 hover:bg-white/25 dark:hover:bg-white/15 transition-colors duration-300 flex items-center justify-center","aria-expanded":g.value?"true":"false","aria-label":"播放设置",onClick:xt},[...t[11]||(t[11]=[a("svg",{class:"w-6 h-6 text-[#f6e9de] dark:text-white",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[a("path",{d:"M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.5.5 0 00.12-.64l-1.92-3.32a.5.5 0 00-.6-.22l-2.39.96a7.03 7.03 0 00-1.63-.94l-.36-2.54A.5.5 0 0013.9 1h-3.8a.5.5 0 00-.49.42l-.36 2.54c-.58.22-1.12.53-1.63.94l-2.39-.96a.5.5 0 00-.6.22L2.71 7.48a.5.5 0 00.12.64l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94L2.83 14.52a.5.5 0 00-.12.64l1.92 3.32c.13.22.39.3.6.22l2.39-.96c.5.41 1.05.72 1.63.94l.36 2.54c.04.24.25.42.49.42h3.8c.24 0 .45-.18.49-.42l.36-2.54c.58-.22 1.12-.53 1.63-.94l2.39.96c.22.09.47 0 .6-.22l1.92-3.32a.5.5 0 00-.12-.64l-2.03-1.58zM12 15.5A3.5 3.5 0 1112 8a3.5 3.5 0 010 7.5z"})],-1)])],8,Qt),g.value?(l(),o("div",Xt,[a("div",{class:"flex items-center justify-between gap-3"},[t[13]||(t[13]=a("div",{class:"text-sm font-semibold tracking-wide"},"播放设置",-1)),a("button",{type:"button",class:"h-9 w-9 rounded-full bg-white/10 hover:bg-white/18 transition-colors duration-300 flex items-center justify-center","aria-label":"关闭菜单",onClick:P},[...t[12]||(t[12]=[a("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[a("path",{d:"M18.3 5.71a1 1 0 00-1.41 0L12 10.59 7.11 5.7A1 1 0 105.7 7.11L10.59 12l-4.9 4.89a1 1 0 101.41 1.42L12 13.41l4.89 4.9a1 1 0 001.42-1.41L13.41 12l4.9-4.89a1 1 0 000-1.4z"})],-1)])])]),a("div",Yt,[a("div",Zt,[a("div",te,[t[14]||(t[14]=a("div",null,"音量",-1)),a("div",ee,d(b.value)+"%",1)]),a("input",{class:"w-full h-11 accent-white/80",type:"range",min:"0",max:"100",step:"1",value:b.value,onInput:t[1]||(t[1]=i=>b.value=Number(i.target.value))},null,40,ae)]),a("div",ie,[a("div",ne,[t[15]||(t[15]=a("div",null,"速度",-1)),a("div",se,d(Number(k.value).toFixed(2))+"x",1)]),a("div",re,[(l(),o(Y,null,Z(ot,i=>a("button",{key:i,type:"button",class:E(["h-10 px-3 rounded-xl border border-white/15 bg-white/8 hover:bg-white/14 transition-colors duration-300 text-xs md:text-sm",i===k.value?"bg-white/18 border-white/25":""]),onClick:n=>k.value=i},d(i)+"x ",11,oe)),64))])])])])):h("",!0)],512)])])])]),a("audio",{ref_key:"audioRef",ref:f,src:st.value||void 0,preload:"metadata",onLoadedmetadata:ft,onPlay:t[2]||(t[2]=i=>z.value=!0),onPause:t[3]||(t[3]=i=>z.value=!1)},null,40,le),S.value.length?h("",!0):(l(),o("div",ue," 歌词加载中… "))])]))}},de=gt(ce,[["__scopeId","data-v-f418d4f6"]]),pe=JSON.parse('{"title":"播放","description":"音乐播放页","frontmatter":{"layout":"page","title":"播放","description":"音乐播放页"},"headers":[],"relativePath":"music/player.md","filePath":"music/player.md"}'),me={name:"music/player.md"},xe=Object.assign(me,{setup(tt){return(L,x)=>(l(),o("div",null,[Mt(de)]))}});export{pe as __pageData,xe as default};
