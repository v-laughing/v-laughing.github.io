import{d as D,O as y,c as S,g as F}from"./chunks/theme.BSVdFQrX.js";import{_ as I,C as N,c as n,o as d,j as t,a0 as c,a as h,n as w,t as f,a2 as C,e as U,F as M,B as _,G as v,a1 as b,a3 as T,a4 as L}from"./chunks/framework.DdddRsJj.js";const u="v-laughing",m="blog",k="heads/master",x="docs/",V={data(){return{musicData:{name:"",artist:"",category:"energetic",url:"",cover:""},showMusicLinks:!1,showCoverLinks:!1,lastUploadedMusics:[],lastUploadedCovers:[],accessToken:""}},computed:{isFormValid(){return this.musicData.name.trim()&&this.musicData.artist.trim()&&(this.musicData.url.trim()||this.lastUploadedMusics.length>0)}},mounted(){this.accessToken=localStorage.getItem("GPOST_KEY"),this.accessToken||(alert("请先登录"),window.location.href="/admin"),this.lastUploadedMusics=JSON.parse(localStorage.getItem("MUSIC_FILES")||"[]"),this.lastUploadedCovers=JSON.parse(localStorage.getItem("MUSIC_COVERS")||"[]")},methods:{readFile(a){return new Promise((e,l)=>{const o=new FileReader;o.onload=r=>{e(r.target.result.split(",")[1])},o.onerror=r=>{l(r)},o.readAsDataURL(a)})},async uploadMusicFile(a){if(a){this.octokit||(this.octokit=new y({auth:this.accessToken}));try{const e=await this.readFile(a),l=a.name.split(".").pop(),o=this.musicData.name.trim()||"未知音乐",r=this.musicData.artist.trim()||"未知作者",i=o.replace(/[^\w\u4e00-\u9fa5-]/g,"_"),g=r.replace(/[^\w\u4e00-\u9fa5-]/g,"_"),s=`${i}-${g}.${l}`,p=`assets/music/${s}`;await this.octokit.repos.createOrUpdateFileContents({owner:u,repo:m,path:x+p,message:"Upload music file",content:e}),this.lastUploadedMusics.unshift({name:s,url:`../${p}`}),this.lastUploadedMusics.length>5&&this.lastUploadedMusics.pop(),localStorage.setItem("MUSIC_FILES",JSON.stringify(this.lastUploadedMusics)),alert("音乐文件上传成功")}catch(e){console.error("Error: ",e),e.status===401?(alert("认证失败，请重新登录"),localStorage.removeItem("GPOST_KEY"),window.location.href="/admin"):alert("音乐文件上传失败："+e.message)}}},async uploadCoverImage(a){if(a){this.octokit||(this.octokit=new y({auth:this.accessToken}));try{const e=await S(a,.8),l=await this.readFile(e),o=`${F()}_${a.name}`,r=`assets/cover/${o}`;await this.octokit.repos.createOrUpdateFileContents({owner:u,repo:m,path:x+r,message:"Upload cover image",content:l}),this.lastUploadedCovers.unshift({name:o,mdUrl:`![cover](../${r})  
`,coverPath:`/assets/cover/${o}`}),this.lastUploadedCovers.length>5&&this.lastUploadedCovers.pop(),localStorage.setItem("MUSIC_COVERS",JSON.stringify(this.lastUploadedCovers)),alert("封面图片上传成功")}catch(e){console.error("Error: ",e),e.status===401?(alert("认证失败，请重新登录"),localStorage.removeItem("GPOST_KEY"),window.location.href="/admin"):alert("封面图片上传失败："+e.message)}}},handleMusicUpload(a){const e=a.target.files[0];this.uploadMusicFile(e)},handleCoverUpload(a){const e=a.target.files[0];this.uploadCoverImage(e)},submit(){const a=this.accessToken;if(!a){alert("请先登录");return}this.octokit||(this.octokit=new y({auth:a}));const e={...this.musicData,url:this.musicData.url||(this.lastUploadedMusics.length>0?this.lastUploadedMusics[0].url:""),cover:this.musicData.cover||(this.lastUploadedCovers.length>0?this.lastUploadedCovers[0].coverPath:"")||this.getDefaultCover()},l=x+"music/music-list.json";this.commitMusicData(l,e)},async getFileContent(a){try{const e=await this.octokit.rest.repos.getContent({owner:u,repo:m,path:a,ref:k});return JSON.parse(D(e.data.content))}catch(e){if(e.status===404)return[];throw e}},async commitMusicData(a,e){try{const o=(await this.octokit.git.getRef({owner:u,repo:m,ref:k})).data.object.sha,i=[...await this.getFileContent(a),e],g=await this.octokit.git.createTree({owner:u,repo:m,base_tree:o,tree:[{path:a,mode:"100644",type:"blob",content:JSON.stringify(i,null,2)}]}),s=await this.octokit.git.createCommit({owner:u,repo:m,message:`Add music: ${e.name} by ${e.artist}`,tree:g.data.sha,parents:[o]});await this.octokit.git.updateRef({owner:u,repo:m,ref:k,sha:s.data.sha}),alert("音乐收藏成功！"),this.resetForm()}catch(l){alert("提交失败："+l.message)}},getDefaultCover(){return`/assets/cover/music${Math.floor(Math.random()*4)+1}.png`},resetForm(){this.musicData={name:"",artist:"",category:"energetic",url:"",cover:""}}}},O={class:"min-h-screen"},j={class:"max-w-3xl mx-auto"},E={class:"mb-6"},P={class:"flex flex-col sm:flex-row sm:items-center gap-4"},B={class:"relative flex-1"},R={class:"mt-4 space-y-3"},J={class:"flex-1 min-w-0"},A={class:"text-xs text-gray-600 dark:text-gray-300 break-all"},G={key:0,class:"text-center text-gray-500 dark:text-gray-400 text-sm py-4"},z={class:"space-y-6"},K={class:"flex flex-col sm:flex-row sm:items-center gap-4"},Y={class:"relative flex-1"},H={class:"mt-4 space-y-3"},Q={class:"flex-1 min-w-0"},q={class:"text-xs text-gray-600 dark:text-gray-300 break-all"},W={key:0,class:"text-center text-gray-500 dark:text-gray-400 text-sm py-4"},X={class:"flex justify-center mt-8"},Z=["disabled"];function $(a,e,l,o,r,i){const g=N("copy-button");return d(),n("div",O,[t("div",j,[t("div",E,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"音乐文件上传",-1)),t("div",P,[t("div",B,[t("input",{type:"file",accept:"audio/*",onChange:e[0]||(e[0]=(...s)=>i.handleMusicUpload&&i.handleMusicUpload(...s)),class:"hidden",id:"music-upload"},null,32),e[10]||(e[10]=t("label",{for:"music-upload",class:"file-upload-area flex items-center justify-center w-full px-4 py-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-blue-400 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors duration-200"},[t("svg",{class:"w-6 h-6 text-gray-400 dark:text-gray-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})]),t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"点击上传音乐文件")],-1))]),t("button",{onClick:e[1]||(e[1]=s=>r.showMusicLinks=!r.showMusicLinks),class:"flex items-center px-4 py-3 bg-blue-600 dark:bg-blue-700 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-800 transition-colors duration-200"},[(d(),n("svg",{class:w(["w-4 h-4 mr-2",{"rotate-180":r.showMusicLinks}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[11]||(e[11]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2)),h(" "+f(r.showMusicLinks?"收起":"展开")+"音乐链接 ",1)])]),c(t("div",R,[(d(!0),n(M,null,_(r.lastUploadedMusics,(s,p)=>(d(),n("div",{key:p,class:"flex flex-col sm:flex-row sm:items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"},[t("div",J,[t("span",A,f(s.url),1)]),v(g,{value:s.url,class:"flex-shrink-0"},null,8,["value"])]))),128)),r.lastUploadedMusics.length===0?(d(),n("div",G," 暂无上传的音乐文件 ")):U("",!0)],512),[[C,r.showMusicLinks]])]),t("div",z,[t("div",null,[e[13]||(e[13]=t("label",{for:"music-name",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"音乐名称",-1)),c(t("input",{id:"music-name","onUpdate:modelValue":e[2]||(e[2]=s=>r.musicData.name=s),type:"text",placeholder:"请输入音乐名称",class:"w-full px-4 py-3 border-style-solid border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:border-blue-400 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 transition-all duration-200"},null,512),[[b,r.musicData.name]])]),t("div",null,[e[14]||(e[14]=t("label",{for:"artist",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"艺术家",-1)),c(t("input",{id:"artist","onUpdate:modelValue":e[3]||(e[3]=s=>r.musicData.artist=s),type:"text",placeholder:"请输入艺术家名称",class:"w-full px-4 py-3 border-style-solid border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:border-blue-400 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 transition-all duration-200"},null,512),[[b,r.musicData.artist]])]),t("div",null,[e[16]||(e[16]=t("label",{for:"category",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"音乐分类",-1)),c(t("select",{id:"category","onUpdate:modelValue":e[4]||(e[4]=s=>r.musicData.category=s),class:"w-full px-4 py-3 border-style-solid border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:border-blue-400 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 transition-all duration-200"},[...e[15]||(e[15]=[L('<option value="energetic" data-v-d6acf0e9>充满活力 (energetic)</option><option value="melancholic" data-v-d6acf0e9>忧郁伤感 (melancholic)</option><option value="uplifting" data-v-d6acf0e9>积极向上 (uplifting)</option><option value="romantic" data-v-d6acf0e9>浪漫温馨 (romantic)</option><option value="peaceful" data-v-d6acf0e9>宁静平和 (peaceful)</option>',5)])],512),[[T,r.musicData.category]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"music-url",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},"音乐链接",-1)),c(t("input",{id:"music-url","onUpdate:modelValue":e[5]||(e[5]=s=>r.musicData.url=s),type:"url",placeholder:"请输入音乐链接 (支持网易云、QQ音乐等)",class:"w-full px-4 py-3 border-style-solid border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:border-blue-400 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 transition-all duration-200"},null,512),[[b,r.musicData.url]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},[h("封面图片 "),t("span",{class:"text-gray-500 dark:text-gray-400 text-sm"},"(可选)")],-1)),t("div",K,[t("div",Y,[t("input",{type:"file",accept:"image/*",onChange:e[6]||(e[6]=(...s)=>i.handleCoverUpload&&i.handleCoverUpload(...s)),class:"hidden",id:"cover-upload"},null,32),e[18]||(e[18]=t("label",{for:"cover-upload",class:"file-upload-area flex items-center justify-center w-full px-4 py-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-blue-400 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors duration-200"},[t("svg",{class:"w-6 h-6 text-gray-400 dark:text-gray-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})]),t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"点击上传封面图片")],-1))]),t("button",{onClick:e[7]||(e[7]=s=>r.showCoverLinks=!r.showCoverLinks),class:"flex items-center px-4 py-3 bg-green-600 dark:bg-green-700 text-white rounded-lg hover:bg-green-700 dark:hover:bg-green-800 transition-colors duration-200"},[(d(),n("svg",{class:w(["w-4 h-4 mr-2",{"rotate-180":r.showCoverLinks}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[19]||(e[19]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2)),h(" "+f(r.showCoverLinks?"收起":"展开")+"封面链接 ",1)])]),c(t("div",H,[(d(!0),n(M,null,_(r.lastUploadedCovers,(s,p)=>(d(),n("div",{key:p,class:"flex flex-col sm:flex-row sm:items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"},[t("div",Q,[t("span",q,f(s.mdUrl),1)]),v(g,{value:s.mdUrl,class:"flex-shrink-0"},null,8,["value"])]))),128)),r.lastUploadedCovers.length===0?(d(),n("div",W," 暂无上传的封面图片 ")):U("",!0)],512),[[C,r.showCoverLinks]])]),t("div",null,[e[21]||(e[21]=t("label",{for:"cover-url",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},[h("封面图片链接 "),t("span",{class:"text-gray-500 dark:text-gray-400 text-sm"},"(可选)")],-1)),c(t("input",{id:"cover-url","onUpdate:modelValue":e[8]||(e[8]=s=>r.musicData.cover=s),type:"url",placeholder:"请输入封面图片链接",class:"w-full px-4 py-3 border-style-solid border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:border-blue-400 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 transition-all duration-200"},null,512),[[b,r.musicData.cover]])])]),t("div",X,[t("button",{onClick:e[9]||(e[9]=(...s)=>i.submit&&i.submit(...s)),disabled:!i.isFormValid,class:"px-8 py-3 bg-gradient-to-r from-purple-600 to-pink-600 dark:from-purple-700 dark:to-pink-700 text-white font-medium rounded-lg hover:from-purple-700 hover:to-pink-700 dark:hover:from-purple-800 dark:hover:to-pink-800 disabled:from-gray-400 disabled:to-gray-400 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105 disabled:hover:scale-100"}," 收藏音乐 ",8,Z)]),e[22]||(e[22]=t("div",{class:"mt-8 text-center"},[t("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," 支持音频文件上传和在线音乐链接，封面图片会自动上传到 GitHub ")],-1))])])}const ee=I(V,[["render",$],["__scopeId","data-v-d6acf0e9"]]),ae=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"admin/music.md","filePath":"admin/music.md"}'),te={name:"admin/music.md"},oe=Object.assign(te,{setup(a){return(e,l)=>(d(),n("div",null,[v(ee)]))}});export{ae as __pageData,oe as default};
