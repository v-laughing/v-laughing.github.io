import{t as Me,u as pe,G as W,l as $,v as me,m as ce,j as fe,w as ve,g as x,f as J,V as w,x as _e,Q as X,y as Ae,p as T,z as Ke,D as ge,e as se,E as He,I as he,J as Xe,q as le,O as Ee,K as $e,N as Ye,B as De,F as be,i as Ze,k as Je,a as et,n as Te,U as tt,s as Oe,L as ot,r as Qe,X as Fe,Y as nt,c as at,d as st,W as it,A as rt,o as ct}from"./chunks/three.module.qkk1P2i0.js";import{am as Se,p as ye,c as ne,o as ee,j as y,a as Z,e as ue,t as ae,N as lt,b as dt,w as Be,T as ut,_ as pt,v as mt,Y as ht,a4 as Re,G as xe,k as de,C as wt}from"./chunks/framework.DQgBWl2g.js";const ft=2e-6,Ne=933e-6,yt=[{name:"太阳",nameEn:"Sun",color:16755251,emissive:16755251,size:2e3,mass:472e11,orbitRadius:0,orbitSpeed:0,rotationSpeed:5e-5,isStar:!0,description:"星系中心，直径4000米"},{name:"余烬孪星",nameEn:"Ember Twin",color:12868666,emissive:10767402,size:171,mass:115e9,orbitRadius:5e3,orbitSpeed:933e-6,rotationSpeed:833e-6,isTwin:!0,twinSide:1,description:"沙漏双星之一，直径342米，公转速度~280m/s，自转周期~126秒"},{name:"灰烬孪星",nameEn:"Ash Twin",color:15259043,emissive:13153667,size:168,mass:106e9,orbitRadius:5e3,orbitSpeed:933e-6,rotationSpeed:.00116,isTwin:!0,twinSide:-1,description:"沙漏双星之一，直径336米，公转速度~280m/s，自转周期~90秒"},{name:"木炉星",nameEn:"Timber Hearth",color:8043130,emissive:5937754,size:250,mass:361e9,orbitRadius:8593,orbitSpeed:419e-6,rotationSpeed:167e-6,description:"地表半径250米，大气175米，公转速度~216m/s，自转周期~628秒",hasAtmosphere:!0,atmosphereColor:8965375,atmosphereThickness:175},{name:"废墟月亮",nameEn:"Attlerock",color:8947848,emissive:4473924,size:75,mass:1e9,moonOf:"木炉星",moonOrbitRadius:600,moonOrbitSpeed:.002,rotationSpeed:.001,description:"木炉星的卫星，无大气"},{name:"脆壳星",nameEn:"Brittle Hollow",color:8035274,emissive:5929898,size:300,mass:334e9,orbitRadius:11691,orbitSpeed:264e-6,rotationSpeed:333e-6,description:"地表半径300米，大气50米，公转速度~185m/s，自转周期~314秒",hasBlackHole:!0,blackHoleSize:53,hasAtmosphere:!0,atmosphereColor:11184810,atmosphereThickness:50},{name:"深巨星",nameEn:"Giant's Deep",color:5085818,emissive:4033130,size:500,mass:289e10,orbitRadius:16458,orbitSpeed:158e-6,rotationSpeed:1e-5,description:"地表半径500米，大气450米，公转速度~156m/s，表面重力2g，潮汐锁定",hasAtmosphere:!0,atmosphereColor:6728328,atmosphereThickness:450,surfaceGravity:2},{name:"黑棘星",nameEn:"Dark Bramble",color:3824202,emissive:2771514,size:750,mass:99e10,orbitRadius:2e4,orbitSpeed:118e-6,rotationSpeed:2e-4,description:"地表半径750米，大气250米，公转速度~141m/s",hasAtmosphere:!0,atmosphereColor:13421772,atmosphereThickness:250},{name:"闯入者",nameEn:"The Interloper",color:8969710,emissive:6732748,size:77.5,mass:1e10,orbitA:18e3,orbitB:8e3,orbitSpeed:32e-5,rotationSpeed:3e-4,isComet:!0,description:"椭圆轨道彗星，直径155米，公转速度50~450m/s"},{name:"量子卫星",nameEn:"Quantum Moon",color:12237546,emissive:10132170,size:120,mass:1e10,moonOrbitRadius:1200,moonOrbitSpeed:8e-4,rotationSpeed:.0015,isQuantum:!0,description:"地表半径120米，浓厚银灰色云雾130米",hasAtmosphere:!0,atmosphereColor:10066346,atmosphereThickness:130}],Ce=["灰烬孪星","脆壳星","深巨星","黑棘星","木炉星"];class we{constructor(e=Math.random()){this.p=new Uint8Array(256),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let s=0;s<256;s++)this.p[s]=s;let o,a;for(let s=255;s>0;s--)e=e*16807%2147483647,o=e%(s+1),a=this.p[s],this.p[s]=this.p[o],this.p[o]=a;for(let s=0;s<512;s++)this.perm[s]=this.p[s&255],this.permMod12[s]=this.perm[s]%12;this.grad3=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6,this.F3=1/3,this.G3=1/6}noise2D(e,o){const{perm:a,permMod12:s,grad3:i,F2:r,G2:c}=this,n=(e+o)*r,l=Math.floor(e+n),d=Math.floor(o+n),g=(l+d)*c,M=l-g,C=d-g,u=e-M,v=o-C;let m,h;u>v?(m=1,h=0):(m=0,h=1);const S=u-m+c,f=v-h+c,p=u-1+2*c,k=v-1+2*c,b=l&255,A=d&255;let P=0,I=0,_=0,V=.5-u*u-v*v;if(V>=0){const D=s[b+a[A]]*3;V*=V,P=V*V*(i[D]*u+i[D+1]*v)}let R=.5-S*S-f*f;if(R>=0){const D=s[b+m+a[A+h]]*3;R*=R,I=R*R*(i[D]*S+i[D+1]*f)}let z=.5-p*p-k*k;if(z>=0){const D=s[b+1+a[A+1]]*3;z*=z,_=z*z*(i[D]*p+i[D+1]*k)}return 70*(P+I+_)}noise3D(e,o,a){const{perm:s,permMod12:i,grad3:r,F3:c,G3:n}=this,l=(e+o+a)*c,d=Math.floor(e+l),g=Math.floor(o+l),M=Math.floor(a+l),C=(d+g+M)*n,u=d-C,v=g-C,m=M-C,h=e-u,S=o-v,f=a-m;let p,k,b,A,P,I;h>=S?S>=f?(p=1,k=0,b=0,A=1,P=1,I=0):h>=f?(p=1,k=0,b=0,A=1,P=0,I=1):(p=0,k=0,b=1,A=1,P=0,I=1):S<f?(p=0,k=0,b=1,A=0,P=1,I=1):h<f?(p=0,k=1,b=0,A=0,P=1,I=1):(p=0,k=1,b=0,A=1,P=1,I=0);const _=h-p+n,V=S-k+n,R=f-b+n,z=h-A+2*n,D=S-P+2*n,N=f-I+2*n,L=h-1+3*n,B=S-1+3*n,q=f-1+3*n,Y=d&255,O=g&255,G=M&255;let H=0,E=0,Q=0,K=0,U=.6-h*h-S*S-f*f;if(U>=0){const j=i[Y+s[O+s[G]]]*3;U*=U,H=U*U*(r[j]*h+r[j+1]*S+r[j+2]*f)}let F=.6-_*_-V*V-R*R;if(F>=0){const j=i[Y+p+s[O+k+s[G+b]]]*3;F*=F,E=F*F*(r[j]*_+r[j+1]*V+r[j+2]*R)}let te=.6-z*z-D*D-N*N;if(te>=0){const j=i[Y+A+s[O+P+s[G+I]]]*3;te*=te,Q=te*te*(r[j]*z+r[j+1]*D+r[j+2]*N)}let oe=.6-L*L-B*B-q*q;if(oe>=0){const j=i[Y+1+s[O+1+s[G+1]]]*3;oe*=oe,K=oe*oe*(r[j]*L+r[j+1]*B+r[j+2]*q)}return 32*(H+E+Q+K)}}const ie=(t,e,o,a,s=4,i=2,r=.5)=>{let c=0,n=1,l=1,d=0;for(let g=0;g<s;g++)c+=t.noise3D(e*l,o*l,a*l)*n,d+=n,n*=r,l*=i;return c/d},qe={木炉星:{seed:12345,resolution:512,baseColors:[{color:[58,120,58],weight:.4},{color:[90,140,70],weight:.3},{color:[120,100,60],weight:.2},{color:[40,80,120],weight:.1}],noiseScale:3,octaves:5,bumpStrength:1.2,hasOcean:!0,oceanLevel:.35,oceanColor:[40,80,120]},余烬孪星:{seed:23456,resolution:512,baseColors:[{color:[196,92,58],weight:.5},{color:[180,70,40],weight:.3},{color:[220,120,60],weight:.2}],noiseScale:4,octaves:4,bumpStrength:1.5,hasLava:!0,lavaColor:[255,100,20]},灰烬孪星:{seed:34567,resolution:512,baseColors:[{color:[232,213,163],weight:.4},{color:[200,180,140],weight:.35},{color:[180,160,120],weight:.25}],noiseScale:5,octaves:4,bumpStrength:.8},脆壳星:{seed:45678,resolution:512,baseColors:[{color:[122,155,202],weight:.4},{color:[90,120,170],weight:.3},{color:[60,80,120],weight:.2},{color:[40,50,80],weight:.1}],noiseScale:4,octaves:5,bumpStrength:1.8,hasCracks:!0,crackColor:[20,10,40]},深巨星:{seed:56789,resolution:512,baseColors:[{color:[77,154,122],weight:.5},{color:[60,130,100],weight:.3},{color:[100,180,140],weight:.2}],noiseScale:2,octaves:6,bumpStrength:.4,isGasGiant:!0,bandColors:[[60,140,100],[80,160,120],[50,120,90]]},黑棘星:{seed:67890,resolution:512,baseColors:[{color:[58,90,74],weight:.5},{color:[40,70,55],weight:.3},{color:[30,50,40],weight:.2}],noiseScale:3,octaves:5,bumpStrength:2,hasBrambles:!0},量子卫星:{seed:78901,resolution:256,baseColors:[{color:[186,186,234],weight:.5},{color:[160,160,210],weight:.3},{color:[140,140,190],weight:.2}],noiseScale:4,octaves:3,bumpStrength:.6,isQuantum:!0},闯入者:{seed:89012,resolution:256,baseColors:[{color:[136,221,238],weight:.6},{color:[180,240,250],weight:.3},{color:[100,200,220],weight:.1}],noiseScale:6,octaves:3,bumpStrength:.5,isIcy:!0},废墟月亮:{seed:90123,resolution:256,baseColors:[{color:[136,136,136],weight:.5},{color:[100,100,100],weight:.3},{color:[80,80,80],weight:.2}],noiseScale:5,octaves:4,bumpStrength:1,hasCraters:!0}},vt=t=>{if(!t||!t.baseColors||t.baseColors.length===0)return null;const{seed:e,resolution:o,baseColors:a,noiseScale:s,octaves:i,hasOcean:r,oceanLevel:c,oceanColor:n,isGasGiant:l,bandColors:d,hasCracks:g,crackColor:M,hasLava:C,lavaColor:u}=t,v=document.createElement("canvas");v.width=o,v.height=o;const m=v.getContext("2d"),h=m.createImageData(o,o),S=h.data,f=new we(e),p=new we(e+1e3);for(let b=0;b<o;b++)for(let A=0;A<o;A++){const P=A/o,I=b/o,_=P*Math.PI*2,V=I*Math.PI,R=Math.sin(V)*Math.cos(_),z=Math.sin(V)*Math.sin(_),D=Math.cos(V);let N=ie(f,R*s,z*s,D*s,i);N=(N+1)*.5;let L,B,q;if(l&&d&&d.length>0){const O=ie(p,R*1.5,z*1.5,D*.5,3)*.3,G=(I+O)*d.length*3%d.length,H=Math.floor(G<0?G+d.length:G),E=d[Math.min(H,d.length-1)],Q=N*.3;L=Math.min(255,E[0]+Q*50),B=Math.min(255,E[1]+Q*50),q=Math.min(255,E[2]+Q*30)}else if(r&&n&&N<c){const O=(c-N)/c;L=n[0]*(1-O*.3),B=n[1]*(1-O*.2),q=n[2]*(1+O*.2)}else{let O=0;L=B=q=0,a.forEach((H,E)=>{const Q=ie(p,R*(s+E),z*(s+E),D*(s+E),3),K=H.weight*(.5+Q*.5);L+=H.color[0]*K,B+=H.color[1]*K,q+=H.color[2]*K,O+=K}),L/=O,B/=O,q/=O;const G=(N-.5)*40;L=Math.max(0,Math.min(255,L+G)),B=Math.max(0,Math.min(255,B+G)),q=Math.max(0,Math.min(255,q+G))}if(g&&M){const O=ie(p,R*8,z*8,D*8,2);if(Math.abs(O)<.08){const G=1-Math.abs(O)/.08;L=L*(1-G)+M[0]*G,B=B*(1-G)+M[1]*G,q=q*(1-G)+M[2]*G}}if(C&&u){const O=ie(p,R*6,z*6,D*6,3);if(O>.5){const G=(O-.5)*2;L=L*(1-G)+u[0]*G,B=B*(1-G)+u[1]*G,q=q*(1-G)+u[2]*G}}const Y=(b*o+A)*4;S[Y]=L,S[Y+1]=B,S[Y+2]=q,S[Y+3]=255}m.putImageData(h,0,0);const k=new Me(v);return k.wrapS=pe,k.wrapT=pe,k},gt=t=>{if(!t)return null;const{seed:e,resolution:o,noiseScale:a,octaves:s,bumpStrength:i,hasCraters:r}=t,c=document.createElement("canvas");c.width=o,c.height=o;const n=c.getContext("2d"),l=n.createImageData(o,o),d=l.data,g=new we(e),M=new we(e+500),C=new Float32Array(o*o);for(let m=0;m<o;m++)for(let h=0;h<o;h++){const S=h/o,f=m/o,p=S*Math.PI*2,k=f*Math.PI,b=Math.sin(k)*Math.cos(p),A=Math.sin(k)*Math.sin(p),P=Math.cos(k);let I=ie(g,b*a,A*a,P*a,s);if(r)for(let _=0;_<5;_++){const V=M.noise2D(_*10,0)*.5+.5,R=M.noise2D(0,_*10)*.5+.5,z=.05+M.noise2D(_,_)*.03,D=S-V,N=f-R,L=Math.sqrt(D*D+N*N);if(L<z){const B=(1-L/z)*.5;I-=B*(1-Math.pow(L/z,2))}}C[m*o+h]=I}const u=i*2;for(let m=0;m<o;m++)for(let h=0;h<o;h++){const S=(h-1+o)%o,f=(h+1)%o,p=(m-1+o)%o,k=(m+1)%o,b=C[m*o+S],A=C[m*o+f],P=C[p*o+h],I=C[k*o+h],_=(A-b)*u,V=(I-P)*u;let R=-_,z=-V,D=1;const N=Math.sqrt(R*R+z*z+D*D);R/=N,z/=N,D/=N;const L=(m*o+h)*4;d[L]=Math.floor((R*.5+.5)*255),d[L+1]=Math.floor((z*.5+.5)*255),d[L+2]=Math.floor((D*.5+.5)*255),d[L+3]=255}n.putImageData(l,0,0);const v=new Me(c);return v.wrapS=pe,v.wrapT=pe,v},bt=t=>{const{seed:e,resolution:o,noiseScale:a,hasOcean:s,oceanLevel:i}=t,r=document.createElement("canvas");r.width=o,r.height=o;const c=r.getContext("2d"),n=c.createImageData(o,o),l=n.data,d=new we(e+2e3);for(let M=0;M<o;M++)for(let C=0;C<o;C++){const u=C/o,v=M/o,m=u*Math.PI*2,h=v*Math.PI,S=Math.sin(h)*Math.cos(m),f=Math.sin(h)*Math.sin(m),p=Math.cos(h);let k=ie(d,S*a,f*a,p*a,4);k=(k+1)*.5;let b;s&&k<(i||.35)?b=.1+Math.random()*.1:b=.4+k*.4+Math.random()*.1;const A=Math.floor(b*255),P=(M*o+C)*4;l[P]=A,l[P+1]=A,l[P+2]=A,l[P+3]=255}c.putImageData(n,0,0);const g=new Me(r);return g.wrapS=pe,g.wrapT=pe,g},xt=t=>{const e=qe[t];if(!e||!e.baseColors)return null;const o=vt(e),a=gt(e),s=bt(e);return!o||!a?null:{diffuseMap:o,normalMap:a,roughnessMap:s}},ze={vertexShader:`
    varying vec3 vNormal;
    varying vec3 vPosition;
    varying vec3 vWorldPosition;
    
    void main() {
      vNormal = normalize(normalMatrix * normal);
      vPosition = position;
      vec4 worldPosition = modelMatrix * vec4(position, 1.0);
      vWorldPosition = worldPosition.xyz;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform vec3 glowColor;
    uniform float intensity;
    uniform float power;
    uniform vec3 sunPosition;
    uniform float atmosphereThickness;
    
    varying vec3 vNormal;
    varying vec3 vPosition;
    varying vec3 vWorldPosition;
    
    void main() {
      vec3 viewDirection = normalize(cameraPosition - vWorldPosition);
      float fresnel = pow(1.0 - abs(dot(viewDirection, vNormal)), power);
      
      vec3 sunDir = normalize(sunPosition - vWorldPosition);
      float sunInfluence = max(0.0, dot(vNormal, sunDir));
      float backScatter = pow(max(0.0, dot(-viewDirection, sunDir)), 3.0) * 0.3;
      
      float totalIntensity = intensity * fresnel * (0.6 + sunInfluence * 0.4 + backScatter);
      
      vec3 finalColor = glowColor * totalIntensity;
      float alpha = fresnel * intensity * 0.8;
      
      gl_FragColor = vec4(finalColor, alpha);
    }
  `},Mt=(t,e)=>{const{color:o=8965375,thickness:a=50,intensity:s=1,power:i=2.5,layers:r=2}=e,c=new W,n=new ve(o);for(let d=0;d<r;d++){const g=t+a*(.3+d/r*.7),M=s*(1-d*.3),C=i+d*.5,u=new $(g,48,48),v=new me({vertexShader:ze.vertexShader,fragmentShader:ze.fragmentShader,uniforms:{glowColor:{value:n},intensity:{value:M},power:{value:C},sunPosition:{value:new w(0,0,0)},atmosphereThickness:{value:a}},transparent:!0,blending:fe,side:ce,depthWrite:!1}),m=new x(u,v);m.userData.isAtmosphereLayer=!0,c.add(m)}const l=St(t,n,s);return c.add(l),c},St=(t,e,o)=>{const a=new $(t*1.02,48,48),s=new me({vertexShader:`
      varying vec3 vNormal;
      varying vec3 vViewPosition;
      
      void main() {
        vNormal = normalize(normalMatrix * normal);
        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
        vViewPosition = -mvPosition.xyz;
        gl_Position = projectionMatrix * mvPosition;
      }
    `,fragmentShader:`
      uniform vec3 glowColor;
      uniform float intensity;
      
      varying vec3 vNormal;
      varying vec3 vViewPosition;
      
      void main() {
        vec3 viewDir = normalize(vViewPosition);
        float rim = 1.0 - max(0.0, dot(viewDir, vNormal));
        rim = pow(rim, 3.0);
        
        vec3 finalColor = glowColor * rim * intensity * 0.5;
        float alpha = rim * intensity * 0.4;
        
        gl_FragColor = vec4(finalColor, alpha);
      }
    `,uniforms:{glowColor:{value:e},intensity:{value:o}},transparent:!0,blending:fe,side:_e,depthWrite:!1});return new x(a,s)},kt=(t,e)=>{t.children.forEach(o=>{o.material&&o.material.uniforms&&o.material.uniforms.sunPosition&&o.material.uniforms.sunPosition.value.copy(e)})},Pt={木炉星:{color:8965375,thickness:175,intensity:.8,power:2,layers:3},脆壳星:{color:10066363,thickness:50,intensity:.5,power:2.5,layers:2},深巨星:{color:6728328,thickness:450,intensity:1.2,power:1.8,layers:4},黑棘星:{color:11189162,thickness:250,intensity:.6,power:2.2,layers:2},量子卫星:{color:13421823,thickness:130,intensity:.7,power:2,layers:2}},Ve={vertexShader:`
    varying vec2 vUv;
    varying vec3 vNormal;
    varying vec3 vViewPosition;
    
    void main() {
      vUv = uv;
      vNormal = normalize(normalMatrix * normal);
      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
      vViewPosition = -mvPosition.xyz;
      gl_Position = projectionMatrix * mvPosition;
    }
  `,fragmentShader:`
    uniform float time;
    uniform vec3 color1;
    uniform vec3 color2;
    
    varying vec2 vUv;
    varying vec3 vNormal;
    varying vec3 vViewPosition;
    
    float noise(vec2 p) {
      return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453);
    }
    
    void main() {
      vec3 viewDir = normalize(vViewPosition);
      float rim = 1.0 - max(0.0, dot(viewDir, vNormal));
      rim = pow(rim, 1.5);
      
      float flicker = 0.8 + 0.2 * sin(time * 3.0 + vUv.x * 10.0) * sin(time * 2.0 + vUv.y * 8.0);
      float noise1 = noise(vUv * 20.0 + time * 0.5);
      
      vec3 finalColor = mix(color1, color2, rim) * (1.0 + noise1 * 0.2) * flicker;
      float alpha = rim * 0.8;
      
      gl_FragColor = vec4(finalColor, alpha);
    }
  `},Ct=t=>{const e=new W,o=new $(t*1.15,64,64),a=new me({vertexShader:Ve.vertexShader,fragmentShader:Ve.fragmentShader,uniforms:{time:{value:0},color1:{value:new ve(16755251)},color2:{value:new ve(16737792)}},transparent:!0,blending:fe,side:ce,depthWrite:!1});e.add(new x(o,a));const s=new $(t*1.4,32,32),i=new J({color:16729088,transparent:!0,opacity:.15,side:ce});e.add(new x(s,i));const r=new $(t*2,32,32),c=new J({color:16720384,transparent:!0,opacity:.05,side:ce});return e.add(new x(r,c)),e},At=(t,e)=>{t.children.forEach(o=>{o.material&&o.material.uniforms&&o.material.uniforms.time&&(o.material.uniforms.time.value=e)})},Dt=(t,e=6710886)=>{const o=new Ye(t,0),a=new T({color:e,roughness:.9,metalness:.1});return new x(o,a)},Rt=(t,e,o=4863784,a=2972199)=>{const s=new W,i=new se(t*.1,t*.15,t,6),r=new T({color:o,roughness:.9}),c=new x(i,r);c.position.y=t/2,s.add(c);const n=new $e(e,1),l=new T({color:a,roughness:.8}),d=new x(n,l);return d.position.y=t+e*.5,s.add(d),s},zt=(t,e,o,a=9139029)=>{const s=new W,i=new he(t,e,o),r=new T({color:a,roughness:.7}),c=new x(i,r);c.position.y=e/2,s.add(c);const n=new le(t*.8,e*.4,4),l=new T({color:5917242,roughness:.8}),d=new x(n,l);return d.position.y=e+e*.2,d.rotation.y=Math.PI/4,s.add(d),s},Vt=(t,e=8943462)=>{const o=new W,a=new he(t*.3,t*.1,t*.3),s=new T({color:e,roughness:.6}),i=new x(a,s);i.position.y=t*.05,o.add(i);const r=new he(t*.15,t*.8,t*.15),c=new x(r,s);c.position.y=t*.5,o.add(c);const n=new Ee(t*.12,0),l=new T({color:11193599,emissive:4482730,emissiveIntensity:.5,roughness:.3}),d=new x(n,l);return d.position.y=t*.95,o.add(d),o},Gt=(t,e=12888194)=>{const o=new W,a=new se(t*.15,t*.2,t,8),s=new T({color:e,roughness:.7}),i=new x(a,s);i.position.y=t/2,o.add(i);const r=new le(t*.2,t*.3,8),c=new x(r,s);return c.position.y=t+t*.15,o.add(c),o},Lt=(t,e=8969727)=>{const o=new W,a=new Ee(t,0),s=new T({color:e,emissive:e,emissiveIntensity:.3,roughness:.2,metalness:.8,transparent:!0,opacity:.8}),i=new x(a,s);return i.scale.y=2,o.add(i),o},It=(t,e=2771514)=>{const o=new W,a=new le(t*.3,t,5),s=new T({color:e,roughness:.8}),i=new x(a,s);i.position.y=t/2,o.add(i);for(let r=0;r<3;r++){const c=new le(t*.15,t*.5,4),n=new x(c,s);n.position.y=t*.3,n.position.x=Math.cos(r*Math.PI*2/3)*t*.2,n.position.z=Math.sin(r*Math.PI*2/3)*t*.2,n.rotation.z=Math.PI/6*(r%2===0?1:-1),o.add(n)}return o},_t=t=>{const e=new W,o=new $(t,16,16),a=new T({color:11206570,emissive:6750054,emissiveIntensity:.8,roughness:.3}),s=new x(o,a);e.add(s);const i=new $(t*2,16,16),r=new J({color:4521796,transparent:!0,opacity:.2}),c=new x(i,r);return e.add(c),e},Et=t=>{const e=new W,o=new Xe(t,0),a=new T({color:13421806,emissive:8947882,emissiveIntensity:.4,roughness:.4,metalness:.6}),s=new x(o,a);return s.rotation.set(Math.random(),Math.random(),Math.random()),e.add(s),e},Tt=(t,e=8943462)=>{const o=new W;for(let r=0;r<4;r++){const c=t*(.5+Math.random()*.5),n=new se(t*.1,t*.12,c,6),l=new T({color:e,roughness:.8}),d=new x(n,l);d.position.x=Math.cos(r*Math.PI/2)*t*.4,d.position.z=Math.sin(r*Math.PI/2)*t*.4,d.position.y=c/2,o.add(d)}const a=new he(t,t*.1,t),s=new T({color:e,roughness:.8}),i=new x(a,s);return i.position.y=t*.05,o.add(i),o},Ot=t=>{const e=new W,o=new se(t,t,t*.1,16),a=new T({color:5592405,roughness:.5,metalness:.3}),s=new x(o,a);s.position.y=t*.05,e.add(s);const i=new Ae(t*.8,t*.05,8,32),r=new T({color:16755200,emissive:16746496,emissiveIntensity:.3}),c=new x(i,r);return c.rotation.x=Math.PI/2,c.position.y=t*.12,e.add(c),e},Qt=t=>{const e=new W,o=new se(t*.3,t*.4,t*.2,8),a=new T({color:4473924,roughness:.5,metalness:.5}),s=new x(o,a);s.position.y=t*.1,e.add(s);const i=new se(t*.1,t*.15,t*.8,8),r=new T({color:6710886,roughness:.4,metalness:.6}),c=new x(i,r);return c.position.y=t*.5,c.rotation.x=Math.PI/6,e.add(c),e},Ft=t=>{const e=new W,o=new se(t*.05,t*.05,t,8),a=new T({color:9127187}),s=new x(o,a);s.position.y=t/2,e.add(s);const i=new He(t*.4,t*.25),r=new T({color:5085818,side:ge,emissive:2976330,emissiveIntensity:.2}),c=new x(i,r);return c.position.y=t*.85,c.position.x=t*.2,e.add(c),e},Bt=t=>{const e=new W,o=new Ae(t,t*.2,8,16),a=new T({color:5592405,roughness:.9}),s=new x(o,a);return s.rotation.x=Math.PI/2,e.add(s),e},Nt=t=>{const e=new W,o=new Ae(t,t*.1,8,32),a=new T({color:12888194,roughness:.5,metalness:.3}),s=new x(o,a);s.rotation.x=Math.PI/2,s.position.y=t,e.add(s);const i=new Ke(t*.85,32),r=new J({color:4482730,transparent:!0,opacity:.5,side:ge}),c=new x(i,r);c.rotation.x=Math.PI/2,c.position.y=t,e.add(c);const n=new se(t*.15,t*.2,t*.3,8),l=new x(n,a);return l.position.y=t*.15,e.add(l),e},Ue={余烬孪星:{landmarks:[{type:"ruin",count:3,sizeRange:[8,15],color:10518624},{type:"obelisk",count:5,sizeRange:[6,12]},{type:"rock",count:20,sizeRange:[2,6],color:12868666}]},灰烬孪星:{landmarks:[{type:"tower",count:4,sizeRange:[10,20],color:13943970},{type:"portal",count:2,sizeRange:[5,8]},{type:"rock",count:15,sizeRange:[2,5],color:15259043}]},木炉星:{landmarks:[{type:"building",count:8,sizeRange:[4,8]},{type:"tree",count:25,sizeRange:[5,12]},{type:"launchPad",count:1,sizeRange:[6,6]},{type:"telescope",count:2,sizeRange:[4,6]},{type:"rock",count:15,sizeRange:[1,4]}]},废墟月亮:{landmarks:[{type:"crater",count:5,sizeRange:[3,8]},{type:"ruin",count:2,sizeRange:[5,10],color:6710886},{type:"rock",count:20,sizeRange:[1,4],color:8947848}]},脆壳星:{landmarks:[{type:"tower",count:3,sizeRange:[12,18],color:9087690},{type:"ruin",count:4,sizeRange:[8,14],color:8035274},{type:"crystal",count:8,sizeRange:[3,7],color:6719692},{type:"rock",count:15,sizeRange:[2,5],color:5929898}]},深巨星:{landmarks:[{type:"islandMarker",count:6,sizeRange:[8,12]},{type:"tower",count:2,sizeRange:[15,25],color:6138506},{type:"rock",count:10,sizeRange:[3,8],color:5085818}]},黑棘星:{landmarks:[{type:"thorn",count:30,sizeRange:[8,20]},{type:"glowingSeed",count:15,sizeRange:[1,3]},{type:"rock",count:10,sizeRange:[3,8],color:3824202}]},闯入者:{landmarks:[{type:"crystal",count:12,sizeRange:[2,6],color:11202303},{type:"rock",count:10,sizeRange:[1,4],color:8969710}]},量子卫星:{landmarks:[{type:"quantumShard",count:20,sizeRange:[2,5]},{type:"obelisk",count:3,sizeRange:[5,10]},{type:"rock",count:10,sizeRange:[1,4],color:12237546}]}},qt={rock:(t,e)=>Dt(t,e),tree:t=>Rt(t,t*.6),building:t=>zt(t,t*1.5,t),obelisk:t=>Vt(t),tower:(t,e)=>Gt(t,e),crystal:(t,e)=>Lt(t,e),thorn:t=>It(t),glowingSeed:t=>_t(t),quantumShard:t=>Et(t),ruin:(t,e)=>Tt(t,e),launchPad:t=>Ot(t),telescope:t=>Qt(t),islandMarker:t=>Ft(t),crater:t=>Bt(t),portal:t=>Nt(t)},Ut=(t,e,o)=>{const a=Ue[t];if(!a)return;let s=0;for(let r=0;r<t.length;r++)s+=t.charCodeAt(r);const i=()=>{const r=Math.sin(s++)*1e4;return r-Math.floor(r)};a.landmarks.forEach(r=>{const{type:c,count:n,sizeRange:l,color:d}=r,g=qt[c];if(g)for(let M=0;M<n;M++){const C=l[0]+i()*(l[1]-l[0]),u=g(C,d),v=i()*Math.PI*2,m=Math.acos(2*i()-1),h=Math.sin(m)*Math.cos(v),S=Math.sin(m)*Math.sin(v),f=Math.cos(m),p=new w(h,S,f).multiplyScalar(e);u.position.copy(p);const k=p.clone().normalize(),b=new w(0,1,0),A=new X().setFromUnitVectors(b,k);u.quaternion.copy(A),u.rotateY(i()*Math.PI*2),o.add(u)}})},Wt=()=>{const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d"),o=e.createRadialGradient(32,32,0,32,32,32);return o.addColorStop(0,"rgba(255, 255, 255, 1)"),o.addColorStop(.15,"rgba(255, 255, 255, 1)"),o.addColorStop(.3,"rgba(255, 255, 255, 0.8)"),o.addColorStop(.5,"rgba(255, 255, 255, 0.4)"),o.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=o,e.fillRect(0,0,64,64),new Me(t)},jt=()=>{const t=new De,e=[],o=[];for(let s=0;s<15e3;s++){const i=4e4+Math.random()*5e4,r=Math.random()*Math.PI*2,c=Math.acos(2*Math.random()-1);e.push(i*Math.sin(c)*Math.cos(r),i*Math.sin(c)*Math.sin(r),i*Math.cos(c));const n=Math.random();n<.1?o.push(1,.9,.7):n<.2?o.push(.85,.95,1):o.push(1,1,1)}t.setAttribute("position",new be(e,3)),t.setAttribute("color",new be(o,3));const a=new Ze({size:2.5,map:Wt(),vertexColors:!0,transparent:!0,opacity:1,sizeAttenuation:!0,depthWrite:!1,blending:fe});return new Je(t,a)},Kt=t=>{const e=new W,o=t.name==="木炉星"?0:Math.random()*Math.PI*2;e.userData={...t,angle:o};const a=t.isStar||qe[t.name]?64:32,s=new $(t.size,a,a);let i;if(t.isStar)i=new J({color:t.color});else{const n=xt(t.name);n?i=new T({map:n.diffuseMap,normalMap:n.normalMap,normalScale:new et(1.5,1.5),roughnessMap:n.roughnessMap,roughness:.7,metalness:.1,emissive:new ve(t.emissive),emissiveIntensity:.15}):i=new T({color:t.color,emissive:t.emissive,emissiveIntensity:.4,roughness:.6,metalness:.2})}const r=new x(s,i);if(e.add(r),e.userData.mesh=r,!t.isStar){const n=new W;Ue[t.name]&&Ut(t.name,t.size,n),r.add(n)}let c=null;if(t.isStar){c=Ct(t.size),e.add(c);const n=new Te(16768392,3,5e4);e.add(n)}if(t.hasAtmosphere&&t.atmosphereThickness){const n=Pt[t.name];if(n){const l=Mt(t.size,n);l.userData.isAtmosphere=!0,e.add(l),e.userData.atmosphere=l}else{const l=t.size+t.atmosphereThickness,d=new $(l,48,48),g=new J({color:t.atmosphereColor,transparent:!0,opacity:.12,side:ce});e.add(new x(d,g))}}if(t.hasBlackHole){const n=t.blackHoleSize||t.size*.15,l=new $(n,32,32),d=new J({color:0}),g=new x(l,d);g.position.set(0,0,0),e.add(g);const M=new tt(n*1.2,n*2.5,64),C=new me({vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        varying vec2 vUv;
        void main() {
          float dist = length(vUv - 0.5) * 2.0;
          float alpha = smoothstep(0.0, 0.5, dist) * smoothstep(1.0, 0.6, dist);
          vec3 color = mix(vec3(0.5, 0.3, 1.0), vec3(0.2, 0.1, 0.5), dist);
          gl_FragColor = vec4(color, alpha * 0.7);
        }
      `,transparent:!0,side:ge,depthWrite:!1,blending:fe}),u=new x(M,C);u.rotation.x=Math.PI/2,e.add(u);const v=new $(n*1.8,32,32),m=new J({color:4465322,transparent:!0,opacity:.25,side:ce});e.add(new x(v,m))}if(t.isComet){const n=new le(t.size*.6,t.size*5,8),l=new J({color:6741503,transparent:!0,opacity:.3,side:ge}),d=new x(n,l);d.rotation.x=Math.PI/2,d.position.z=t.size*2.5,e.add(d),e.userData.tail=d}if(t.isQuantum){const n=t.size+(t.atmosphereThickness||130),l=new $(n,48,48),d=new me({vertexShader:`
        varying vec3 vNormal;
        varying vec3 vViewPosition;
        void main() {
          vNormal = normalize(normalMatrix * normal);
          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
          vViewPosition = -mvPosition.xyz;
          gl_Position = projectionMatrix * mvPosition;
        }
      `,fragmentShader:`
        varying vec3 vNormal;
        varying vec3 vViewPosition;
        void main() {
          vec3 viewDir = normalize(vViewPosition);
          float rim = 1.0 - abs(dot(viewDir, vNormal));
          float density = 0.85 + rim * 0.15;
          vec3 fogColor = vec3(0.35, 0.35, 0.4);
          gl_FragColor = vec4(fogColor, density);
        }
      `,transparent:!0,side:_e,depthWrite:!1}),g=new x(l,d);e.add(g);const M=new $(t.size*1.05,32,32),C=new J({color:4473941,transparent:!0,opacity:.95});e.add(new x(M,C));const u=new $(n*1.08,32,32),v=new J({color:5592422,transparent:!0,opacity:.1,side:ce});e.add(new x(u,v))}return{group:e,sunCoronaGroup:c}},Ge=(t,e=!1)=>{const a=new De,s=[];for(let c=0;c<=128;c++){const n=c/128*Math.PI*2;s.push(Math.cos(n)*t,0,Math.sin(n)*t)}a.setAttribute("position",new be(s,3));const i=e?new Oe({color:4478310,transparent:!0,opacity:.3,dashSize:2,gapSize:1}):new ot({color:3359829,transparent:!0,opacity:.25}),r=new Qe(a,i);return e&&r.computeLineDistances(),r},Ht=(t,e)=>{const a=new De,s=[],i=Math.sqrt(t*t-e*e);for(let n=0;n<=128;n++){const l=n/128*Math.PI*2;s.push(Math.cos(l)*t-i,0,Math.sin(l)*e)}a.setAttribute("position",new be(s,3));const r=new Oe({color:4491434,transparent:!0,opacity:.35,dashSize:1.5,gapSize:1}),c=new Qe(a,r);return c.computeLineDistances(),c},Xt=t=>{const e=new W,o=new le(1.5,6,8),a=new T({color:13404228,emissive:4465169,emissiveIntensity:.3,roughness:.4,metalness:.6}),s=new x(o,a);s.rotation.x=Math.PI/2,e.add(s);const i=new he(8,.3,2),r=new T({color:8939059,roughness:.5,metalness:.4}),c=new x(i,r);c.position.z=1,e.add(c);const n=new $(1,16,16,0,Math.PI*2,0,Math.PI/2),l=new T({color:8965375,transparent:!0,opacity:.7,roughness:.1,metalness:.8}),d=new x(n,l);d.rotation.x=-Math.PI/2,d.position.z=-1.5,e.add(d);const g=new se(.8,1,1.5,8),M=new T({color:4473924,roughness:.3,metalness:.8}),C=new x(g,M);C.rotation.x=Math.PI/2,C.position.z=3.5,e.add(C);const u=(h,S,f=1)=>{const p=new le(.5*f,2*f,8),k=new J({color:16737792,transparent:!0,opacity:0,depthTest:!1}),b=new x(p,k);return b.position.copy(h),b.rotation.set(S.x,S.y,S.z),b.renderOrder=999,e.add(b),b},v={back:u(new w(0,0,5),new w(-Math.PI/2,0,0),1.2),front:u(new w(0,0,-4),new w(Math.PI/2,0,0),.8),left:u(new w(2,0,0),new w(0,0,Math.PI/2),.6),right:u(new w(-2,0,0),new w(0,0,-Math.PI/2),.6),bottom:u(new w(0,2,1),new w(0,0,0),.6),top:u(new w(0,-2,1),new w(Math.PI,0,0),.6)};e.userData.thrusters=v;const m=new Te(16777130,.5,50);return m.position.set(0,0,-2.5),e.add(m),e.position.copy(t),e},Le=(t,e)=>{const o=t==null?void 0:t.userData.thrusters;if(!o)return;const a=.8+Math.random()*.4;o.back.material.opacity=e.forward?.9:0,e.forward&&(o.back.scale.y=a),o.front.material.opacity=e.backward?.8:0,e.backward&&(o.front.scale.y=a),o.left.material.opacity=e.left?.7:0,e.left&&(o.left.scale.y=a),o.right.material.opacity=e.right?.7:0,e.right&&(o.right.scale.y=a),o.top.material.opacity=e.up?.7:0,e.up&&(o.top.scale.y=a),o.bottom.material.opacity=e.down?.7:0,e.down&&(o.bottom.scale.y=a)},$t=(t,e)=>{const o=new w;return e.forEach(a=>{const s=a.userData;if(!s.mass)return;const i=new w().subVectors(a.position,t),r=i.length();if(r<s.size)return;const c=ft*s.mass/(r*r);i.normalize().multiplyScalar(c),o.add(i)}),o},ke=(t,e)=>{let o=null,a=1/0;return e.forEach(s=>{const i=s.userData;if(i.isStar)return;const r=t.distanceTo(s.position)-i.size;r<a&&(a=r,o=s)}),{body:o,distance:a}},re=(t,e,o)=>{const a=t.userData;if(a.isStar)return new w(0,0,0);const s=t.position.clone(),i=.016;let r,c;if(a.isComet&&a.orbitA&&a.orbitB){const n=Math.sqrt(a.orbitA*a.orbitA-a.orbitB*a.orbitB),l=a.angle+a.orbitSpeed*i*60;r=Math.cos(l)*a.orbitA-n,c=Math.sin(l)*a.orbitB}else if(a.isTwin){const n=o+Ne*i*60,l=Math.cos(n)*a.orbitRadius,d=Math.sin(n)*a.orbitRadius,g=400,M=n*10;r=l+Math.cos(M)*g*a.twinSide,c=d+Math.sin(M)*g*a.twinSide}else if(a.moonOf){const n=e.find(l=>l.userData.name===a.moonOf);if(n){const l=re(n,e,o),d=(a.moonAngle||0)+a.moonOrbitSpeed*i*60,g=-Math.sin(d)*a.moonOrbitRadius*a.moonOrbitSpeed*60,M=Math.cos(d)*a.moonOrbitRadius*a.moonOrbitSpeed*60;return new w(l.x+g,0,l.z+M)}return new w(0,0,0)}else if(a.orbitRadius){const n=a.angle+a.orbitSpeed*i*60;r=Math.cos(n)*a.orbitRadius,c=Math.sin(n)*a.orbitRadius}else return new w(0,0,0);return new w((r-s.x)/i,0,(c-s.z)/i)},Ie=(t,e,o,a,s)=>{let i=o+Ne*t*60,r=s;return e.forEach(c=>{const n=c.userData;if(n.isQuantum){const l=Ce[a],d=e.find(g=>g.userData.name===l);d&&(r+=n.moonOrbitSpeed*t*60,c.position.x=d.position.x+Math.cos(r)*n.moonOrbitRadius,c.position.y=Math.sin(r)*n.moonOrbitRadius*.3,c.position.z=d.position.z+Math.sin(r)*n.moonOrbitRadius);return}if(n.moonOf){const l=e.find(d=>d.userData.name===n.moonOf);l&&(n.moonAngle=(n.moonAngle||0)+n.moonOrbitSpeed*t*60,c.position.x=l.position.x+Math.cos(n.moonAngle)*n.moonOrbitRadius,c.position.y=Math.sin(n.moonAngle)*n.moonOrbitRadius*.2,c.position.z=l.position.z+Math.sin(n.moonAngle)*n.moonOrbitRadius);return}if(n.orbitRadius>0||n.isComet)if(n.angle+=n.orbitSpeed*t*60,n.isComet&&n.orbitA&&n.orbitB){const l=Math.sqrt(n.orbitA*n.orbitA-n.orbitB*n.orbitB);if(c.position.x=Math.cos(n.angle)*n.orbitA-l,c.position.z=Math.sin(n.angle)*n.orbitB,n.tail){const d=n.orbitA*Math.sin(n.angle),g=-n.orbitB*Math.cos(n.angle);c.rotation.y=Math.atan2(d,g)}}else if(n.isTwin){const l=Math.cos(i)*n.orbitRadius,d=Math.sin(i)*n.orbitRadius,g=400,M=i*10;c.position.x=l+Math.cos(M)*g*n.twinSide,c.position.z=d+Math.sin(M)*g*n.twinSide}else c.position.x=Math.cos(n.angle)*n.orbitRadius,c.position.z=Math.sin(n.angle)*n.orbitRadius;n.mesh&&n.rotationSpeed&&(n.mesh.rotation.y+=n.rotationSpeed*t*60)}),{twinSystemAngle:i,quantumAngle:r}};let Pe=0;const Yt=t=>{const e=Se({position:new w().copy(t),velocity:new w(0,0,0),rotation:new Fe(0,0,0),thrust:25,rotationSpeed:1.5,maxSpeed:500,fuel:100,isLanded:!1,landedOn:null,landedLocalDir:null,landedLocalQuaternion:new X,isMatchingVelocity:!1,targetVelocity:new w(0,0,0),matchingTarget:null,initialVelocityDiff:0}),o=Se({forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1,rollLeft:!1,rollRight:!1,pitchUp:!1,pitchDown:!1,boost:!1,matchVelocity:!1}),a=Se({speed:0,altitude:0,nearestBody:null,nearestDistance:0,isThrusting:!1,isMatchingVelocity:!1,matchingProgress:0}),s=ye("first");let i=null;const r=u=>{i=u},c=(u,v)=>{if(e.isMatchingVelocity){e.isMatchingVelocity=!1,e.matchingTarget=null,e.initialVelocityDiff=0;return}const m=ke(e.position,u);m.body&&(e.isMatchingVelocity=!0,e.matchingTarget=m.body,e.targetVelocity.copy(re(m.body,u,v)),e.initialVelocityDiff=new w().subVectors(e.targetVelocity,e.velocity).length())},n=(u,v,m)=>{if(!e.isMatchingVelocity||!e.matchingTarget)return;const h=re(e.matchingTarget,v,m);e.targetVelocity.copy(h);const S=new w().subVectors(e.targetVelocity,e.velocity),f=S.length();if(f<.5){e.velocity.copy(e.targetVelocity),e.isMatchingVelocity=!1,e.matchingTarget=null;return}const k=25*u;if(f<=k)e.velocity.copy(e.targetVelocity);else{const b=S.normalize().multiplyScalar(k);e.velocity.add(b)}a.matchingProgress=(1-f/e.initialVelocityDiff)*100},l=(u,v)=>{if(!e.isLanded||!e.landedOn)return;const m=e.landedOn,h=new w().subVectors(e.position,m.position).normalize(),S=re(m,u,v);e.velocity.copy(S).add(h.multiplyScalar(2));const f=m.userData.rotationSpeed||0,p=m.userData.size+.5,k=new w(0,1,0),b=new w(h.x,0,h.z);if(b.lengthSq()>.001){b.normalize();const A=new w().crossVectors(k,b).normalize(),I=Math.sqrt(h.x*h.x+h.z*h.z)*p*f;e.velocity.add(A.multiplyScalar(I))}e.isLanded=!1,e.landedOn=null,e.landedLocalDir=null};return{ship:e,controls:o,hud:a,viewMode:s,setShipMesh:r,matchVelocityWithNearest:c,launch:l,updateShip:(u,v,m)=>{var _;if(Pe=m,e.isLanded&&e.landedOn){const V=e.landedOn,R=V.userData.mesh,z=R?R.rotation.y:0,D=new X().setFromAxisAngle(new w(0,1,0),z),N=e.landedLocalDir.clone().applyQuaternion(D);e.position.copy(V.position).add(N.multiplyScalar(V.userData.size+.5));const L=D.clone().multiply(e.landedLocalQuaternion);if(e.rotation.setFromQuaternion(L),a.speed="0",a.altitude="0",o.forward||o.backward||o.left||o.right){const B=7*(o.boost?3:1)*u,q=(o.forward?1:0)-(o.backward?1:0),Y=(o.right?1:0)-(o.left?1:0),O=new w(0,0,-1).applyQuaternion(e.landedLocalQuaternion),G=new w(1,0,0).applyQuaternion(e.landedLocalQuaternion),H=new w().addScaledVector(O,q).addScaledVector(G,Y).normalize();if(H.lengthSq()>.001){const E=e.landedLocalDir.clone().normalize(),Q=new w().crossVectors(E,H).normalize(),K=B/(V.userData.size+.5),U=new X().setFromAxisAngle(Q,K);e.landedLocalDir.applyQuaternion(U),e.landedLocalQuaternion.premultiply(U)}}o.up&&l(v,m),i&&(i.position.copy(e.position),i.rotation.copy(e.rotation),Le(i,o));return}const h=new X().setFromEuler(e.rotation),S=new w(0,0,-1).applyQuaternion(h),f=new w(1,0,0).applyQuaternion(h),p=new w(0,1,0).applyQuaternion(h),k=o.boost?2.5:1;o.forward&&e.velocity.add(S.clone().multiplyScalar(e.thrust*k*u)),o.backward&&e.velocity.add(S.clone().multiplyScalar(-e.thrust*.5*u)),o.left&&e.velocity.add(f.clone().multiplyScalar(-e.thrust*.5*u)),o.right&&e.velocity.add(f.clone().multiplyScalar(e.thrust*.5*u)),o.up&&e.velocity.add(p.clone().multiplyScalar(e.thrust*.5*u)),o.down&&e.velocity.add(p.clone().multiplyScalar(-e.thrust*.5*u));const b=$t(e.position,v);e.velocity.add(b.multiplyScalar(u)),n(u,v,m),e.velocity.length()>e.maxSpeed&&e.velocity.normalize().multiplyScalar(e.maxSpeed),e.position.add(e.velocity.clone().multiplyScalar(u)),i&&(i.position.copy(e.position),i.rotation.copy(e.rotation),Le(i,o));const P=ke(e.position,v);let I=e.velocity.length();if(P.body){const V=re(P.body,v,Pe);I=new w().subVectors(e.velocity,V).length()}if(a.speed=I.toFixed(0),a.nearestBody=((_=P.body)==null?void 0:_.userData.name)||null,a.nearestDistance=P.distance.toFixed(0),a.altitude=P.distance.toFixed(0),a.isThrusting=o.forward||o.backward||o.left||o.right||o.up||o.down,a.isMatchingVelocity=e.isMatchingVelocity,P.distance<.5&&P.body){e.isLanded=!0,e.landedOn=P.body;const V=P.body.userData.mesh?P.body.userData.mesh.rotation.y:0;e.landedLocalDir=new w().subVectors(e.position,P.body.position).normalize(),e.landedLocalDir.applyAxisAngle(new w(0,1,0),-V);const R=new X().setFromEuler(e.rotation),z=new X().setFromAxisAngle(new w(0,1,0),V);e.landedLocalQuaternion.copy(z.invert().multiply(R));const D=re(P.body,v,Pe);e.velocity.copy(D)}},updateCamera:(u,v)=>{const m=new X;m.setFromEuler(e.rotation),new w(0,0,-1).applyQuaternion(m);const h=new w(0,1,0).applyQuaternion(m),S=new w(0,0,1).applyQuaternion(m);if(s.value==="first")u.position.copy(e.position),u.quaternion.copy(m),i&&(i.visible=!1);else if(s.value==="third"){const f=S.clone().multiplyScalar(40).add(h.clone().multiplyScalar(15));u.position.copy(e.position).add(f),u.lookAt(e.position),i&&(i.visible=!0)}else if(s.value==="orbit"){const f=ke(e.position,v);if(f.body){const p=f.body.position.clone(),k=new w().subVectors(e.position,p).normalize();u.position.copy(p).add(k.multiplyScalar(f.body.userData.size*4+10)),u.lookAt(e.position),i&&(i.visible=!0)}}},handleMouseMove:(u,v)=>{if(!v)return;const m=.002;if(e.isLanded&&e.landedOn){const p=e.landedLocalDir.clone().normalize(),k=new w(0,0,-1).applyQuaternion(e.landedLocalQuaternion);let b=new w().crossVectors(k,p).normalize();if(b.lengthSq()<.001){const _=new w(0,1,0).applyQuaternion(e.landedLocalQuaternion);b=new w().crossVectors(_,p).normalize()}const A=new X().setFromAxisAngle(p,-u.movementX*m),P=new X().setFromAxisAngle(b,-u.movementY*m);e.landedLocalQuaternion.premultiply(A),e.landedLocalQuaternion.multiply(P);const I=new w(0,0,-1).applyQuaternion(e.landedLocalQuaternion);if(Math.abs(I.dot(p))<.999){const _=new w().crossVectors(I,p).normalize(),V=new w().crossVectors(p,_).normalize(),R=new nt().makeBasis(_,p,V.negate());e.landedLocalQuaternion.setFromRotationMatrix(R)}return}const h=new X().setFromEuler(e.rotation),S=new X().setFromAxisAngle(new w(0,1,0),-u.movementX*m),f=new X().setFromAxisAngle(new w(1,0,0),-u.movementY*m);h.multiply(S),h.multiply(f),e.rotation.setFromQuaternion(h)},cycleViewMode:()=>{const u=["first","third","orbit"],v=u.indexOf(s.value);s.value=u[(v+1)%u.length]}}},Zt={class:"backdrop-blur-sm bg-black/50 rounded-xl border border-cyan-500/30 p-4 min-w-[220px]"},Jt={class:"text-xs text-cyan-300/60 uppercase tracking-wider mb-3 flex items-center gap-2"},eo={key:0,class:"px-1.5 py-0.5 bg-orange-500/30 text-orange-300 rounded text-[10px] animate-pulse"},to={key:1,class:"px-1.5 py-0.5 bg-cyan-500/30 text-cyan-300 rounded text-[10px] animate-pulse"},oo={class:"space-y-2 text-sm"},no={class:"flex justify-between"},ao={class:"text-cyan-100 font-mono"},so={class:"flex justify-between"},io={class:"text-cyan-100 font-mono"},ro={key:0,class:"flex justify-between items-center"},co={class:"text-amber-200"},lo={key:1,class:"flex justify-between"},uo={class:"text-amber-200"},po={key:2,class:"mt-2 pt-2 border-t border-cyan-500/20"},mo={class:"flex justify-between items-center"},ho={class:"text-cyan-300 font-mono text-xs"},wo={class:"mt-1.5 h-1.5 bg-cyan-900/50 rounded-full overflow-hidden"},fo={class:"mt-3 pt-3 border-t border-cyan-500/20"},yo={class:"flex justify-between text-xs"},vo={class:"text-cyan-100/80 font-mono text-[10px]"},go={__name:"SpaceshipHUD",props:{hud:{type:Object,required:!0},ship:{type:Object,required:!0}},setup(t){return(e,o)=>{var a,s;return ee(),ne("div",Zt,[y("div",Jt,[o[0]||(o[0]=Z(" 飞船状态 ",-1)),t.hud.isThrusting?(ee(),ne("span",eo," 推进中 ")):ue("",!0),t.hud.isMatchingVelocity?(ee(),ne("span",to," 速度同步 ")):ue("",!0)]),y("div",oo,[y("div",no,[o[1]||(o[1]=y("span",{class:"text-cyan-200/60"},"速度",-1)),y("span",ao,ae(t.hud.speed)+" m/s",1)]),y("div",so,[o[2]||(o[2]=y("span",{class:"text-cyan-200/60"},"距离",-1)),y("span",io,ae(t.hud.altitude)+" m",1)]),t.ship.isLanded?(ee(),ne("div",ro,[o[3]||(o[3]=y("span",{class:"text-green-300 flex items-center gap-1.5"}," 已降落 ",-1)),y("span",co,ae((a=t.ship.landedOn)==null?void 0:a.userData.name),1)])):t.hud.nearestBody?(ee(),ne("div",lo,[o[4]||(o[4]=y("span",{class:"text-cyan-200/60"},"最近天体",-1)),y("span",uo,ae(t.hud.nearestBody),1)])):ue("",!0),t.hud.isMatchingVelocity?(ee(),ne("div",po,[y("div",mo,[o[5]||(o[5]=y("span",{class:"text-cyan-200/60"},"同步中",-1)),y("span",ho,ae((s=t.ship.matchingTarget)==null?void 0:s.userData.name),1)]),y("div",wo,[y("div",{class:"h-full bg-gradient-to-r from-cyan-500 to-cyan-300 transition-all duration-150",style:lt({width:`${t.ship.initialVelocityDiff>.5?Math.max(0,100-Math.sqrt(Math.pow(t.ship.velocity.x-t.ship.targetVelocity.x,2)+Math.pow(t.ship.velocity.z-t.ship.targetVelocity.z,2))/t.ship.initialVelocityDiff*100):100}%`})},null,4)])])):ue("",!0)]),y("div",fo,[y("div",yo,[o[6]||(o[6]=y("span",{class:"text-cyan-200/60"},"坐标 (m)",-1)),y("span",vo,ae(Math.round(t.ship.position.x))+", "+ae(Math.round(t.ship.position.y))+", "+ae(Math.round(t.ship.position.z)),1)])])])}}},bo={key:0},xo={__name:"ControlsPanel",props:{visible:{type:Boolean,default:!0}},setup(t){return(e,o)=>(ee(),dt(ut,{"enter-active-class":"transition-all duration-300 ease-out","leave-active-class":"transition-all duration-200 ease-in","enter-from-class":"opacity-0 translate-x-4","leave-to-class":"opacity-0 translate-x-4"},{default:Be(()=>[t.visible?(ee(),ne("div",bo,[...o[0]||(o[0]=[y("div",{class:"backdrop-blur-sm bg-black/50 rounded-xl border border-cyan-500/30 p-4 text-xs"},[y("div",{class:"text-cyan-300/60 uppercase tracking-wider mb-3"},"控制说明 (H 隐藏)"),y("div",{class:"grid grid-cols-2 gap-x-6 gap-y-1 text-cyan-200/80"},[y("div",null,[y("span",{class:"text-cyan-400"},"鼠标"),Z(" 视角控制")]),y("div",null,[y("span",{class:"text-cyan-400"},"点击"),Z(" 锁定鼠标")]),y("div",null,[y("span",{class:"text-cyan-400"},"W/S"),Z(" 前进/后退")]),y("div",null,[y("span",{class:"text-cyan-400"},"A/D"),Z(" 左移/右移")]),y("div",null,[y("span",{class:"text-cyan-400"},"Space"),Z(" 上升")]),y("div",null,[y("span",{class:"text-cyan-400"},"Ctrl"),Z(" 下降")]),y("div",null,[y("span",{class:"text-cyan-400"},"Q/E"),Z(" 左转/右转")]),y("div",null,[y("span",{class:"text-cyan-400"},"↑/↓"),Z(" 俯仰")]),y("div",null,[y("span",{class:"text-cyan-400"},"Shift"),Z(" 加速")]),y("div",null,[y("span",{class:"text-cyan-400"},"X"),Z(" 速度同步")]),y("div",null,[y("span",{class:"text-cyan-400"},"F"),Z(" 起飞")]),y("div",null,[y("span",{class:"text-cyan-400"},"V"),Z(" 切换视角")])])],-1)])])):ue("",!0)]),_:1}))}},Mo={class:"fixed inset-0 w-full h-full overflow-hidden bg-[#020206] outline-none",tabindex:"0"},So={key:0,class:"absolute inset-0 flex items-center justify-center z-50 bg-[#020206]"},ko={class:"absolute bottom-4 left-4 md:bottom-6 md:left-6 z-10 space-y-2"},Po={class:"absolute bottom-4 right-4 md:bottom-6 md:right-6 z-10"},Co={class:"absolute bottom-4 left-1/2 -translate-x-1/2 z-10 flex gap-2"},Ao={__name:"SpaceshipSimulator",setup(t){const e=ye(null),o=ye(!0),a=ye(!0);let s,i,r,c=null,n=0,l=[],d=Math.random()*Math.PI*2,g=0,M=0,C=null,u=new w(0,0,0),v=0,m=!1,h=null;const S=new w(8943,50,50),{ship:f,controls:p,hud:k,viewMode:b,setShipMesh:A,matchVelocityWithNearest:P,launch:I,updateShip:_,updateCamera:V,handleMouseMove:R,cycleViewMode:z}=Yt(S),D=()=>{s=new at,i=new st(45,e.value.clientWidth/e.value.clientHeight,.5,15e4),r=new it({antialias:!0,alpha:!0}),r.setSize(e.value.clientWidth,e.value.clientHeight),r.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.toneMapping=rt,r.toneMappingExposure=1,e.value.appendChild(r.domElement),s.add(jt());const E=new ct(3359829,.6);s.add(E);let Q=!1;yt.forEach(F=>{const{group:te,sunCoronaGroup:oe}=Kt(F);s.add(te),l.push(te),oe&&(C=oe),F.orbitRadius>0&&!F.isTwin&&!F.isComet&&!F.isQuantum&&s.add(Ge(F.orbitRadius)),F.isTwin&&!Q&&(s.add(Ge(F.orbitRadius)),Q=!0),F.isComet&&F.orbitA&&F.orbitB&&s.add(Ht(F.orbitA,F.orbitB))}),h=Xt(f.position),A(h),s.add(h);const K=Ie(.016,l,d,g,M);d=K.twinSystemAngle,M=K.quantumAngle;const U=l.find(F=>F.userData.name==="木炉星");if(U){const F=U.position,te=U.userData.size;f.position.set(F.x,F.y+te+.5,F.z),h.position.copy(f.position),f.isLanded=!0,f.landedOn=U;const oe=U.userData.mesh?U.userData.mesh.rotation.y:0;f.landedLocalDir=new w(0,1,0);const j=new X().setFromEuler(new Fe(0,0,0)),We=new X().setFromAxisAngle(new w(0,1,0),oe);f.landedLocalQuaternion.copy(We.invert().multiply(j)),f.rotation.setFromQuaternion(j);const je=re(U,l,d);f.velocity.copy(je)}o.value=!1},N=E=>{c=requestAnimationFrame(N);const Q=Math.min((E-n)/1e3,.1);n=E,v+=Q;const K=Ie(Q,l,d,g,M);d=K.twinSystemAngle,M=K.quantumAngle,_(Q,l,d),V(i,l),C&&At(C,v),l.forEach(U=>{U.userData.atmosphere&&kt(U.userData.atmosphere,u)}),r.render(s,i)},L=E=>{switch(E.code){case"KeyW":p.forward=!0;break;case"KeyS":p.backward=!0;break;case"KeyA":p.left=!0;break;case"KeyD":p.right=!0;break;case"Space":p.up=!0;break;case"ControlLeft":case"ControlRight":p.down=!0;break;case"KeyQ":p.rollLeft=!0;break;case"KeyE":p.rollRight=!0;break;case"ArrowUp":p.pitchUp=!0;break;case"ArrowDown":p.pitchDown=!0;break;case"ShiftLeft":case"ShiftRight":p.boost=!0;break;case"KeyX":P(l,d);break;case"KeyF":I(l,d);break;case"KeyH":a.value=!a.value;break;case"KeyV":z();break}},B=E=>{switch(E.code){case"KeyW":p.forward=!1;break;case"KeyS":p.backward=!1;break;case"KeyA":p.left=!1;break;case"KeyD":p.right=!1;break;case"Space":p.up=!1;break;case"ControlLeft":case"ControlRight":p.down=!1;break;case"KeyQ":p.rollLeft=!1;break;case"KeyE":p.rollRight=!1;break;case"ArrowUp":p.pitchUp=!1;break;case"ArrowDown":p.pitchDown=!1;break;case"ShiftLeft":case"ShiftRight":p.boost=!1;break}},q=()=>{e.value&&(i.aspect=e.value.clientWidth/e.value.clientHeight,i.updateProjectionMatrix(),r.setSize(e.value.clientWidth,e.value.clientHeight))},Y=E=>{R(E,m)},O=()=>{m=document.pointerLockElement===e.value},G=()=>{!m&&e.value&&e.value.requestPointerLock()},H=()=>{if(document.visibilityState==="visible"){let E;do E=Math.floor(Math.random()*Ce.length);while(E===g&&Ce.length>1);g=E,M=Math.random()*Math.PI*2}};return mt(()=>{typeof window<"u"&&e.value&&(D(),n=performance.now(),N(n),window.addEventListener("resize",q),window.addEventListener("keydown",L),window.addEventListener("keyup",B),document.addEventListener("visibilitychange",H),document.addEventListener("pointerlockchange",O),document.addEventListener("mousemove",Y),e.value.addEventListener("click",G),e.value.focus())}),ht(()=>{c&&cancelAnimationFrame(c),window.removeEventListener("resize",q),window.removeEventListener("keydown",L),window.removeEventListener("keyup",B),document.removeEventListener("visibilitychange",H),document.removeEventListener("pointerlockchange",O),document.removeEventListener("mousemove",Y),e.value&&e.value.removeEventListener("click",G),r&&r.dispose()}),(E,Q)=>(ee(),ne("div",Mo,[o.value?(ee(),ne("div",So,[...Q[1]||(Q[1]=[y("div",{class:"text-center"},[y("div",{class:"w-16 h-16 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),y("div",{class:"text-amber-200/80 text-lg tracking-widest font-light"},"初始化飞船系统...")],-1)])])):ue("",!0),y("div",{ref_key:"containerRef",ref:e,class:"w-full h-full"},null,512),Q[2]||(Q[2]=Re('<a href="/workshop/" class="absolute top-4 left-4 md:top-6 md:left-6 z-10 flex items-center gap-2 px-3 py-2 rounded-lg bg-black/50 backdrop-blur-sm border border-cyan-500/30 text-cyan-200/80 hover:text-cyan-100 hover:bg-black/70 hover:border-cyan-500/50 transition-all duration-300 group" data-v-09e323b1><svg class="w-5 h-5 transform group-hover:-translate-x-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-09e323b1><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" data-v-09e323b1></path></svg><span class="text-sm tracking-wide" data-v-09e323b1>返回</span></a><div class="absolute top-4 right-4 md:top-6 md:right-6 z-10 text-right" data-v-09e323b1><div class="text-xl md:text-2xl font-bold text-cyan-100/90 tracking-wider drop-shadow-[0_0_20px_rgba(100,200,255,0.3)]" data-v-09e323b1> OUTER WILDS </div><div class="text-xs md:text-sm text-cyan-200/50 mt-1 tracking-wide" data-v-09e323b1> SPACECRAFT SIMULATOR </div></div>',2)),y("div",ko,[xe(go,{hud:de(k),ship:de(f)},null,8,["hud","ship"])]),y("div",Po,[xe(xo,{visible:a.value},null,8,["visible"])]),Q[3]||(Q[3]=Re('<div class="absolute inset-0 pointer-events-none z-5" data-v-09e323b1><div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2" data-v-09e323b1><div class="w-6 h-6 border border-cyan-400/40 rounded-full" data-v-09e323b1></div><div class="absolute top-1/2 left-0 w-2 h-px bg-cyan-400/40 -translate-x-full -translate-y-1/2" data-v-09e323b1></div><div class="absolute top-1/2 right-0 w-2 h-px bg-cyan-400/40 translate-x-full -translate-y-1/2" data-v-09e323b1></div><div class="absolute left-1/2 top-0 w-px h-2 bg-cyan-400/40 -translate-y-full -translate-x-1/2" data-v-09e323b1></div><div class="absolute left-1/2 bottom-0 w-px h-2 bg-cyan-400/40 translate-y-full -translate-x-1/2" data-v-09e323b1></div></div></div>',1)),y("div",Co,[y("button",{onClick:Q[0]||(Q[0]=(...K)=>de(z)&&de(z)(...K)),class:"px-3 py-1.5 rounded-lg bg-black/50 backdrop-blur-sm border border-cyan-500/30 text-cyan-200/80 text-xs hover:bg-cyan-900/30 hover:border-cyan-400/50 transition-all"}," 视角 (V): "+ae(de(b)==="first"?"第一人称":de(b)==="third"?"第三人称":"轨道"),1)])]))}},Do=pt(Ao,[["__scopeId","data-v-09e323b1"]]),Go=JSON.parse('{"title":"星际拓荒飞船模拟器","description":"","frontmatter":{"layout":false,"title":"星际拓荒飞船模拟器"},"headers":[],"relativePath":"workshop/spaceship-simulator.md","filePath":"workshop/spaceship-simulator.md"}'),Ro={name:"workshop/spaceship-simulator.md"},Lo=Object.assign(Ro,{setup(t){return(e,o)=>{const a=wt("ClientOnly");return ee(),ne("div",null,[xe(a,null,{default:Be(()=>[xe(Do)]),_:1})])}}});export{Go as __pageData,Lo as default};
