import{t as Ae,u as ye,G as q,v as he,l as Y,w as fe,m as Pe,j as xe,V as w,g as k,x as Ee,Q as K,y as Te,p as O,z as ot,f as de,D as Ce,e as se,E as nt,I as Me,J as at,q as ve,O as Ue,K as st,N as it,U as Be,B as Ne,F as De,i as rt,k as ct,n as je,a as lt,X as dt,s as Xe,L as ut,r as He,Y as Ke,Z as pt,c as mt,d as ht,W as ft,A as vt,o as wt}from"./chunks/three.module.DhC9X13B.js";import{am as be,p as ge,c as ee,o as $,j as p,a as F,e as ae,t as ne,N as gt,b as yt,w as Ye,T as xt,_ as bt,v as Mt,Y as St,a4 as Fe,G as Re,k as le,C as kt}from"./chunks/framework.DQgBWl2g.js";const Pt=2e-6,$e=933e-6,Ct=[{name:"太阳",nameEn:"Sun",color:16755251,emissive:16755251,size:2e3,mass:472e11,orbitRadius:0,orbitSpeed:0,rotationSpeed:5e-5,isStar:!0,description:"星系中心，直径4000米"},{name:"余烬孪星",nameEn:"Ember Twin",color:12868666,emissive:10767402,size:171,mass:115e9,orbitRadius:5e3,orbitSpeed:933e-6,rotationSpeed:833e-6,isTwin:!0,twinSide:1,description:"沙漏双星之一，直径342米，公转速度~280m/s，自转周期~126秒"},{name:"灰烬孪星",nameEn:"Ash Twin",color:15259043,emissive:13153667,size:168,mass:106e9,orbitRadius:5e3,orbitSpeed:933e-6,rotationSpeed:.00116,isTwin:!0,twinSide:-1,description:"沙漏双星之一，直径336米，公转速度~280m/s，自转周期~90秒"},{name:"木炉星",nameEn:"Timber Hearth",color:9089674,emissive:6982250,size:250,mass:361e9,orbitRadius:8593,orbitSpeed:419e-6,rotationSpeed:167e-6,description:"地表半径250米，大气175米，公转速度~216m/s，自转周期~628秒",hasAtmosphere:!0,atmosphereColor:8965375,atmosphereThickness:175},{name:"废墟月亮",nameEn:"Attlerock",color:8947848,emissive:4473924,size:75,mass:1e9,moonOf:"木炉星",moonOrbitRadius:600,moonOrbitSpeed:.002,rotationSpeed:.001,description:"木炉星的卫星，无大气"},{name:"脆壳星",nameEn:"Brittle Hollow",color:8035274,emissive:5929898,size:300,mass:334e9,orbitRadius:11691,orbitSpeed:264e-6,rotationSpeed:333e-6,description:"地表半径300米，大气50米，公转速度~185m/s，自转周期~314秒",hasBlackHole:!0,blackHoleSize:53},{name:"深巨星",nameEn:"Giant's Deep",color:5085818,emissive:4033130,size:500,mass:289e10,orbitRadius:16458,orbitSpeed:158e-6,rotationSpeed:1e-5,description:"地表半径500米，大气450米，公转速度~156m/s，表面重力2g，潮汐锁定",hasAtmosphere:!0,atmosphereColor:6728328,atmosphereThickness:450,surfaceGravity:2},{name:"黑棘星",nameEn:"Dark Bramble",color:3824202,emissive:2771514,size:750,mass:99e10,orbitRadius:2e4,orbitSpeed:118e-6,rotationSpeed:2e-4,description:"地表半径750米，大气250米，公转速度~141m/s",hasAtmosphere:!0,atmosphereColor:13421772,atmosphereThickness:250},{name:"闯入者",nameEn:"The Interloper",color:8969710,emissive:6732748,size:77.5,mass:1e10,orbitA:18e3,orbitB:8e3,orbitSpeed:32e-5,rotationSpeed:3e-4,isComet:!0,description:"椭圆轨道彗星，直径155米，公转速度50~450m/s"},{name:"量子卫星",nameEn:"Quantum Moon",color:12237546,emissive:10132170,size:120,mass:1e10,moonOrbitRadius:1200,moonOrbitSpeed:8e-4,rotationSpeed:.0015,isQuantum:!0,description:"地表半径120米，浓厚银灰色云雾130米"}],Ie=["灰烬孪星","脆壳星","深巨星","黑棘星","木炉星"];class Se{constructor(e=Math.random()){this.p=new Uint8Array(256),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let a=0;a<256;a++)this.p[a]=a;let o,n;for(let a=255;a>0;a--)e=e*16807%2147483647,o=e%(a+1),n=this.p[a],this.p[a]=this.p[o],this.p[o]=n;for(let a=0;a<512;a++)this.perm[a]=this.p[a&255],this.permMod12[a]=this.perm[a]%12;this.grad3=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6,this.F3=1/3,this.G3=1/6}noise2D(e,o){const{perm:n,permMod12:a,grad3:r,F2:c,G2:i}=this,s=(e+o)*c,l=Math.floor(e+s),u=Math.floor(o+s),x=(l+u)*i,b=l-x,z=u-x,m=e-b,f=o-z;let d,v;m>f?(d=1,v=0):(d=0,v=1);const M=m-d+i,g=f-v+i,h=m-1+2*i,S=f-1+2*i,y=l&255,D=u&255;let P=0,G=0,I=0,V=.5-m*m-f*f;if(V>=0){const C=a[y+n[D]]*3;V*=V,P=V*V*(r[C]*m+r[C+1]*f)}let R=.5-M*M-g*g;if(R>=0){const C=a[y+d+n[D+v]]*3;R*=R,G=R*R*(r[C]*M+r[C+1]*g)}let A=.5-h*h-S*S;if(A>=0){const C=a[y+1+n[D+1]]*3;A*=A,I=A*A*(r[C]*h+r[C+1]*S)}return 70*(P+G+I)}noise3D(e,o,n){const{perm:a,permMod12:r,grad3:c,F3:i,G3:s}=this,l=(e+o+n)*i,u=Math.floor(e+l),x=Math.floor(o+l),b=Math.floor(n+l),z=(u+x+b)*s,m=u-z,f=x-z,d=b-z,v=e-m,M=o-f,g=n-d;let h,S,y,D,P,G;v>=M?M>=g?(h=1,S=0,y=0,D=1,P=1,G=0):v>=g?(h=1,S=0,y=0,D=1,P=0,G=1):(h=0,S=0,y=1,D=1,P=0,G=1):M<g?(h=0,S=0,y=1,D=0,P=1,G=1):v<g?(h=0,S=1,y=0,D=0,P=1,G=1):(h=0,S=1,y=0,D=1,P=1,G=0);const I=v-h+s,V=M-S+s,R=g-y+s,A=v-D+2*s,C=M-P+2*s,N=g-G+2*s,L=v-1+3*s,B=M-1+3*s,Q=g-1+3*s,Z=u&255,E=x&255,T=b&255;let j=0,X=0,J=0,te=0,oe=.6-v*v-M*M-g*g;if(oe>=0){const _=r[Z+a[E+a[T]]]*3;oe*=oe,j=oe*oe*(c[_]*v+c[_+1]*M+c[_+2]*g)}let ie=.6-I*I-V*V-R*R;if(ie>=0){const _=r[Z+h+a[E+S+a[T+y]]]*3;ie*=ie,X=ie*ie*(c[_]*I+c[_+1]*V+c[_+2]*R)}let re=.6-A*A-C*C-N*N;if(re>=0){const _=r[Z+D+a[E+P+a[T+G]]]*3;re*=re,J=re*re*(c[_]*A+c[_+1]*C+c[_+2]*N)}let ce=.6-L*L-B*B-Q*Q;if(ce>=0){const _=r[Z+1+a[E+1+a[T+1]]]*3;ce*=ce,te=ce*ce*(c[_]*L+c[_+1]*B+c[_+2]*Q)}return 32*(j+X+J+te)}}const pe=(t,e,o,n,a=4,r=2,c=.5)=>{let i=0,s=1,l=1,u=0;for(let x=0;x<a;x++)i+=t.noise3D(e*l,o*l,n*l)*s,u+=s,s*=c,l*=r;return i/u},Ze={木炉星:{seed:12345,resolution:512,baseColors:[{color:[58,120,58],weight:.4},{color:[90,140,70],weight:.3},{color:[120,100,60],weight:.2},{color:[40,80,120],weight:.1}],noiseScale:3,octaves:5,bumpStrength:1.2,hasOcean:!0,oceanLevel:.35,oceanColor:[40,80,120]},余烬孪星:{seed:23456,resolution:512,baseColors:[{color:[196,92,58],weight:.5},{color:[180,70,40],weight:.3},{color:[220,120,60],weight:.2}],noiseScale:4,octaves:4,bumpStrength:1.5,hasLava:!0,lavaColor:[255,100,20]},灰烬孪星:{seed:34567,resolution:512,baseColors:[{color:[232,213,163],weight:.4},{color:[200,180,140],weight:.35},{color:[180,160,120],weight:.25}],noiseScale:5,octaves:4,bumpStrength:.8},脆壳星:{seed:45678,resolution:512,baseColors:[{color:[122,155,202],weight:.4},{color:[90,120,170],weight:.3},{color:[60,80,120],weight:.2},{color:[40,50,80],weight:.1}],noiseScale:4,octaves:5,bumpStrength:1.8,hasCracks:!0,crackColor:[20,10,40]},深巨星:{seed:56789,resolution:512,baseColors:[{color:[77,154,122],weight:.5},{color:[60,130,100],weight:.3},{color:[100,180,140],weight:.2}],noiseScale:2,octaves:6,bumpStrength:.4,isGasGiant:!0,bandColors:[[60,140,100],[80,160,120],[50,120,90]]},黑棘星:{seed:67890,resolution:512,baseColors:[{color:[58,90,74],weight:.5},{color:[40,70,55],weight:.3},{color:[30,50,40],weight:.2}],noiseScale:3,octaves:5,bumpStrength:2,hasBrambles:!0},量子卫星:{seed:78901,resolution:256,baseColors:[{color:[186,186,234],weight:.5},{color:[160,160,210],weight:.3},{color:[140,140,190],weight:.2}],noiseScale:4,octaves:3,bumpStrength:.6,isQuantum:!0},闯入者:{seed:89012,resolution:256,baseColors:[{color:[136,221,238],weight:.6},{color:[180,240,250],weight:.3},{color:[100,200,220],weight:.1}],noiseScale:6,octaves:3,bumpStrength:.5,isIcy:!0},废墟月亮:{seed:90123,resolution:256,baseColors:[{color:[136,136,136],weight:.5},{color:[100,100,100],weight:.3},{color:[80,80,80],weight:.2}],noiseScale:5,octaves:4,bumpStrength:1,hasCraters:!0}},Dt=t=>{if(!t||!t.baseColors||t.baseColors.length===0)return null;const{seed:e,resolution:o,baseColors:n,noiseScale:a,octaves:r,hasOcean:c,oceanLevel:i,oceanColor:s,isGasGiant:l,bandColors:u,hasCracks:x,crackColor:b,hasLava:z,lavaColor:m}=t,f=document.createElement("canvas");f.width=o,f.height=o;const d=f.getContext("2d"),v=d.createImageData(o,o),M=v.data,g=new Se(e),h=new Se(e+1e3);for(let y=0;y<o;y++)for(let D=0;D<o;D++){const P=D/o,G=y/o,I=P*Math.PI*2,V=G*Math.PI,R=Math.sin(V)*Math.cos(I),A=Math.sin(V)*Math.sin(I),C=Math.cos(V);let N=pe(g,R*a,A*a,C*a,r);N=(N+1)*.5;let L,B,Q;if(l&&u&&u.length>0){const E=pe(h,R*1.5,A*1.5,C*.5,3)*.3,T=(G+E)*u.length*3%u.length,j=Math.floor(T<0?T+u.length:T),X=u[Math.min(j,u.length-1)],J=N*.3;L=Math.min(255,X[0]+J*50),B=Math.min(255,X[1]+J*50),Q=Math.min(255,X[2]+J*30)}else if(c&&s&&N<i){const E=(i-N)/i;L=s[0]*(1-E*.3),B=s[1]*(1-E*.2),Q=s[2]*(1+E*.2)}else{let E=0;L=B=Q=0,n.forEach((j,X)=>{const J=pe(h,R*(a+X),A*(a+X),C*(a+X),3),te=j.weight*(.5+J*.5);L+=j.color[0]*te,B+=j.color[1]*te,Q+=j.color[2]*te,E+=te}),L/=E,B/=E,Q/=E;const T=(N-.5)*40;L=Math.max(0,Math.min(255,L+T)),B=Math.max(0,Math.min(255,B+T)),Q=Math.max(0,Math.min(255,Q+T))}if(x&&b){const E=pe(h,R*8,A*8,C*8,2);if(Math.abs(E)<.08){const T=1-Math.abs(E)/.08;L=L*(1-T)+b[0]*T,B=B*(1-T)+b[1]*T,Q=Q*(1-T)+b[2]*T}}if(z&&m){const E=pe(h,R*6,A*6,C*6,3);if(E>.5){const T=(E-.5)*2;L=L*(1-T)+m[0]*T,B=B*(1-T)+m[1]*T,Q=Q*(1-T)+m[2]*T}}const Z=(y*o+D)*4;M[Z]=L,M[Z+1]=B,M[Z+2]=Q,M[Z+3]=255}d.putImageData(v,0,0);const S=new Ae(f);return S.wrapS=ye,S.wrapT=ye,S},Rt=t=>{if(!t)return null;const{seed:e,resolution:o,noiseScale:n,octaves:a,bumpStrength:r,hasCraters:c}=t,i=document.createElement("canvas");i.width=o,i.height=o;const s=i.getContext("2d"),l=s.createImageData(o,o),u=l.data,x=new Se(e),b=new Se(e+500),z=new Float32Array(o*o);for(let d=0;d<o;d++)for(let v=0;v<o;v++){const M=v/o,g=d/o,h=M*Math.PI*2,S=g*Math.PI,y=Math.sin(S)*Math.cos(h),D=Math.sin(S)*Math.sin(h),P=Math.cos(S);let G=pe(x,y*n,D*n,P*n,a);if(c)for(let I=0;I<5;I++){const V=b.noise2D(I*10,0)*.5+.5,R=b.noise2D(0,I*10)*.5+.5,A=.05+b.noise2D(I,I)*.03,C=M-V,N=g-R,L=Math.sqrt(C*C+N*N);if(L<A){const B=(1-L/A)*.5;G-=B*(1-Math.pow(L/A,2))}}z[d*o+v]=G}const m=r*2;for(let d=0;d<o;d++)for(let v=0;v<o;v++){const M=(v-1+o)%o,g=(v+1)%o,h=(d-1+o)%o,S=(d+1)%o,y=z[d*o+M],D=z[d*o+g],P=z[h*o+v],G=z[S*o+v],I=(D-y)*m,V=(G-P)*m;let R=-I,A=-V,C=1;const N=Math.sqrt(R*R+A*A+C*C);R/=N,A/=N,C/=N;const L=(d*o+v)*4;u[L]=Math.floor((R*.5+.5)*255),u[L+1]=Math.floor((A*.5+.5)*255),u[L+2]=Math.floor((C*.5+.5)*255),u[L+3]=255}s.putImageData(l,0,0);const f=new Ae(i);return f.wrapS=ye,f.wrapT=ye,f},At=t=>{const{seed:e,resolution:o,noiseScale:n,hasOcean:a,oceanLevel:r}=t,c=document.createElement("canvas");c.width=o,c.height=o;const i=c.getContext("2d"),s=i.createImageData(o,o),l=s.data,u=new Se(e+2e3);for(let b=0;b<o;b++)for(let z=0;z<o;z++){const m=z/o,f=b/o,d=m*Math.PI*2,v=f*Math.PI,M=Math.sin(v)*Math.cos(d),g=Math.sin(v)*Math.sin(d),h=Math.cos(v);let S=pe(u,M*n,g*n,h*n,4);S=(S+1)*.5;let y;a&&S<(r||.35)?y=.1+Math.random()*.1:y=.4+S*.4+Math.random()*.1;const D=Math.floor(y*255),P=(b*o+z)*4;l[P]=D,l[P+1]=D,l[P+2]=D,l[P+3]=255}i.putImageData(s,0,0);const x=new Ae(c);return x.wrapS=ye,x.wrapT=ye,x},zt=t=>{const e=Ze[t];if(!e||!e.baseColors)return null;const o=Dt(e),n=Rt(e),a=At(e);return!o||!n?null:{diffuseMap:o,normalMap:n,roughnessMap:a}},_e={vertexShader:`
    varying vec3 vWorldNormal;
    varying vec3 vWorldPosition;
    
    void main() {
      vWorldNormal = normalize(modelMatrix * vec4(normal, 0.0)).xyz;
      vec4 worldPos = modelMatrix * vec4(position, 1.0);
      vWorldPosition = worldPos.xyz;
      gl_Position = projectionMatrix * viewMatrix * worldPos;
    }
  `,fragmentShader:`
    uniform vec3 glowColor;
    uniform float intensity;
    uniform float power;
    uniform vec3 sunPosition;
    uniform float planetRadius;
    uniform float atmoRadius;
    
    varying vec3 vWorldNormal;
    varying vec3 vWorldPosition;
    
    void main() {
      vec3 viewDir = normalize(cameraPosition - vWorldPosition);
      vec3 sunDir = normalize(sunPosition - vWorldPosition);
      
      // --- 核心逻辑：基于距离的密度衰减 ---
      float dotNV = dot(vWorldNormal, viewDir);
      
      // d 是视线路径距离星球中心的最近距离
      float d = atmoRadius * sqrt(1.0 - dotNV * dotNV);
      
      // 密度函数：在 atmoRadius 到 planetRadius 之间平滑衰减
      float density = smoothstep(atmoRadius, planetRadius, d);
      density = pow(density, power); 

      // --- 太阳遮蔽与散射 ---
      float sunMix = dot(vWorldNormal, sunDir);
      // 模拟大气的光散，向阳面明亮
      // 修改：背光面不再是完全死黑，保留 0.15 的基础亮度模拟弱散射
      float shadowMask = smoothstep(-0.4, 0.5, sunMix);
      shadowMask = mix(0.15, 1.0, shadowMask);
      
      // 靠近地表的额外浓郁感 (Haze)
      float baseHaze = pow(max(0.0, dotNV), 3.0) * 0.5;
      
      vec3 color = glowColor;
      // 向阳面亮度增强，混合高光色
      vec3 sunGlow = vec3(0.2, 0.3, 0.5) * clamp(sunMix, 0.0, 1.0) * density;
      color += sunGlow;

      // 最终强度受 intensity 统一控制
      float finalAlpha = (density + baseHaze) * shadowMask * intensity;
      
      // 彻底消除球体几何边缘的硬切痕
      finalAlpha *= smoothstep(0.0, 0.1, abs(dotNV));

      gl_FragColor = vec4(color, finalAlpha);
    }
  `},Vt=(t,e)=>{const{color:o=8965375,thickness:n=50,intensity:a=1,power:r=2.5}=e,c=new q,i=new he(o),s=t+n,l=new Y(s,64,64),u=new fe({vertexShader:_e.vertexShader,fragmentShader:_e.fragmentShader,uniforms:{glowColor:{value:i},intensity:{value:a},power:{value:r},sunPosition:{value:new w(0,0,0)},planetRadius:{value:t},atmoRadius:{value:s}},transparent:!0,blending:xe,side:Pe,depthWrite:!1}),x=new k(l,u);x.userData.isAtmosphereLayer=!0,c.add(x);const b=Gt(t,i,a);return c.add(b),c},Gt=(t,e,o)=>{const n=new Y(t+.5,64,64),a=new fe({vertexShader:_e.vertexShader,fragmentShader:`
      uniform vec3 glowColor;
      uniform float intensity;
      uniform vec3 sunPosition;
      
      varying vec3 vWorldNormal;
      varying vec3 vWorldPosition;
      
      void main() {
        vec3 viewDir = normalize(cameraPosition - vWorldPosition);
        vec3 sunDir = normalize(sunPosition - vWorldPosition);
        
        float dotNV = max(0.0, dot(vWorldNormal, viewDir));
        
        // 内部雾气主要负责覆盖在陆地上的那一层薄晕
        float rimIntensity = pow(1.0 - dotNV, 3.0) * 0.6;
        
        float sunMix = dot(vWorldNormal, sunDir);
        // 内部雾气在背光面也保留一点基础可见度
        float shadowMask = smoothstep(-0.3, 0.5, sunMix);
        shadowMask = mix(0.2, 1.0, shadowMask);
        
        vec3 finalColor = glowColor * (1.0 + clamp(sunMix, 0.0, 1.0) * 0.5);
        float alpha = rimIntensity * intensity * shadowMask;
        
        gl_FragColor = vec4(finalColor * alpha, alpha);
      }
    `,uniforms:{glowColor:{value:e},intensity:{value:o},sunPosition:{value:new w(0,0,0)}},transparent:!0,blending:xe,side:Ee,depthWrite:!1});return new k(n,a)},Lt=(t,e)=>{t.children.forEach(o=>{o.material&&o.material.uniforms&&o.material.uniforms.sunPosition&&o.material.uniforms.sunPosition.value.copy(e)})},It={木炉星:{color:8965375,thickness:100,intensity:1,power:3},深巨星:{color:4500104,thickness:200,intensity:1.4,power:2},黑棘星:{color:8952200,thickness:80,intensity:.6,power:3.5}},_t=(t,e=6710886)=>{const o=new it(t,0),n=new O({color:e,roughness:.9,metalness:.1});return new k(o,n)},Et=(t,e,o=4863784,n=2972199)=>{const a=new q,r=new se(t*.1,t*.15,t,6),c=new O({color:o,roughness:.9}),i=new k(r,c);i.position.y=t/2,a.add(i);const s=new st(e,1),l=new O({color:n,roughness:.8}),u=new k(s,l);return u.position.y=t+e*.5,a.add(u),a},Tt=(t,e,o,n=9139029)=>{const a=new q,r=new Me(t,e,o),c=new O({color:n,roughness:.7}),i=new k(r,c);i.position.y=e/2,a.add(i);const s=new ve(t*.8,e*.4,4),l=new O({color:5917242,roughness:.8}),u=new k(s,l);return u.position.y=e+e*.2,u.rotation.y=Math.PI/4,a.add(u),a},Nt=(t,e=8943462)=>{const o=new q,n=new Me(t*.3,t*.1,t*.3),a=new O({color:e,roughness:.6}),r=new k(n,a);r.position.y=t*.05,o.add(r);const c=new Me(t*.15,t*.8,t*.15),i=new k(c,a);i.position.y=t*.5,o.add(i);const s=new Ue(t*.12,0),l=new O({color:11193599,emissive:4482730,emissiveIntensity:.5,roughness:.3}),u=new k(s,l);return u.position.y=t*.95,o.add(u),o},Ot=(t,e=12888194)=>{const o=new q,n=new se(t*.15,t*.2,t,8),a=new O({color:e,roughness:.7}),r=new k(n,a);r.position.y=t/2,o.add(r);const c=new ve(t*.2,t*.3,8),i=new k(c,a);return i.position.y=t+t*.15,o.add(i),o},Bt=(t,e=8969727)=>{const o=new q,n=new Ue(t,0),a=new O({color:e,emissive:e,emissiveIntensity:.3,roughness:.2,metalness:.8,transparent:!0,opacity:.8}),r=new k(n,a);return r.scale.y=2,o.add(r),o},Ft=(t,e=2771514)=>{const o=new q,n=new ve(t*.3,t,5),a=new O({color:e,roughness:.8}),r=new k(n,a);r.position.y=t/2,o.add(r);for(let c=0;c<3;c++){const i=new ve(t*.15,t*.5,4),s=new k(i,a);s.position.y=t*.3,s.position.x=Math.cos(c*Math.PI*2/3)*t*.2,s.position.z=Math.sin(c*Math.PI*2/3)*t*.2,s.rotation.z=Math.PI/6*(c%2===0?1:-1),o.add(s)}return o},Qt=t=>{const e=new q,o=new Y(t,16,16),n=new O({color:11206570,emissive:6750054,emissiveIntensity:.8,roughness:.3}),a=new k(o,n);e.add(a);const r=new Y(t*2,16,16),c=new de({color:4521796,transparent:!0,opacity:.2}),i=new k(r,c);return e.add(i),e},Wt=t=>{const e=new q,o=new at(t,0),n=new O({color:13421806,emissive:8947882,emissiveIntensity:.4,roughness:.4,metalness:.6}),a=new k(o,n);return a.rotation.set(Math.random(),Math.random(),Math.random()),e.add(a),e},qt=(t,e=8943462)=>{const o=new q;for(let c=0;c<4;c++){const i=t*(.5+Math.random()*.5),s=new se(t*.1,t*.12,i,6),l=new O({color:e,roughness:.8}),u=new k(s,l);u.position.x=Math.cos(c*Math.PI/2)*t*.4,u.position.z=Math.sin(c*Math.PI/2)*t*.4,u.position.y=i/2,o.add(u)}const n=new Me(t,t*.1,t),a=new O({color:e,roughness:.8}),r=new k(n,a);return r.position.y=t*.05,o.add(r),o},Ut=t=>{const e=new q,o=new se(t,t,t*.1,16),n=new O({color:5592405,roughness:.5,metalness:.3}),a=new k(o,n);a.position.y=t*.05,e.add(a);const r=new Te(t*.8,t*.05,8,32),c=new O({color:16755200,emissive:16746496,emissiveIntensity:.3}),i=new k(r,c);return i.rotation.x=Math.PI/2,i.position.y=t*.12,e.add(i),e},jt=t=>{const e=new q,o=new se(t*.3,t*.4,t*.2,8),n=new O({color:4473924,roughness:.5,metalness:.5}),a=new k(o,n);a.position.y=t*.1,e.add(a);const r=new se(t*.1,t*.15,t*.8,8),c=new O({color:6710886,roughness:.4,metalness:.6}),i=new k(r,c);return i.position.y=t*.5,i.rotation.x=Math.PI/6,e.add(i),e},Xt=t=>{const e=new q,o=new se(t*.05,t*.05,t,8),n=new O({color:9127187}),a=new k(o,n);a.position.y=t/2,e.add(a);const r=new nt(t*.4,t*.25),c=new O({color:5085818,side:Ce,emissive:2976330,emissiveIntensity:.2}),i=new k(r,c);return i.position.y=t*.85,i.position.x=t*.2,e.add(i),e},Ht=t=>{const e=new q,o=new Te(t,t*.2,8,16),n=new O({color:5592405,roughness:.9}),a=new k(o,n);return a.rotation.x=Math.PI/2,e.add(a),e},Kt=t=>{const e=new q,o=new Te(t,t*.1,8,32),n=new O({color:12888194,roughness:.5,metalness:.3}),a=new k(o,n);a.rotation.x=Math.PI/2,a.position.y=t,e.add(a);const r=new ot(t*.85,32),c=new de({color:4482730,transparent:!0,opacity:.5,side:Ce}),i=new k(r,c);i.rotation.x=Math.PI/2,i.position.y=t,e.add(i);const s=new se(t*.15,t*.2,t*.3,8),l=new k(s,n);return l.position.y=t*.15,e.add(l),e},Je={余烬孪星:{landmarks:[{type:"ruin",count:3,sizeRange:[8,15],color:10518624},{type:"obelisk",count:5,sizeRange:[6,12]},{type:"rock",count:20,sizeRange:[2,6],color:12868666}]},灰烬孪星:{landmarks:[{type:"tower",count:4,sizeRange:[10,20],color:13943970},{type:"portal",count:2,sizeRange:[5,8]},{type:"rock",count:15,sizeRange:[2,5],color:15259043}]},木炉星:{landmarks:[{type:"building",count:8,sizeRange:[4,8]},{type:"tree",count:25,sizeRange:[5,12]},{type:"launchPad",count:1,sizeRange:[6,6]},{type:"telescope",count:2,sizeRange:[4,6]},{type:"rock",count:15,sizeRange:[1,4]}]},废墟月亮:{landmarks:[{type:"crater",count:5,sizeRange:[3,8]},{type:"ruin",count:2,sizeRange:[5,10],color:6710886},{type:"rock",count:20,sizeRange:[1,4],color:8947848}]},脆壳星:{landmarks:[{type:"tower",count:3,sizeRange:[12,18],color:9087690},{type:"ruin",count:4,sizeRange:[8,14],color:8035274},{type:"crystal",count:8,sizeRange:[3,7],color:6719692},{type:"rock",count:15,sizeRange:[2,5],color:5929898}]},深巨星:{landmarks:[{type:"islandMarker",count:6,sizeRange:[8,12]},{type:"tower",count:2,sizeRange:[15,25],color:6138506},{type:"rock",count:10,sizeRange:[3,8],color:5085818}]},黑棘星:{landmarks:[{type:"thorn",count:30,sizeRange:[8,20]},{type:"glowingSeed",count:15,sizeRange:[1,3]},{type:"rock",count:10,sizeRange:[3,8],color:3824202}]},闯入者:{landmarks:[{type:"crystal",count:12,sizeRange:[2,6],color:11202303},{type:"rock",count:10,sizeRange:[1,4],color:8969710}]},量子卫星:{landmarks:[{type:"quantumShard",count:20,sizeRange:[2,5]},{type:"obelisk",count:3,sizeRange:[5,10]},{type:"rock",count:10,sizeRange:[1,4],color:12237546}]}},Yt={rock:(t,e)=>_t(t,e),tree:t=>Et(t,t*.6),building:t=>Tt(t,t*1.5,t),obelisk:t=>Nt(t),tower:(t,e)=>Ot(t,e),crystal:(t,e)=>Bt(t,e),thorn:t=>Ft(t),glowingSeed:t=>Qt(t),quantumShard:t=>Wt(t),ruin:(t,e)=>qt(t,e),launchPad:t=>Ut(t),telescope:t=>jt(t),islandMarker:t=>Xt(t),crater:t=>Ht(t),portal:t=>Kt(t)},$t=(t,e,o)=>{const n=Je[t];if(!n)return;let a=0;for(let c=0;c<t.length;c++)a+=t.charCodeAt(c);const r=()=>{const c=Math.sin(a++)*1e4;return c-Math.floor(c)};n.landmarks.forEach(c=>{const{type:i,count:s,sizeRange:l,color:u}=c,x=Yt[i];if(x)for(let b=0;b<s;b++){const z=l[0]+r()*(l[1]-l[0]),m=x(z,u),f=r()*Math.PI*2,d=Math.acos(2*r()-1),v=Math.sin(d)*Math.cos(f),M=Math.sin(d)*Math.sin(f),g=Math.cos(d),h=new w(v,M,g).multiplyScalar(e);m.position.copy(h);const S=h.clone().normalize(),y=new w(0,1,0),D=new K().setFromUnitVectors(y,S);m.quaternion.copy(D),m.rotateY(r()*Math.PI*2),o.add(m)}})},ze={uniforms:{time:{value:0},colorBright:{value:new he(16774579)},colorDark:{value:new he(16729344)},fresnelColor:{value:new he(16763904)}},vertexShader:`
    varying vec2 vUv;
    varying vec3 vNormal;
    varying vec3 vViewPosition;

    void main() {
      vUv = uv;
      vNormal = normalize(normalMatrix * normal);
      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
      vViewPosition = -mvPosition.xyz;
      gl_Position = projectionMatrix * mvPosition;
    }
  `,fragmentShader:`
    uniform float time;
    uniform vec3 colorBright;
    uniform vec3 colorDark;
    uniform vec3 fresnelColor;
    varying vec2 vUv;
    varying vec3 vNormal;
    varying vec3 vViewPosition;

    // 经典噪声函数
    vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
    vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
    vec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }

    float snoise(vec2 v) {
      const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439);
      vec2 i  = floor(v + dot(v, C.yy));
      vec2 x0 = v -   i + dot(i, C.xx);
      vec2 i1;
      i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
      vec4 x12 = x0.xyxy + C.xxzz;
      x12.xy -= i1;
      i = mod289(i);
      vec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));
      vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
      m = m*m; m = m*m;
      vec3 x = 2.0 * fract(p * C.www) - 1.0;
      vec3 h = abs(x) - 0.5;
      vec3 ox = floor(x + 0.5);
      vec3 a0 = x - ox;
      m *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);
      vec3 g;
      g.x  = a0.x  * x0.x  + h.x  * x0.y;
      g.yz = a0.yz * x12.xz + h.yz * x12.yw;
      return 130.0 * dot(m, g);
    }

    void main() {
      // 多层噪声叠加形成动态表面
      float noise = snoise(vUv * 4.0 + time * 0.05);
      noise += 0.5 * snoise(vUv * 8.0 - time * 0.07);
      noise = noise * 0.5 + 0.5;

      // 混合基础颜色
      vec3 baseColor = mix(colorDark, colorBright, noise);

      // 菲涅尔效果：让球体中心亮，边缘带有强烈的辐射感
      vec3 viewDir = normalize(vViewPosition);
      float fresnel = pow(1.0 - max(0.0, dot(vNormal, viewDir)), 1.5);
      
      // 增加曝光感：在中心区域叠加极高亮度
      float centerBrightness = pow(max(0.0, dot(vNormal, viewDir)), 2.0);
      vec3 finalColor = baseColor * (1.0 + centerBrightness * 0.5) + fresnelColor * fresnel * 2.5;

      gl_FragColor = vec4(finalColor, 1.0);
    }
  `},Ve={uniforms:{time:{value:0},glowColor:{value:new he(16746496)}},vertexShader:`
    varying vec3 vNormal;
    varying vec3 vViewPosition;
    varying vec3 vPosition;

    void main() {
      vPosition = position;
      vNormal = normalize(normalMatrix * normal);
      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
      vViewPosition = -mvPosition.xyz;
      gl_Position = projectionMatrix * mvPosition;
    }
  `,fragmentShader:`
    uniform float time;
    uniform vec3 glowColor;
    varying vec3 vNormal;
    varying vec3 vViewPosition;
    varying vec3 vPosition;

    void main() {
      vec3 viewDir = normalize(vViewPosition);
      
      float vDotN = clamp(abs(dot(vNormal, viewDir)), 0.0, 1.0);
      
      float edgeSoftness = smoothstep(0.0, 0.7, vDotN);
      float rim = 1.0 - vDotN;
      float intensity = pow(rim, 1.35) * pow(edgeSoftness, 2.4);
      
      float pulse = 0.92 + 0.08 * sin(time * 1.7);
      float colorStrength = pow(intensity, 1.05);
      
      gl_FragColor = vec4(glowColor * pulse * 2.2 * colorStrength, intensity);
    }
  `};function Zt(t){const e=new q,o=new Y(t,128,128),n=new fe({uniforms:Be.clone(ze.uniforms),vertexShader:ze.vertexShader,fragmentShader:ze.fragmentShader}),a=new k(o,n);a.name="SunSurface",e.add(a);const r=new Y(t*1.85,64,64),c=new fe({uniforms:Be.clone(Ve.uniforms),vertexShader:Ve.vertexShader,fragmentShader:Ve.fragmentShader,side:Pe,blending:xe,transparent:!0,depthWrite:!1}),i=new k(r,c);i.name="SunHalo",e.add(i);const s=new Y(t*1.05,64,64),l=new fe({vertexShader:`
      varying vec3 vNormal;
      varying vec3 vViewPosition;
      void main() {
        vNormal = normalize(normalMatrix * normal);
        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
        vViewPosition = -mvPosition.xyz;
        gl_Position = projectionMatrix * mvPosition;
      }
    `,fragmentShader:`
      uniform vec3 color;
      varying vec3 vNormal;
      varying vec3 vViewPosition;
      void main() {
        vec3 viewDir = normalize(vViewPosition);
        float vDotN = max(0.0, dot(viewDir, vNormal));
        float rim = 1.0 - vDotN;
        float alpha = pow(rim, 5.0) * pow(vDotN, 0.85) * 1.8;
        gl_FragColor = vec4(color * alpha, alpha);
      }
    `,uniforms:{color:{value:new he(16773290)}},transparent:!0,blending:xe,side:Ee,depthWrite:!1}),u=new k(s,l);return e.add(u),e}function Jt(t,e){t.children.forEach(o=>{o.material&&o.material.uniforms&&o.material.uniforms.time&&(o.material.uniforms.time.value=e),o.name==="SunSurface"&&(o.rotation.y+=1e-4)})}const eo=()=>{const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d"),o=e.createRadialGradient(32,32,0,32,32,32);return o.addColorStop(0,"rgba(255, 255, 255, 1)"),o.addColorStop(.15,"rgba(255, 255, 255, 1)"),o.addColorStop(.3,"rgba(255, 255, 255, 0.8)"),o.addColorStop(.5,"rgba(255, 255, 255, 0.4)"),o.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=o,e.fillRect(0,0,64,64),new Ae(t)},to=()=>{const t=new Ne,e=[],o=[];for(let a=0;a<15e3;a++){const r=4e4+Math.random()*5e4,c=Math.random()*Math.PI*2,i=Math.acos(2*Math.random()-1);e.push(r*Math.sin(i)*Math.cos(c),r*Math.sin(i)*Math.sin(c),r*Math.cos(i));const s=Math.random();s<.1?o.push(1,.9,.7):s<.2?o.push(.85,.95,1):o.push(1,1,1)}t.setAttribute("position",new De(e,3)),t.setAttribute("color",new De(o,3));const n=new rt({size:2.5,map:eo(),vertexColors:!0,transparent:!0,opacity:1,sizeAttenuation:!0,depthWrite:!1,blending:xe});return new ct(t,n)},oo=t=>{const e=new q,o=t.name==="木炉星"?0:Math.random()*Math.PI*2;e.userData={...t,angle:o};const n=t.isStar||Ze[t.name]?64:32,a=new Y(t.size,n,n);let r,c=null;if(t.isStar){c=Zt(t.size),e.add(c),r=c.getObjectByName("SunSurface");const i=new je(16768392,3,5e4);e.add(i)}else{let i;const s=zt(t.name);s?i=new O({map:s.diffuseMap,normalMap:s.normalMap,normalScale:new lt(1.5,1.5),roughnessMap:s.roughnessMap,roughness:.7,metalness:.1,emissive:new he(t.emissive),emissiveIntensity:.15}):i=new O({color:t.color,emissive:t.emissive,emissiveIntensity:.4,roughness:.6,metalness:.2}),r=new k(a,i),e.add(r)}if(e.userData.mesh=r,!t.isStar){const i=new q;Je[t.name]&&$t(t.name,t.size,i),r.add(i)}if(t.hasAtmosphere&&t.atmosphereThickness){const i=It[t.name]||{color:t.atmosphereColor||16777215,thickness:t.atmosphereThickness,intensity:.6,power:2.5},s=Vt(t.size,i);s.userData.isAtmosphere=!0,e.add(s),e.userData.atmosphere=s}if(t.hasBlackHole){const i=t.blackHoleSize||t.size*.15,s=new Y(i,32,32),l=new de({color:0}),u=new k(s,l);u.position.set(0,0,0),e.add(u);const x=new dt(i*1.2,i*2.5,64),b=new fe({vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        varying vec2 vUv;
        void main() {
          float dist = length(vUv - 0.5) * 2.0;
          float alpha = smoothstep(0.0, 0.5, dist) * smoothstep(1.0, 0.6, dist);
          vec3 color = mix(vec3(0.5, 0.3, 1.0), vec3(0.2, 0.1, 0.5), dist);
          gl_FragColor = vec4(color, alpha * 0.7);
        }
      `,transparent:!0,side:Ce,depthWrite:!1,blending:xe}),z=new k(x,b);z.rotation.x=Math.PI/2,e.add(z);const m=new Y(i*1.8,32,32),f=new de({color:4465322,transparent:!0,opacity:.25,side:Pe});e.add(new k(m,f))}if(t.isComet){const i=new ve(t.size*.6,t.size*5,8),s=new de({color:6741503,transparent:!0,opacity:.3,side:Ce}),l=new k(i,s);l.rotation.x=Math.PI/2,l.position.z=t.size*2.5,e.add(l),e.userData.tail=l}if(t.isQuantum){const i=t.size+(t.atmosphereThickness||130),s=new Y(i,48,48),l=new fe({vertexShader:`
        varying vec3 vNormal;
        varying vec3 vViewPosition;
        void main() {
          vNormal = normalize(normalMatrix * normal);
          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
          vViewPosition = -mvPosition.xyz;
          gl_Position = projectionMatrix * mvPosition;
        }
      `,fragmentShader:`
        varying vec3 vNormal;
        varying vec3 vViewPosition;
        void main() {
          vec3 viewDir = normalize(vViewPosition);
          float vDotN = max(0.0, abs(dot(viewDir, vNormal)));
          
          // 增加 vDotN 因子，使雾气向边缘自然淡出
          float rim = 1.0 - vDotN;
          float alpha = (0.85 + rim * 0.15) * vDotN * 1.5;
          
          vec3 fogColor = vec3(0.35, 0.35, 0.4);
          gl_FragColor = vec4(fogColor, alpha);
        }
      `,transparent:!0,side:Ee,depthWrite:!1}),u=new k(s,l);e.add(u);const x=new Y(t.size*1.05,32,32),b=new de({color:4473941,transparent:!0,opacity:.95});e.add(new k(x,b));const z=new Y(i*1.08,32,32),m=new de({color:5592422,transparent:!0,opacity:.1,side:Pe});e.add(new k(z,m))}return{group:e,sunCoronaGroup:c}},Qe=(t,e=!1)=>{const n=new Ne,a=[];for(let i=0;i<=128;i++){const s=i/128*Math.PI*2;a.push(Math.cos(s)*t,0,Math.sin(s)*t)}n.setAttribute("position",new De(a,3));const r=e?new Xe({color:4478310,transparent:!0,opacity:.3,dashSize:2,gapSize:1}):new ut({color:3359829,transparent:!0,opacity:.25}),c=new He(n,r);return e&&c.computeLineDistances(),c},no=(t,e)=>{const n=new Ne,a=[],r=Math.sqrt(t*t-e*e);for(let s=0;s<=128;s++){const l=s/128*Math.PI*2;a.push(Math.cos(l)*t-r,0,Math.sin(l)*e)}n.setAttribute("position",new De(a,3));const c=new Xe({color:4491434,transparent:!0,opacity:.35,dashSize:1.5,gapSize:1}),i=new He(n,c);return i.computeLineDistances(),i},ao=t=>{const e=new q,o=new ve(1.5,6,8),n=new O({color:13404228,emissive:4465169,emissiveIntensity:.3,roughness:.4,metalness:.6}),a=new k(o,n);a.rotation.x=Math.PI/2,e.add(a);const r=new Me(8,.3,2),c=new O({color:8939059,roughness:.5,metalness:.4}),i=new k(r,c);i.position.z=1,e.add(i);const s=new Y(1,16,16,0,Math.PI*2,0,Math.PI/2),l=new O({color:8965375,transparent:!0,opacity:.7,roughness:.1,metalness:.8}),u=new k(s,l);u.rotation.x=-Math.PI/2,u.position.z=-1.5,e.add(u);const x=new se(.8,1,1.5,8),b=new O({color:4473924,roughness:.3,metalness:.8}),z=new k(x,b);z.rotation.x=Math.PI/2,z.position.z=3.5,e.add(z);const m=(v,M,g=1)=>{const h=new ve(.5*g,2*g,8),S=new de({color:16737792,transparent:!0,opacity:0,depthTest:!1}),y=new k(h,S);return y.position.copy(v),y.rotation.set(M.x,M.y,M.z),y.renderOrder=999,e.add(y),y},f={back:m(new w(0,0,5),new w(-Math.PI/2,0,0),1.2),front:m(new w(0,0,-4),new w(Math.PI/2,0,0),.8),left:m(new w(2,0,0),new w(0,0,Math.PI/2),.6),right:m(new w(-2,0,0),new w(0,0,-Math.PI/2),.6),bottom:m(new w(0,2,1),new w(0,0,0),.6),top:m(new w(0,-2,1),new w(Math.PI,0,0),.6)};e.userData.thrusters=f;const d=new je(16777130,.5,50);return d.position.set(0,0,-2.5),e.add(d),e.position.copy(t),e},We=(t,e)=>{const o=t==null?void 0:t.userData.thrusters;if(!o)return;const n=.8+Math.random()*.4;o.back.material.opacity=e.forward?.9:0,e.forward&&(o.back.scale.y=n),o.front.material.opacity=e.backward?.8:0,e.backward&&(o.front.scale.y=n),o.left.material.opacity=e.left?.7:0,e.left&&(o.left.scale.y=n),o.right.material.opacity=e.right?.7:0,e.right&&(o.right.scale.y=n),o.top.material.opacity=e.up?.7:0,e.up&&(o.top.scale.y=n),o.bottom.material.opacity=e.down?.7:0,e.down&&(o.bottom.scale.y=n)},so=(t,e)=>{const o=new w;return e.forEach(n=>{const a=n.userData;if(!a.mass)return;const r=new w().subVectors(n.position,t),c=r.length();if(c<a.size)return;const i=Pt*a.mass/(c*c);r.normalize().multiplyScalar(i),o.add(r)}),o},Ge=(t,e)=>{let o=null,n=1/0;return e.forEach(a=>{const r=a.userData;if(r.isStar)return;const c=t.distanceTo(a.position)-r.size;c<n&&(n=c,o=a)}),{body:o,distance:n}},me=(t,e,o)=>{const n=t.userData;if(n.isStar)return new w(0,0,0);const a=t.position.clone(),r=.016;let c,i;if(n.isComet&&n.orbitA&&n.orbitB){const s=Math.sqrt(n.orbitA*n.orbitA-n.orbitB*n.orbitB),l=n.angle+n.orbitSpeed*r*60;c=Math.cos(l)*n.orbitA-s,i=Math.sin(l)*n.orbitB}else if(n.isTwin){const s=o+$e*r*60,l=Math.cos(s)*n.orbitRadius,u=Math.sin(s)*n.orbitRadius,x=400,b=s*10;c=l+Math.cos(b)*x*n.twinSide,i=u+Math.sin(b)*x*n.twinSide}else if(n.moonOf){const s=e.find(l=>l.userData.name===n.moonOf);if(s){const l=me(s,e,o),u=(n.moonAngle||0)+n.moonOrbitSpeed*r*60,x=-Math.sin(u)*n.moonOrbitRadius*n.moonOrbitSpeed*60,b=Math.cos(u)*n.moonOrbitRadius*n.moonOrbitSpeed*60;return new w(l.x+x,0,l.z+b)}return new w(0,0,0)}else if(n.orbitRadius){const s=n.angle+n.orbitSpeed*r*60;c=Math.cos(s)*n.orbitRadius,i=Math.sin(s)*n.orbitRadius}else return new w(0,0,0);return new w((c-a.x)/r,0,(i-a.z)/r)},qe=(t,e,o,n,a)=>{let r=o+$e*t*60,c=a;return e.forEach(i=>{const s=i.userData;if(s.isQuantum){const l=Ie[n],u=e.find(x=>x.userData.name===l);u&&(c+=s.moonOrbitSpeed*t*60,i.position.x=u.position.x+Math.cos(c)*s.moonOrbitRadius,i.position.y=Math.sin(c)*s.moonOrbitRadius*.3,i.position.z=u.position.z+Math.sin(c)*s.moonOrbitRadius);return}if(s.moonOf){const l=e.find(u=>u.userData.name===s.moonOf);l&&(s.moonAngle=(s.moonAngle||0)+s.moonOrbitSpeed*t*60,i.position.x=l.position.x+Math.cos(s.moonAngle)*s.moonOrbitRadius,i.position.y=Math.sin(s.moonAngle)*s.moonOrbitRadius*.2,i.position.z=l.position.z+Math.sin(s.moonAngle)*s.moonOrbitRadius);return}if(s.orbitRadius>0||s.isComet)if(s.angle+=s.orbitSpeed*t*60,s.isComet&&s.orbitA&&s.orbitB){const l=Math.sqrt(s.orbitA*s.orbitA-s.orbitB*s.orbitB);if(i.position.x=Math.cos(s.angle)*s.orbitA-l,i.position.z=Math.sin(s.angle)*s.orbitB,s.tail){const u=s.orbitA*Math.sin(s.angle),x=-s.orbitB*Math.cos(s.angle);i.rotation.y=Math.atan2(u,x)}}else if(s.isTwin){const l=Math.cos(r)*s.orbitRadius,u=Math.sin(r)*s.orbitRadius,x=400,b=r*10;i.position.x=l+Math.cos(b)*x*s.twinSide,i.position.z=u+Math.sin(b)*x*s.twinSide}else i.position.x=Math.cos(s.angle)*s.orbitRadius,i.position.z=Math.sin(s.angle)*s.orbitRadius;s.mesh&&s.rotationSpeed&&(s.mesh.rotation.y+=s.rotationSpeed*t*60)}),{twinSystemAngle:r,quantumAngle:c}};let Le=0;const io=t=>{const e=be({position:new w().copy(t),velocity:new w(0,0,0),rotation:new Ke(0,0,0),thrust:25,rotationSpeed:1.5,maxSpeed:500,fuel:100,isLanded:!1,landedOn:null,landedLocalDir:null,landedLocalQuaternion:new K,isMatchingVelocity:!1,targetVelocity:new w(0,0,0),matchingTarget:null,initialVelocityDiff:0}),o=be({forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1,rollLeft:!1,rollRight:!1,pitchUp:!1,pitchDown:!1,boost:!1,matchVelocity:!1}),n=be({speed:0,altitude:0,nearestBody:null,nearestDistance:0,isThrusting:!1,isMatchingVelocity:!1,matchingProgress:0}),a=ge("first");let r=null;const c=m=>{r=m},i=(m,f)=>{if(e.isMatchingVelocity){e.isMatchingVelocity=!1,e.matchingTarget=null,e.initialVelocityDiff=0;return}const d=Ge(e.position,m);d.body&&(e.isMatchingVelocity=!0,e.matchingTarget=d.body,e.targetVelocity.copy(me(d.body,m,f)),e.initialVelocityDiff=new w().subVectors(e.targetVelocity,e.velocity).length())},s=(m,f,d)=>{if(!e.isMatchingVelocity||!e.matchingTarget)return;const v=me(e.matchingTarget,f,d);e.targetVelocity.copy(v);const M=new w().subVectors(e.targetVelocity,e.velocity),g=M.length();if(g<.5){e.velocity.copy(e.targetVelocity),e.isMatchingVelocity=!1,e.matchingTarget=null;return}const S=25*m;if(g<=S)e.velocity.copy(e.targetVelocity);else{const y=M.normalize().multiplyScalar(S);e.velocity.add(y)}n.matchingProgress=(1-g/e.initialVelocityDiff)*100},l=(m,f)=>{if(!e.isLanded||!e.landedOn)return;const d=e.landedOn,v=new w().subVectors(e.position,d.position).normalize(),M=me(d,m,f);e.velocity.copy(M).add(v.multiplyScalar(2));const g=d.userData.rotationSpeed||0,h=d.userData.size+.5,S=new w(0,1,0),y=new w(v.x,0,v.z);if(y.lengthSq()>.001){y.normalize();const D=new w().crossVectors(S,y).normalize(),G=Math.sqrt(v.x*v.x+v.z*v.z)*h*g;e.velocity.add(D.multiplyScalar(G))}e.isLanded=!1,e.landedOn=null,e.landedLocalDir=null};return{ship:e,controls:o,hud:n,viewMode:a,setShipMesh:c,matchVelocityWithNearest:i,launch:l,updateShip:(m,f,d)=>{var I;if(Le=d,e.isLanded&&e.landedOn){const V=e.landedOn,R=V.userData.mesh,A=R?R.rotation.y:0,C=new K().setFromAxisAngle(new w(0,1,0),A),N=e.landedLocalDir.clone().applyQuaternion(C);e.position.copy(V.position).add(N.multiplyScalar(V.userData.size+.5));const L=C.clone().multiply(e.landedLocalQuaternion);if(e.rotation.setFromQuaternion(L),n.speed="0",n.altitude="0",o.forward||o.backward||o.left||o.right){const B=7*(o.boost?3:1)*m,Q=(o.forward?1:0)-(o.backward?1:0),Z=(o.right?1:0)-(o.left?1:0),E=new w(0,0,-1).applyQuaternion(e.landedLocalQuaternion),T=new w(1,0,0).applyQuaternion(e.landedLocalQuaternion),j=new w().addScaledVector(E,Q).addScaledVector(T,Z).normalize();if(j.lengthSq()>.001){const X=e.landedLocalDir.clone().normalize(),J=new w().crossVectors(X,j).normalize(),te=B/(V.userData.size+.5),oe=new K().setFromAxisAngle(J,te);e.landedLocalDir.applyQuaternion(oe),e.landedLocalQuaternion.premultiply(oe)}}o.up&&l(f,d),r&&(r.position.copy(e.position),r.rotation.copy(e.rotation),We(r,o));return}const v=new K().setFromEuler(e.rotation),M=new w(0,0,-1).applyQuaternion(v),g=new w(1,0,0).applyQuaternion(v),h=new w(0,1,0).applyQuaternion(v),S=o.boost?2.5:1;o.forward&&e.velocity.add(M.clone().multiplyScalar(e.thrust*S*m)),o.backward&&e.velocity.add(M.clone().multiplyScalar(-e.thrust*.5*m)),o.left&&e.velocity.add(g.clone().multiplyScalar(-e.thrust*.5*m)),o.right&&e.velocity.add(g.clone().multiplyScalar(e.thrust*.5*m)),o.up&&e.velocity.add(h.clone().multiplyScalar(e.thrust*.5*m)),o.down&&e.velocity.add(h.clone().multiplyScalar(-e.thrust*.5*m));const y=so(e.position,f);e.velocity.add(y.multiplyScalar(m)),s(m,f,d),e.velocity.length()>e.maxSpeed&&e.velocity.normalize().multiplyScalar(e.maxSpeed),e.position.add(e.velocity.clone().multiplyScalar(m)),r&&(r.position.copy(e.position),r.rotation.copy(e.rotation),We(r,o));const P=Ge(e.position,f);let G=e.velocity.length();if(P.body){const V=me(P.body,f,Le);G=new w().subVectors(e.velocity,V).length()}if(n.speed=G.toFixed(0),n.nearestBody=((I=P.body)==null?void 0:I.userData.name)||null,n.nearestDistance=P.distance.toFixed(0),n.altitude=P.distance.toFixed(0),n.isThrusting=o.forward||o.backward||o.left||o.right||o.up||o.down,n.isMatchingVelocity=e.isMatchingVelocity,P.distance<.5&&P.body){e.isLanded=!0,e.landedOn=P.body,e.isMatchingVelocity=!1,e.matchingTarget=null,e.initialVelocityDiff=0;const V=P.body.userData.mesh?P.body.userData.mesh.rotation.y:0;e.landedLocalDir=new w().subVectors(e.position,P.body.position).normalize(),e.landedLocalDir.applyAxisAngle(new w(0,1,0),-V);const R=new K().setFromEuler(e.rotation),A=new K().setFromAxisAngle(new w(0,1,0),V);e.landedLocalQuaternion.copy(A.invert().multiply(R));const C=me(P.body,f,Le);e.velocity.copy(C)}},updateCamera:(m,f)=>{const d=new K;d.setFromEuler(e.rotation),new w(0,0,-1).applyQuaternion(d);const v=new w(0,1,0).applyQuaternion(d),M=new w(0,0,1).applyQuaternion(d);if(a.value==="first")m.position.copy(e.position),m.quaternion.copy(d),r&&(r.visible=!1);else if(a.value==="third"){const g=M.clone().multiplyScalar(40).add(v.clone().multiplyScalar(15));m.position.copy(e.position).add(g),m.lookAt(e.position),r&&(r.visible=!0)}else if(a.value==="orbit"){const g=Ge(e.position,f);if(g.body){const h=g.body.position.clone(),S=new w().subVectors(e.position,h).normalize();m.position.copy(h).add(S.multiplyScalar(g.body.userData.size*4+10)),m.lookAt(e.position),r&&(r.visible=!0)}}},handleMouseMove:(m,f)=>{if(!f)return;const d=.002;if(e.isLanded&&e.landedOn){const h=e.landedLocalDir.clone().normalize(),S=new w(0,0,-1).applyQuaternion(e.landedLocalQuaternion);let y=new w().crossVectors(S,h).normalize();if(y.lengthSq()<.001){const I=new w(0,1,0).applyQuaternion(e.landedLocalQuaternion);y=new w().crossVectors(I,h).normalize()}const D=new K().setFromAxisAngle(h,-m.movementX*d),P=new K().setFromAxisAngle(y,-m.movementY*d);e.landedLocalQuaternion.premultiply(D),e.landedLocalQuaternion.multiply(P);const G=new w(0,0,-1).applyQuaternion(e.landedLocalQuaternion);if(Math.abs(G.dot(h))<.999){const I=new w().crossVectors(G,h).normalize(),V=new w().crossVectors(h,I).normalize(),R=new pt().makeBasis(I,h,V.negate());e.landedLocalQuaternion.setFromRotationMatrix(R)}return}const v=new K().setFromEuler(e.rotation),M=new K().setFromAxisAngle(new w(0,1,0),-m.movementX*d),g=new K().setFromAxisAngle(new w(1,0,0),-m.movementY*d);v.multiply(M),v.multiply(g),e.rotation.setFromQuaternion(v)},cycleViewMode:()=>{const m=["first","third","orbit"],f=m.indexOf(a.value);a.value=m[(f+1)%m.length]}}},ro=()=>{const t=ge(!1),e=ge(""),o=be({leftX:0,leftY:0,rightX:0,rightY:0}),n=be({a:!1,b:!1,x:!1,y:!1,lb:!1,rb:!1,lt:0,rt:0,back:!1,start:!1,leftStick:!1,rightStick:!1,up:!1,down:!1,left:!1,right:!1}),a=.15,r=f=>Math.abs(f)<a?0:(f>0?1:-1)*(Math.abs(f)-a)/(1-a),c=()=>{var v,M,g,h,S,y,D,P,G,I,V,R,A,C,N,L;const f=navigator.getGamepads();let d=null;for(const B of f)if(B&&B.connected){d=B;break}if(!d){t.value=!1,e.value="";return}t.value=!0,e.value=d.id,o.leftX=r(d.axes[0]||0),o.leftY=r(d.axes[1]||0),o.rightX=r(d.axes[2]||0),o.rightY=r(d.axes[3]||0),n.a=((v=d.buttons[0])==null?void 0:v.pressed)||!1,n.b=((M=d.buttons[1])==null?void 0:M.pressed)||!1,n.x=((g=d.buttons[2])==null?void 0:g.pressed)||!1,n.y=((h=d.buttons[3])==null?void 0:h.pressed)||!1,n.lb=((S=d.buttons[4])==null?void 0:S.pressed)||!1,n.rb=((y=d.buttons[5])==null?void 0:y.pressed)||!1,n.lt=((D=d.buttons[6])==null?void 0:D.value)||0,n.rt=((P=d.buttons[7])==null?void 0:P.value)||0,n.back=((G=d.buttons[8])==null?void 0:G.pressed)||!1,n.start=((I=d.buttons[9])==null?void 0:I.pressed)||!1,n.leftStick=((V=d.buttons[10])==null?void 0:V.pressed)||!1,n.rightStick=((R=d.buttons[11])==null?void 0:R.pressed)||!1,n.up=((A=d.buttons[12])==null?void 0:A.pressed)||!1,n.down=((C=d.buttons[13])==null?void 0:C.pressed)||!1,n.left=((N=d.buttons[14])==null?void 0:N.pressed)||!1,n.right=((L=d.buttons[15])==null?void 0:L.pressed)||!1},i=f=>{f.forward=o.leftY<-.1,f.backward=o.leftY>.1,f.left=o.leftX<-.1,f.right=o.leftX>.1,f.up=n.rt>.1||n.a,f.down=n.lt>.1,f.rollLeft=n.lb,f.rollRight=n.rb,f.boost=n.leftStick},s=()=>({yaw:o.rightX*.12,pitch:o.rightY*.12});let l=null;const u=()=>{c(),l=requestAnimationFrame(u)},x=f=>{console.log("Gamepad connected:",f.gamepad.id),t.value=!0,e.value=f.gamepad.id},b=f=>{console.log("Gamepad disconnected:",f.gamepad.id),t.value=!1,e.value=""};return{gamepadConnected:t,gamepadName:e,axes:o,buttons:n,mapToControls:i,getRotationInput:s,startPolling:()=>{typeof window>"u"||(window.addEventListener("gamepadconnected",x),window.addEventListener("gamepaddisconnected",b),u())},stopPolling:()=>{l&&(cancelAnimationFrame(l),l=null),typeof window<"u"&&(window.removeEventListener("gamepadconnected",x),window.removeEventListener("gamepaddisconnected",b))}}},co={class:"backdrop-blur-sm bg-black/50 rounded-xl border border-cyan-500/30 p-4 min-w-[220px]"},lo={class:"text-xs text-cyan-300/60 uppercase tracking-wider mb-3 flex items-center gap-2"},uo={key:0,class:"px-1.5 py-0.5 bg-orange-500/30 text-orange-300 rounded text-[10px] animate-pulse"},po={key:1,class:"px-1.5 py-0.5 bg-cyan-500/30 text-cyan-300 rounded text-[10px] animate-pulse"},mo={class:"space-y-2 text-sm"},ho={class:"flex justify-between"},fo={class:"text-cyan-100 font-mono"},vo={class:"flex justify-between"},wo={class:"text-cyan-100 font-mono"},go={key:0,class:"flex justify-between items-center"},yo={class:"text-amber-200"},xo={key:1,class:"flex justify-between"},bo={class:"text-amber-200"},Mo={key:2,class:"mt-2 pt-2 border-t border-cyan-500/20"},So={class:"flex justify-between items-center"},ko={class:"text-cyan-300 font-mono text-xs"},Po={class:"mt-1.5 h-1.5 bg-cyan-900/50 rounded-full overflow-hidden"},Co={class:"mt-3 pt-3 border-t border-cyan-500/20"},Do={class:"flex justify-between text-xs"},Ro={class:"text-cyan-100/80 font-mono text-[10px]"},Ao={__name:"SpaceshipHUD",props:{hud:{type:Object,required:!0},ship:{type:Object,required:!0}},setup(t){return(e,o)=>{var n,a;return $(),ee("div",co,[p("div",lo,[o[0]||(o[0]=F(" 飞船状态 ",-1)),t.hud.isThrusting?($(),ee("span",uo," 推进中 ")):ae("",!0),t.hud.isMatchingVelocity?($(),ee("span",po," 速度同步 ")):ae("",!0)]),p("div",mo,[p("div",ho,[o[1]||(o[1]=p("span",{class:"text-cyan-200/60"},"速度",-1)),p("span",fo,ne(t.hud.speed)+" m/s",1)]),p("div",vo,[o[2]||(o[2]=p("span",{class:"text-cyan-200/60"},"距离",-1)),p("span",wo,ne(t.hud.altitude)+" m",1)]),t.ship.isLanded?($(),ee("div",go,[o[3]||(o[3]=p("span",{class:"text-green-300 flex items-center gap-1.5"}," 已降落 ",-1)),p("span",yo,ne((n=t.ship.landedOn)==null?void 0:n.userData.name),1)])):t.hud.nearestBody?($(),ee("div",xo,[o[4]||(o[4]=p("span",{class:"text-cyan-200/60"},"最近天体",-1)),p("span",bo,ne(t.hud.nearestBody),1)])):ae("",!0),t.hud.isMatchingVelocity&&!t.ship.isLanded?($(),ee("div",Mo,[p("div",So,[o[5]||(o[5]=p("span",{class:"text-cyan-200/60"},"同步中",-1)),p("span",ko,ne((a=t.ship.matchingTarget)==null?void 0:a.userData.name),1)]),p("div",Po,[p("div",{class:"h-full bg-gradient-to-r from-cyan-500 to-cyan-300 transition-all duration-150",style:gt({width:`${t.ship.initialVelocityDiff>.5?Math.max(0,100-Math.sqrt(Math.pow(t.ship.velocity.x-t.ship.targetVelocity.x,2)+Math.pow(t.ship.velocity.z-t.ship.targetVelocity.z,2))/t.ship.initialVelocityDiff*100):100}%`})},null,4)])])):ae("",!0)]),p("div",Co,[p("div",Do,[o[6]||(o[6]=p("span",{class:"text-cyan-200/60"},"坐标 (m)",-1)),p("span",Ro,ne(Math.round(t.ship.position.x))+", "+ne(Math.round(t.ship.position.y))+", "+ne(Math.round(t.ship.position.z)),1)])])])}}},zo={key:0,class:"space-y-2"},Vo={key:0,class:"backdrop-blur-sm bg-black/50 rounded-xl border border-cyan-500/30 p-4 text-xs"},Go={key:1,class:"backdrop-blur-sm bg-black/50 rounded-xl border border-green-500/30 p-4 text-xs"},Lo={__name:"ControlsPanel",props:{visible:{type:Boolean,default:!0},gamepadConnected:{type:Boolean,default:!1}},setup(t){return(e,o)=>($(),yt(xt,{"enter-active-class":"transition-all duration-300 ease-out","leave-active-class":"transition-all duration-200 ease-in","enter-from-class":"opacity-0 translate-x-4","leave-to-class":"opacity-0 translate-x-4"},{default:Ye(()=>[t.visible?($(),ee("div",zo,[t.gamepadConnected?ae("",!0):($(),ee("div",Vo,[...o[0]||(o[0]=[p("div",{class:"text-cyan-300/60 uppercase tracking-wider mb-3"},"键盘控制 (H 隐藏)",-1),p("div",{class:"grid grid-cols-2 gap-x-6 gap-y-1 text-cyan-200/80"},[p("div",null,[p("span",{class:"text-cyan-400"},"鼠标"),F(" 视角控制")]),p("div",null,[p("span",{class:"text-cyan-400"},"点击"),F(" 锁定鼠标")]),p("div",null,[p("span",{class:"text-cyan-400"},"W/S"),F(" 前进/后退")]),p("div",null,[p("span",{class:"text-cyan-400"},"A/D"),F(" 左移/右移")]),p("div",null,[p("span",{class:"text-cyan-400"},"Space"),F(" 上升")]),p("div",null,[p("span",{class:"text-cyan-400"},"Ctrl"),F(" 下降")]),p("div",null,[p("span",{class:"text-cyan-400"},"Q/E"),F(" 左转/右转")]),p("div",null,[p("span",{class:"text-cyan-400"},"↑/↓"),F(" 俯仰")]),p("div",null,[p("span",{class:"text-cyan-400"},"Shift"),F(" 加速")]),p("div",null,[p("span",{class:"text-cyan-400"},"X"),F(" 速度同步")]),p("div",null,[p("span",{class:"text-cyan-400"},"F"),F(" 起飞")]),p("div",null,[p("span",{class:"text-cyan-400"},"V"),F(" 切换视角")])],-1)])])),t.gamepadConnected?($(),ee("div",Go,[...o[1]||(o[1]=[p("div",{class:"text-green-300/60 uppercase tracking-wider mb-3"},"手柄控制",-1),p("div",{class:"grid grid-cols-2 gap-x-6 gap-y-1 text-green-200/80"},[p("div",null,[p("span",{class:"text-green-400"},"左摇杆"),F(" 移动")]),p("div",null,[p("span",{class:"text-green-400"},"右摇杆"),F(" 视角")]),p("div",null,[p("span",{class:"text-green-400"},"RT"),F(" 上升")]),p("div",null,[p("span",{class:"text-green-400"},"LT"),F(" 下降")]),p("div",null,[p("span",{class:"text-green-400"},"LB/RB"),F(" 翻滚")]),p("div",null,[p("span",{class:"text-green-400"},"左摇杆按下"),F(" 加速")]),p("div",null,[p("span",{class:"text-green-400"},"A"),F(" 起飞/上升")]),p("div",null,[p("span",{class:"text-green-400"},"X"),F(" 速度同步")]),p("div",null,[p("span",{class:"text-green-400"},"B"),F(" 切换视角")]),p("div",null,[p("span",{class:"text-green-400"},"Start"),F(" 隐藏说明")])],-1)])])):ae("",!0)])):ae("",!0)]),_:1}))}},Io={class:"fixed inset-0 w-full h-full overflow-hidden bg-[#020206] outline-none",tabindex:"0"},_o={key:0,class:"absolute inset-0 flex items-center justify-center z-50 bg-[#020206]"},Eo={class:"absolute bottom-4 left-4 md:bottom-6 md:left-6 z-10 space-y-2"},To={class:"absolute bottom-4 right-4 md:bottom-6 md:right-6 z-10"},No={class:"absolute bottom-4 left-1/2 -translate-x-1/2 z-10 flex gap-2 items-center"},Oo={key:0,class:"px-3 py-1.5 rounded-lg bg-black/50 backdrop-blur-sm border border-green-500/30 text-green-300/80 text-xs flex items-center gap-1.5"},Bo={__name:"SpaceshipSimulator",setup(t){const e=ge(null),o=ge(!0),n=ge(!0);let a,r,c,i=null,s=0,l=[],u=Math.random()*Math.PI*2,x=0,b=0,z=null,m=new w(0,0,0),f=0,d=!1,v=null;const M=new w(8943,50,50),{ship:g,controls:h,hud:S,viewMode:y,setShipMesh:D,matchVelocityWithNearest:P,launch:G,updateShip:I,updateCamera:V,handleMouseMove:R,cycleViewMode:A}=io(M),{gamepadConnected:C,buttons:N,mapToControls:L,getRotationInput:B,startPolling:Q,stopPolling:Z}=ro();let E={x:!1,b:!1,start:!1};const T=()=>{a=new mt,r=new ht(45,e.value.clientWidth/e.value.clientHeight,.5,15e4),c=new ft({antialias:!0,alpha:!0}),c.setSize(e.value.clientWidth,e.value.clientHeight),c.setPixelRatio(Math.min(window.devicePixelRatio,2)),c.toneMapping=vt,c.toneMappingExposure=1,e.value.appendChild(c.domElement),a.add(to());const _=new wt(3359829,.6);a.add(_);let U=!1;Ct.forEach(W=>{const{group:we,sunCoronaGroup:ke}=oo(W);a.add(we),l.push(we),ke&&(z=ke),W.orbitRadius>0&&!W.isTwin&&!W.isComet&&!W.isQuantum&&a.add(Qe(W.orbitRadius)),W.isTwin&&!U&&(a.add(Qe(W.orbitRadius)),U=!0),W.isComet&&W.orbitA&&W.orbitB&&a.add(no(W.orbitA,W.orbitB))}),v=ao(g.position),D(v),a.add(v);const ue=qe(.016,l,u,x,b);u=ue.twinSystemAngle,b=ue.quantumAngle;const H=l.find(W=>W.userData.name==="木炉星");if(H){const W=H.position,we=H.userData.size;g.position.set(W.x,W.y+we+.5,W.z),v.position.copy(g.position),g.isLanded=!0,g.landedOn=H;const ke=H.userData.mesh?H.userData.mesh.rotation.y:0;g.landedLocalDir=new w(0,1,0);const Oe=new K().setFromEuler(new Ke(0,0,0)),et=new K().setFromAxisAngle(new w(0,1,0),ke);g.landedLocalQuaternion.copy(et.invert().multiply(Oe)),g.rotation.setFromQuaternion(Oe);const tt=me(H,l,u);g.velocity.copy(tt)}o.value=!1},j=_=>{i=requestAnimationFrame(j);const U=Math.min((_-s)/1e3,.1);if(s=_,f+=U,C.value){L(h);const H=B();if(Math.abs(H.yaw)>.01||Math.abs(H.pitch)>.01){const we={movementX:H.yaw/.002,movementY:H.pitch/.002};R(we,!0)}N.b&&!E.b&&A(),N.x&&!E.x&&P(l,u),N.start&&!E.start&&(n.value=!n.value),E.x=N.x,E.b=N.b,E.start=N.start}const ue=qe(U,l,u,x,b);u=ue.twinSystemAngle,b=ue.quantumAngle,I(U,l,u),V(r,l),z&&Jt(z,f),l.forEach(H=>{H.userData.atmosphere&&Lt(H.userData.atmosphere,m)}),c.render(a,r)},X=_=>{switch(_.code){case"KeyW":h.forward=!0;break;case"KeyS":h.backward=!0;break;case"KeyA":h.left=!0;break;case"KeyD":h.right=!0;break;case"Space":h.up=!0;break;case"ControlLeft":case"ControlRight":h.down=!0;break;case"KeyQ":h.rollLeft=!0;break;case"KeyE":h.rollRight=!0;break;case"ArrowUp":h.pitchUp=!0;break;case"ArrowDown":h.pitchDown=!0;break;case"ShiftLeft":case"ShiftRight":h.boost=!0;break;case"KeyX":P(l,u);break;case"KeyF":G(l,u);break;case"KeyH":n.value=!n.value;break;case"KeyV":A();break}},J=_=>{switch(_.code){case"KeyW":h.forward=!1;break;case"KeyS":h.backward=!1;break;case"KeyA":h.left=!1;break;case"KeyD":h.right=!1;break;case"Space":h.up=!1;break;case"ControlLeft":case"ControlRight":h.down=!1;break;case"KeyQ":h.rollLeft=!1;break;case"KeyE":h.rollRight=!1;break;case"ArrowUp":h.pitchUp=!1;break;case"ArrowDown":h.pitchDown=!1;break;case"ShiftLeft":case"ShiftRight":h.boost=!1;break}},te=()=>{e.value&&(r.aspect=e.value.clientWidth/e.value.clientHeight,r.updateProjectionMatrix(),c.setSize(e.value.clientWidth,e.value.clientHeight))},oe=_=>{R(_,d)},ie=()=>{d=document.pointerLockElement===e.value},re=()=>{!d&&e.value&&e.value.requestPointerLock()},ce=()=>{if(document.visibilityState==="visible"){let _;do _=Math.floor(Math.random()*Ie.length);while(_===x&&Ie.length>1);x=_,b=Math.random()*Math.PI*2}};return Mt(()=>{typeof window<"u"&&e.value&&(T(),s=performance.now(),j(s),window.addEventListener("resize",te),window.addEventListener("keydown",X),window.addEventListener("keyup",J),document.addEventListener("visibilitychange",ce),document.addEventListener("pointerlockchange",ie),document.addEventListener("mousemove",oe),e.value.addEventListener("click",re),Q(),e.value.focus())}),St(()=>{i&&cancelAnimationFrame(i),Z(),window.removeEventListener("resize",te),window.removeEventListener("keydown",X),window.removeEventListener("keyup",J),document.removeEventListener("visibilitychange",ce),document.removeEventListener("pointerlockchange",ie),document.removeEventListener("mousemove",oe),e.value&&e.value.removeEventListener("click",re),c&&c.dispose()}),(_,U)=>($(),ee("div",Io,[o.value?($(),ee("div",_o,[...U[1]||(U[1]=[p("div",{class:"text-center"},[p("div",{class:"w-16 h-16 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),p("div",{class:"text-amber-200/80 text-lg tracking-widest font-light"},"初始化飞船系统...")],-1)])])):ae("",!0),p("div",{ref_key:"containerRef",ref:e,class:"w-full h-full"},null,512),U[3]||(U[3]=Fe("",2)),p("div",Eo,[Re(Ao,{hud:le(S),ship:le(g)},null,8,["hud","ship"])]),p("div",To,[Re(Lo,{visible:n.value,"gamepad-connected":le(C)},null,8,["visible","gamepad-connected"])]),U[4]||(U[4]=Fe("",1)),p("div",No,[le(C)?($(),ee("div",Oo,[...U[2]||(U[2]=[p("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor"},[p("path",{d:"M7 6h10a5 5 0 0 1 5 5v2a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5v-2a5 5 0 0 1 5-5zm1 4a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"})],-1),F(" 手柄已连接 ",-1)])])):ae("",!0),p("button",{onClick:U[0]||(U[0]=(...ue)=>le(A)&&le(A)(...ue)),class:"px-3 py-1.5 rounded-lg bg-black/50 backdrop-blur-sm border border-cyan-500/30 text-cyan-200/80 text-xs hover:bg-cyan-900/30 hover:border-cyan-400/50 transition-all"}," 视角 (V): "+ne(le(y)==="first"?"第一人称":le(y)==="third"?"第三人称":"轨道"),1)])]))}},Fo=bt(Bo,[["__scopeId","data-v-7a66b875"]]),Uo=JSON.parse('{"title":"星际拓荒飞船模拟器","description":"","frontmatter":{"layout":"page","navbar":false,"title":"星际拓荒飞船模拟器"},"headers":[],"relativePath":"workshop/spaceship-simulator.md","filePath":"workshop/spaceship-simulator.md"}'),Qo={name:"workshop/spaceship-simulator.md"},jo=Object.assign(Qo,{setup(t){return(e,o)=>{const n=kt("ClientOnly");return $(),ee("div",null,[Re(n,null,{default:Ye(()=>[Re(Fo)]),_:1})])}}});export{Uo as __pageData,jo as default};
