import{m as w}from"./chunks/music-list.BoN_T635.js";import{_ as kt,p as l,h as b,q,v as _t,x as Mt,c as s,o as r,j as n,e as g,t as v,F as Z,B as tt,n as R,P as Lt,G as St}from"./chunks/framework.DQgBWl2g.js";const jt={class:"relative h-[calc(100vh-var(--vp-nav-height))] overflow-hidden"},Rt={class:"relative mx-auto max-w-[1200px] h-full px-4 md:px-6 py-4 md:py-6 flex flex-col min-h-0"},Ct={class:"group relative mx-auto w-full max-w-[980px] flex-1 min-h-0"},It={class:"relative h-full flex flex-col min-h-0"},Nt={class:"shrink-0 px-5 md:px-8 pt-5 md:pt-6 pb-4 md:pb-5"},Tt={class:"text-center text-[#f3e7dc] dark:text-gray-100"},Pt={key:0,class:"mt-3 text-xs md:text-sm text-[#f6e9de]/80 dark:text-white/70"},Et={class:"text-xl md:text-2xl font-semibold tracking-wide"},$t={class:"mt-2 flex items-center justify-center gap-3 text-xs md:text-sm opacity-80 flex-wrap"},Ft={class:"flex items-center gap-1.5"},At={key:1,class:"mt-2 text-xs opacity-70 flex items-center justify-center gap-4 flex-wrap"},Bt={key:0},zt={key:1},Vt={class:"flex-1 min-h-0 overflow-y-auto px-5 md:px-8 py-6 md:py-8 scroll-smooth hide-scrollbar"},Ut={class:"flex flex-col gap-6 md:gap-7"},qt=["onClick"],Ot={class:"flex flex-col items-center gap-1.5"},Wt={class:"controls shrink-0 px-4 md:px-6 pb-3 md:pb-4 transition-opacity duration-300 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:pointer-events-auto"},Dt={class:"w-full flex justify-center"},Kt={class:"flex items-center gap-2.5 md:gap-3.5 w-[min(520px,100%)]"},Gt={key:0,class:"w-5 h-5 md:w-5 md:h-5 text-[#f6e9de] dark:text-white",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},Ht={key:1,class:"w-5 h-5 md:w-5 md:h-5 text-[#f6e9de] dark:text-white ml-0.5",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},Jt={class:"flex-1 min-w-0 max-w-[360px]"},Qt=["max","value","disabled"],Xt={class:"-mt-0.5 flex items-center justify-between text-[11px] md:text-xs text-[#f6e9de]/70 dark:text-white/60"},Yt=["aria-expanded"],Zt={key:0,class:"absolute right-0 bottom-[calc(100%+10px)] w-[min(90vw,280px)] rounded-2xl border border-white/15 bg-[#1a1410]/95 dark:bg-gray-900/95 backdrop-blur-xl shadow-2xl shadow-black/30 ring-1 ring-white/10 p-3 md:p-4 text-[#f6e9de] dark:text-gray-100 transition-colors duration-300"},te={class:"mt-4 flex flex-col gap-4"},ee={class:"flex flex-col gap-2"},ne={class:"flex items-center justify-between text-xs opacity-80"},ae={class:"tabular-nums"},ie=["value"],oe={class:"flex flex-col gap-2"},se={class:"flex items-center justify-between text-xs opacity-80"},re={class:"tabular-nums"},le={class:"flex flex-wrap gap-2"},ue=["onClick"],de={class:"flex flex-col gap-2"},ce={class:"flex items-center justify-between text-xs opacity-80"},me={class:"tabular-nums"},ve={key:0},fe={key:1},pe={key:2},xe={class:"flex flex-wrap gap-2"},he=["src"],we={key:0,class:"mt-3 text-center text-sm text-white/70"},ye={__name:"LyricMusicPlayer",setup(et){const p=l(""),y=b(()=>w.length?w.find(e=>(e==null?void 0:e.id)===p.value)||w[0]:null),nt=b(()=>p.value?w.length?!w.some(e=>(e==null?void 0:e.id)===p.value):!0:!1),at=b(()=>{var e;return((e=y.value)==null?void 0:e.title)||"未知歌曲"}),it=b(()=>{var e;return((e=y.value)==null?void 0:e.artist)||"未知歌手"});b(()=>{var e;return((e=y.value)==null?void 0:e.album)||""});const ot=b(()=>{var t;const e=(t=y.value)==null?void 0:t.audio;return e?new URL(e,import.meta.url).href:""}),st=b(()=>{var t;const e=(t=y.value)==null?void 0:t.lrc;return e?new URL(e,import.meta.url).href:""}),f=l(null),C=l([]),k=l(""),_=l(""),F=l(!1),A=l(!1),I=l(0),N=l(0),M=l(!1),O=l(null),L=l(20),S=l(1),rt=[.5,.75,1,1.25,1.5,2],x=l("order"),h=l(-1),T=l([]),W=l(!1),lt=b(()=>!w.length||!y.value?-1:w.findIndex(e=>{var t;return(e==null?void 0:e.id)===((t=y.value)==null?void 0:t.id)}));function P(e,t,a){return Number.isFinite(e)?Math.min(a,Math.max(t,e)):t}function D(e){if(!Number.isFinite(e)||e<0)return"00:00";const t=Math.floor(e),a=Math.floor(t/60),i=t%60;return`${String(a).padStart(2,"0")}:${String(i).padStart(2,"0")}`}function ut(e){const t=String(e||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`),a=/\[(\d{2}):(\d{2})(?:[.:](\d{1,3}))?\]/g,i=[];for(const o of t){const u=String(o||""),d=[];let c;for(;(c=a.exec(u))!==null;){const m=Number(c[1]),bt=Number(c[2]),gt=c[3]?Number(c[3].padEnd(3,"0")):0,Y=m*60*1e3+bt*1e3+gt;Number.isFinite(Y)&&d.push(Y)}if(!d.length)continue;const j=u.replace(a,"").trimEnd();for(const m of d)i.push({timeMs:m,time:m/1e3,text:j||" "})}return i.sort((o,u)=>o.timeMs-u.timeMs),i}function dt(e){const t=String(e||"").trim(),a=t.match(/^作词\s*[:：]\s*(.+)$/);if(a)return{type:"lyricist",value:a[1].trim()};const i=t.match(/^作曲\s*[:：]\s*(.+)$/);return i?{type:"composer",value:i[1].trim()}:null}function ct(e){const t=String(e||"").trim();if(!t)return{kind:"empty",value:""};const a=dt(t);if(a)return{kind:a.type,value:a.value};const i=t.match(/^R\s*[:：]\s*(.*)$/i);if(i)return{kind:"romaji",value:(i[1]||"").trim()};const o=t.match(/^T\s*[:：]\s*(.*)$/i);return o?{kind:"trans",value:(o[1]||"").trim()}:{kind:"main",value:t}}function mt(e){const t=C.value;if(!t.length)return-1;let a=0,i=t.length-1,o=-1;for(;a<=i;){const u=a+i>>1;t[u].time<=e+.03?(o=u,a=u+1):i=u-1}return o}async function vt(e){const t=String(e||"").trim();if(!t){C.value=[],h.value=-1,T.value=[],k.value="",_.value="";return}const i=await(await fetch(t)).text(),o=ut(i);k.value="",_.value="";const u=new Map;for(const d of o){const{kind:c,value:j}=ct(d.text);if(c==="lyricist"){k.value=j;continue}if(c==="composer"){_.value=j;continue}if(c==="empty")continue;let m=u.get(d.timeMs);m||(m={time:d.time,timeMs:d.timeMs,main:"",romaji:"",trans:""},u.set(d.timeMs,m)),c==="main"&&!m.main&&(m.main=j),c==="romaji"&&!m.romaji&&(m.romaji=j),c==="trans"&&!m.trans&&(m.trans=j)}C.value=Array.from(u.values()).sort((d,c)=>d.timeMs-c.timeMs).filter(d=>String(d.main||"").trim()||String(d.romaji||"").trim()||String(d.trans||"").trim()),h.value=-1,T.value=[]}function ft(){const e=f.value;if(!e)return;N.value=e.currentTime||0;const t=mt(N.value);t!==h.value&&(h.value=t)}function pt(){const e=f.value;I.value=(e==null?void 0:e.duration)||0,F.value=!0}function xt(){const e=f.value;e&&(e.paused?e.play().catch(()=>{}):e.pause())}function B(e){const t=f.value;!t||!Number.isFinite(e)||(t.currentTime=Math.max(0,Math.min(e,I.value||e)))}function ht(){M.value=!M.value}function E(){M.value=!1}function z(){const e=f.value;e&&(e.volume=P(Number(L.value)/100,0,1))}function V(){const e=f.value;e&&(e.playbackRate=P(Number(S.value),.25,4))}function K(e){const t=w,a=t.length;if(!a)return;const i=(e%a+a)%a,o=t[i];if(!(!o||!o.id)){if(p.value=o.id,typeof window<"u")try{const u=new URL(window.location.href);u.searchParams.set("id",String(o.id)),window.history.pushState({},"",u)}catch{}U()}}function G(){if(typeof window>"u")return;const e=new URLSearchParams(window.location.search||"");p.value=e.get("id")||""}async function U(){const e=f.value;if(E(),F.value=!1,I.value=0,N.value=0,h.value=-1,T.value=[],C.value=[],k.value="",_.value="",e){try{e.pause()}catch{}try{e.currentTime=0}catch{}}if(await vt(st.value),await Lt(),e){try{e.load()}catch{}z(),V()}}q(h,e=>{if(e<0)return;const t=T.value[e];if(t)try{t.scrollIntoView({behavior:W.value?"auto":"smooth",block:"center"})}catch{}});let $=0;function H(){ft(),$=window.requestAnimationFrame(H)}q(L,()=>{z();try{localStorage.setItem("lyric-music-player:volumePercent",String(L.value))}catch{}}),q(S,()=>{V();try{localStorage.setItem("lyric-music-player:playbackRate",String(S.value))}catch{}}),_t(async()=>{W.value=typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,G(),await U();const e=f.value;if(e){try{const t=localStorage.getItem("lyric-music-player:volumePercent");t!=null&&(L.value=P(Number(t),0,100));const a=localStorage.getItem("lyric-music-player:playbackRate");a!=null&&(S.value=P(Number(a),.25,4))}catch{}z(),V(),$=window.requestAnimationFrame(H);try{e.play().catch(()=>{})}catch{}window.addEventListener("keydown",J),window.addEventListener("pointerdown",Q,{capture:!0}),window.addEventListener("popstate",X)}}),Mt(()=>{$&&window.cancelAnimationFrame($),window.removeEventListener("keydown",J),window.removeEventListener("pointerdown",Q,{capture:!0}),window.removeEventListener("popstate",X)});function wt(e){return t=>{t&&(T.value[e]=t)}}function J(e){M.value&&e.key==="Escape"&&E()}function Q(e){if(!M.value)return;const t=O.value;t&&(t.contains(e.target)||E())}function X(){const e=p.value;G(),p.value!==e&&U()}function yt(){const e=x.value,t=w.length;if(!t)return;if(e==="loop"){B(0);const o=f.value;if(o)try{o.play().catch(()=>{})}catch{}return}const a=lt.value;if(e==="shuffle"){let o=Math.floor(Math.random()*t);t>1&&o===a&&(o=(o+1)%t),K(o);return}const i=a<0?0:(a+1)%t;K(i)}return(e,t)=>(r(),s("div",jt,[t[18]||(t[18]=n("div",{class:"absolute inset-0 bg-gradient-to-br from-[#241d19] via-[#3c2b23] to-[#6b4a38] dark:from-[#020617] dark:via-[#020617] dark:to-[#020617]"},null,-1)),t[19]||(t[19]=n("div",{class:"absolute inset-0 bg-black/40 dark:bg-black/70"},null,-1)),t[20]||(t[20]=n("div",{class:"absolute inset-0 backdrop-blur-3xl bg-white/14 dark:bg-slate-900/70"},null,-1)),n("div",Rt,[n("div",Ct,[n("div",It,[n("div",Nt,[n("div",Tt,[t[8]||(t[8]=n("div",{class:"flex items-center justify-between gap-3"},[n("a",{href:"./","data-no-spa":"",class:"h-10 min-w-[44px] px-3 rounded-xl bg-white/10 hover:bg-white/16 transition-colors duration-300 text-xs flex items-center justify-center","aria-label":"返回音乐列表"}," 返回 "),n("div",{class:"flex-1"})],-1)),nt.value?(r(),s("div",Pt," 未找到对应歌曲 id="+v(p.value)+"，已自动播放默认歌曲。 ",1)):g("",!0),n("div",Et,v(at.value),1),n("div",$t,[n("div",Ft,[t[7]||(t[7]=n("svg",{class:"w-4 h-4 opacity-90",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[n("path",{d:"M12 12c2.761 0 5-2.239 5-5S14.761 2 12 2 7 4.239 7 7s2.239 5 5 5zm0 2c-4.418 0-8 2.239-8 5v2h16v-2c0-2.761-3.582-5-8-5z"})],-1)),n("div",null,v(it.value),1)])]),k.value||_.value?(r(),s("div",At,[k.value?(r(),s("div",Bt,"作词："+v(k.value),1)):g("",!0),_.value?(r(),s("div",zt,"作曲："+v(_.value),1)):g("",!0)])):g("",!0)]),t[9]||(t[9]=n("div",{class:"mt-4 h-px bg-white/12 dark:bg-white/10"},null,-1))]),n("div",Vt,[n("div",Ut,[(r(!0),s(Z,null,tt(C.value,(a,i)=>(r(),s("div",{key:a.timeMs+"-"+i,ref_for:!0,ref:wt(i),class:"text-center select-none",onClick:o=>B(a.time)},[n("div",Ot,[a.romaji?(r(),s("div",{key:0,class:R(["transition-all duration-300",i===h.value?"text-[#f6e9de]/85 dark:text-white/75 text-sm md:text-base font-medium":"text-[#f6e9de]/45 dark:text-white/35 text-xs md:text-sm font-medium opacity-80"])},v(a.romaji),3)):g("",!0),n("div",{class:R(["transition-all duration-300",i===h.value?"text-[#f6e9de] dark:text-white text-3xl md:text-4xl font-semibold opacity-100":"text-[#f6e9de]/55 dark:text-white/45 text-lg md:text-xl font-medium opacity-70 hover:opacity-90"])},v(a.main),3),a.trans?(r(),s("div",{key:1,class:R(["transition-all duration-300",i===h.value?"text-[#f6e9de]/85 dark:text-white/75 text-sm md:text-base font-medium":"text-[#f6e9de]/45 dark:text-white/35 text-xs md:text-sm font-medium opacity-80"])},v(a.trans),3)):g("",!0)])],8,qt))),128))])]),n("div",Wt,[n("div",Dt,[n("div",Kt,[n("button",{type:"button",class:"h-9 w-9 md:h-10 md:w-10 rounded-full bg-white/15 dark:bg-white/10 hover:bg-white/25 dark:hover:bg-white/15 transition-colors duration-300 flex items-center justify-center",onClick:xt,"aria-label":"播放/暂停"},[A.value?(r(),s("svg",Gt,[...t[10]||(t[10]=[n("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)])])):(r(),s("svg",Ht,[...t[11]||(t[11]=[n("path",{d:"M8 5v14l11-7z"},null,-1)])]))]),n("div",Jt,[n("input",{class:"w-full h-8 accent-white/80",type:"range",min:"0",max:I.value||0,step:"0.05",value:N.value,disabled:!F.value,onInput:t[0]||(t[0]=a=>B(Number(a.target.value)))},null,40,Qt),n("div",Xt,[n("div",null,v(D(N.value)),1),n("div",null,v(D(I.value)),1)])]),n("div",{ref_key:"menuWrapRef",ref:O,class:"relative shrink-0"},[n("button",{type:"button",class:"h-9 w-9 md:h-10 md:w-10 rounded-full bg-white/15 dark:bg-white/10 hover:bg-white/25 dark:hover:bg-white/15 transition-colors duration-300 flex items-center justify-center","aria-expanded":M.value?"true":"false","aria-label":"播放设置",onClick:ht},[...t[12]||(t[12]=[n("svg",{class:"w-5 h-5 md:w-5 md:h-5 text-[#f6e9de] dark:text-white",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[n("path",{d:"M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.5.5 0 00.12-.64l-1.92-3.32a.5.5 0 00-.6-.22l-2.39.96a7.03 7.03 0 00-1.63-.94l-.36-2.54A.5.5 0 0013.9 1h-3.8a.5.5 0 00-.49.42l-.36 2.54c-.58.22-1.12.53-1.63.94l-2.39-.96a.5.5 0 00-.6.22L2.71 7.48a.5.5 0 00.12.64l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94L2.83 14.52a.5.5 0 00-.12.64l1.92 3.32c.13.22.39.3.6.22l2.39-.96c.5.41 1.05.72 1.63.94l.36 2.54c.04.24.25.42.49.42h3.8c.24 0 .45-.18.49-.42l.36-2.54c.58-.22 1.12-.53 1.63-.94l2.39.96c.22.09.47 0 .6-.22l1.92-3.32a.5.5 0 00-.12-.64l-2.03-1.58zM12 15.5A3.5 3.5 0 1112 8a3.5 3.5 0 010 7.5z"})],-1)])],8,Yt),M.value?(r(),s("div",Zt,[n("div",{class:"flex items-center justify-between gap-3"},[t[14]||(t[14]=n("div",{class:"text-sm font-semibold tracking-wide"},"播放设置",-1)),n("button",{type:"button",class:"h-8 w-8 rounded-full bg-white/10 hover:bg-white/18 transition-colors duration-300 flex items-center justify-center","aria-label":"关闭菜单",onClick:E},[...t[13]||(t[13]=[n("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[n("path",{d:"M18.3 5.71a1 1 0 00-1.41 0L12 10.59 7.11 5.7A1 1 0 105.7 7.11L10.59 12l-4.9 4.89a1 1 0 101.41 1.42L12 13.41l4.89 4.9a1 1 0 001.42-1.41L13.41 12l4.9-4.89a1 1 0 000-1.4z"})],-1)])])]),n("div",te,[n("div",ee,[n("div",ne,[t[15]||(t[15]=n("div",null,"音量",-1)),n("div",ae,v(L.value)+"%",1)]),n("input",{class:"w-full h-9 accent-white/80",type:"range",min:"0",max:"100",step:"1",value:L.value,onInput:t[1]||(t[1]=a=>L.value=Number(a.target.value))},null,40,ie)]),n("div",oe,[n("div",se,[t[16]||(t[16]=n("div",null,"速度",-1)),n("div",re,v(Number(S.value).toFixed(2))+"x",1)]),n("div",le,[(r(),s(Z,null,tt(rt,a=>n("button",{key:a,type:"button",class:R(["h-10 px-3 rounded-xl border border-white/15 bg-white/8 hover:bg-white/14 transition-colors duration-300 text-xs md:text-sm",a===S.value?"bg-white/18 border-white/25":""]),onClick:i=>S.value=a},v(a)+"x ",11,ue)),64))])]),n("div",de,[n("div",ce,[t[17]||(t[17]=n("div",null,"播放模式",-1)),n("div",me,[x.value==="order"?(r(),s("span",ve,"顺序播放")):x.value==="loop"?(r(),s("span",fe,"循环播放")):(r(),s("span",pe,"随机播放"))])]),n("div",xe,[n("button",{type:"button",class:R(["h-9 px-3 rounded-xl border border-white/15 bg-white/8 hover:bg-white/14 transition-colors duration-300 text-xs md:text-sm",x.value==="order"?"bg-white/18 border-white/25":""]),onClick:t[2]||(t[2]=a=>x.value="order")}," 顺序 ",2),n("button",{type:"button",class:R(["h-9 px-3 rounded-xl border border-white/15 bg-white/8 hover:bg-white/14 transition-colors duration-300 text-xs md:text-sm",x.value==="loop"?"bg-white/18 border-white/25":""]),onClick:t[3]||(t[3]=a=>x.value="loop")}," 循环 ",2),n("button",{type:"button",class:R(["h-9 px-3 rounded-xl border border-white/15 bg-white/8 hover:bg-white/14 transition-colors duration-300 text-xs md:text-sm",x.value==="shuffle"?"bg-white/18 border-white/25":""]),onClick:t[4]||(t[4]=a=>x.value="shuffle")}," 随机 ",2)])])])])):g("",!0)],512)])])])])]),n("audio",{ref_key:"audioRef",ref:f,src:ot.value||void 0,preload:"metadata",onLoadedmetadata:pt,onPlay:t[5]||(t[5]=a=>A.value=!0),onPause:t[6]||(t[6]=a=>A.value=!1),onEnded:yt},null,40,he),C.value.length?g("",!0):(r(),s("div",we," 歌词加载中… "))])]))}},be=kt(ye,[["__scopeId","data-v-e2ffcc57"]]),Me=JSON.parse('{"title":"播放","description":"音乐播放页","frontmatter":{"layout":"page","title":"播放","description":"音乐播放页"},"headers":[],"relativePath":"music/player.md","filePath":"music/player.md"}'),ge={name:"music/player.md"},Le=Object.assign(ge,{setup(et){return(p,y)=>(r(),s("div",null,[St(be)]))}});export{Me as __pageData,Le as default};
